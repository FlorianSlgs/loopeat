import{a as pe}from"./chunk-7F3B5DU6.js";import{a as de,c as me,e as ce,j as F}from"./chunk-JWWAIMLC.js";import{B as P,Ba as $,Ia as A,J as p,Ja as ae,K as u,Ka as V,La as le,M as k,Ma as se,N as I,O as te,Oa as z,P as x,Q as g,R as T,S as o,T as n,U as S,V as y,W as _,X as q,Y as c,Z as d,ba as ie,da as j,fa as a,ga as v,ha as B,i as G,ia as H,ja as oe,ka as ne,l as E,la as re,m as b,n as f,o as w,p as C,r as m,ra as D,x as L,y as l,ya as M}from"./chunk-J7GXK7A4.js";import"./chunk-MYNB6ETT.js";function fe(i,t){i&1&&(x(0,"span",23),a(1,"Dashboard"),g())}function ve(i,t){i&1&&(x(0,"span",23),a(1,"Historique"),g())}var U=class i{router=E(V);onSettingsClick(){this.router.url.includes("/pro/parametres")?this.router.navigate(["/pro/dashboard"]):this.router.navigate(["/pro/parametres"])}isOnSettingsPage(){return this.router.url.includes("/pro/parametres")}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-pro-home"]],decls:30,vars:4,consts:[["settingsLink","routerLinkActive"],["dashboardLink","routerLinkActive"],["historiqueLink","routerLinkActive"],[1,"flex","flex-col","h-screen"],[1,"fixed","top-0","left-0","right-0","bg-white","z-[1005]"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","items-center","h-22"],[1,"flex","items-center","gap-3"],["href","/",1,"flex","items-center"],[1,"flex","items-center"],["src","logo.jpg","alt","logo loop-eat",1,"h-19","w-auto"],[1,"text-xl","font-semibold","text-gray-900"],["routerLinkActive","active","aria-label","Param\xE8tres",1,"settings","flex","items-center","justify-center","w-11","h-11","rounded-lg","text-gray-600","hover:bg-emerald-100","hover:text-emerald-600","hover:cursor-pointer","transition-all","duration-200",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-9","h-9"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],[1,"flex-1"],[1,"fixed","bottom-0","left-0","right-0","bg-white","border-t","border-gray-200","z-[1005]"],[1,"max-w-3xl","mx-auto","px-4","pb-3"],[1,"flex","justify-around","items-center","h-16"],["routerLink","/pro/dashboard","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-item","flex","items-center","gap-3","py-2","px-4","rounded-lg","text-gray-600","hover:bg-gray-50","transition-all","duration-200"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-6","h-6","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","d","M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"],[1,"text-sm","font-medium","whitespace-nowrap"],["routerLink","/pro/historique","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-item","flex","items-center","gap-3","py-2","px-4","rounded-lg","text-gray-600","hover:bg-gray-50","transition-all","duration-200"],["stroke-linecap","round","stroke-linejoin","round","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"]],template:function(e,r){if(e&1){let s=y();x(0,"div",3)(1,"header",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"a",8)(6,"div",9),T(7,"img",10),g()(),x(8,"span",11),a(9,"Espace Pro"),g()(),x(10,"button",12,0),q("click",function(){return b(s),f(r.onSettingsClick())}),w(),x(12,"svg",13),T(13,"path",14)(14,"path",15),g()()()()(),C(),x(15,"main",16),T(16,"router-outlet"),g(),x(17,"footer",17)(18,"nav",18)(19,"div",19)(20,"a",20,1),w(),x(22,"svg",21),T(23,"path",22),g(),p(24,fe,2,0,"span",23),g(),C(),x(25,"a",24,2),w(),x(27,"svg",21),T(28,"path",25),g(),p(29,ve,2,0,"span",23),g()()()()()}if(e&2){let s=ie(21),h=ie(26);l(10),j("active",r.isOnSettingsPage()),l(14),u(s.isActive?24:-1),l(5),u(h.isActive?29:-1)}},dependencies:[ae,le,se],styles:[".nav-item.active[_ngcontent-%COMP%]{background-color:#eefff6;color:#064e3b}.settings.active[_ngcontent-%COMP%]{background-color:#eefff6;color:#059669}.nav-item.active[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke:#064e3b}footer[_ngcontent-%COMP%]{box-shadow:0 -2px 8px #0000001a}main[_ngcontent-%COMP%]{padding-bottom:5rem}"]})};var J=class i{http=E($);apiUrl=`${z.apiUrl}/accounts`;getBasicInfo(){return this.http.get(`${this.apiUrl}/info`,{withCredentials:!0})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=G({token:i,factory:i.\u0275fac,providedIn:"root"})};var N=class i{http=E($);apiUrl=`${z.apiUrl}/borrow`;createProposal(t){return this.http.post(`${this.apiUrl}/propose`,t,{withCredentials:!0})}getProposal(t){return this.http.get(`${this.apiUrl}/proposal/${t}`,{withCredentials:!0})}getBatchProposals(t){return this.http.get(`${this.apiUrl}/batch/${t}`,{withCredentials:!0})}getMyProposals(){return this.http.get(`${this.apiUrl}/my-proposals`,{withCredentials:!0})}cancelProposal(t){return this.http.post(`${this.apiUrl}/cancel/${t}`,{},{withCredentials:!0})}getInventory(){return this.http.get(`${this.apiUrl}/inventory`,{withCredentials:!0})}getMonthlyHistory(t=12){return this.http.get(`${this.apiUrl}/monthly-history?limit=${t}`,{withCredentials:!0})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=G({token:i,factory:i.\u0275fac,providedIn:"root"})};var ue=(i,t)=>t.type;function he(i,t){if(i&1&&(x(0,"p",5),a(1),g()),i&2){let e=d();l(),B("Code: ",e.proCode())}}function Ee(i,t){i&1&&(x(0,"div",15),T(1,"div",17),g())}function _e(i,t){if(i&1&&(x(0,"div",22)(1,"div",23)(2,"div",24),T(3,"img",25),g(),x(4,"p",26),a(5),g()()()),i&2){let e=d().$implicit,r=d(2);l(3),te("src",r.getBoxImage(e.type),L)("alt",e.label),l(2),H(" ",e.clean," ",e.label," ")}}function ye(i,t){if(i&1&&p(0,_e,6,4,"div",22),i&2){let e=t.$implicit;u(e.clean>0?0:-1)}}function we(i,t){if(i&1&&(x(0,"div",27)(1,"div",23)(2,"div",28),T(3,"img",25),g(),x(4,"p",26),a(5),g()()()),i&2){let e=d().$implicit,r=d(2);l(3),te("src",r.getBoxImage(e.type),L)("alt",e.label),l(2),H(" ",e.dirty," ",e.label," ")}}function Se(i,t){if(i&1&&p(0,we,6,4,"div",27),i&2){let e=t.$implicit;u(e.dirty>0?0:-1)}}function Ce(i,t){if(i&1&&(x(0,"div",18)(1,"h4",19),a(2,"Bo\xEEtes propres"),g(),x(3,"div",20),k(4,ye,1,1,null,null,ue),g()(),x(6,"div")(7,"h4",21),a(8,"Bo\xEEtes en attente de lavage"),g(),x(9,"div",20),k(10,Se,1,1,null,null,ue),g()()),i&2){let e=d();l(4),I(e.inventory()),l(6),I(e.inventory())}}function Pe(i,t){i&1&&(x(0,"div",16)(1,"p",29),a(2,"Aucune bo\xEEte en inventaire"),g()())}var W=class i{router=E(V);proAccountsService=E(J);proBorrowService=E(N);userName=m("");proCode=m("");cleanBoxes=m(0);dirtyBoxes=m(0);inventory=m([]);isLoadingInventory=m(!0);boxTypeImages={1:"verre-salade.webp",2:"plastique-salade.webp",3:"frites.jpg",4:"pizza.png",5:"gobelet.jpg",6:"burger.jpg"};customerCode="";ngOnInit(){this.loadProInfo(),this.loadInventory()}loadProInfo(){this.proAccountsService.getBasicInfo().subscribe({next:t=>{if(t.success){let e=t.data;this.userName.set(e.name||""),this.proCode.set(e.code||"")}},error:t=>{console.error("Erreur lors du chargement des infos pro:",t)}})}loadInventory(){this.isLoadingInventory.set(!0),this.proBorrowService.getInventory().subscribe({next:t=>{t.success&&(this.inventory.set(t.inventory),this.cleanBoxes.set(t.totals.totalClean),this.dirtyBoxes.set(t.totals.totalDirty)),this.isLoadingInventory.set(!1)},error:t=>{console.error("Erreur lors du chargement de l'inventaire:",t),this.isLoadingInventory.set(!1)}})}getBoxImage(t){return this.boxTypeImages[t]||"default-box.png"}lendBoxes(){if(this.customerCode.trim()){if(!/^\d{4}$/.test(this.customerCode.trim())){alert("Le code client doit \xEAtre compos\xE9 de 4 chiffres");return}this.router.navigate(["/pro/borrow/select"],{queryParams:{code:this.customerCode.trim()}}),this.customerCode=""}else alert("Veuillez entrer un code client")}returnBoxes(){if(this.customerCode.trim()){if(!/^\d{4}$/.test(this.customerCode.trim())){alert("Le code client doit \xEAtre compos\xE9 de 4 chiffres");return}this.router.navigate(["/pro/give-back/validate"],{queryParams:{code:this.customerCode.trim()}}),this.customerCode=""}else alert("Veuillez entrer un code client")}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-pro-dashboard"]],decls:32,vars:6,consts:[[1,"h-full","overflow-y-auto","pt-23"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"shadow-md","bg-white","rounded-sm","p-4","lg:p-8","mb-6","text-center","w-fit","mx-auto","border","border-gray-100","hover:shadow-md","hover:scale-105","transition-all"],[1,"material-symbols-outlined","block","mb-1",2,"font-size","30px"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-600","mt-1"],[1,"shadow-md","bg-white","border","border-gray-100","rounded-lg","p-4","mb-6"],["type","text","placeholder","Code client",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-emerald-500","focus:border-transparent","text-gray-900",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","gap-6","mb-6"],[1,"shadow-md","bg-emerald-600","hover:bg-emerald-700","text-white","rounded-lg","p-4","font-semibold","transition-all","hover:shadow-lg","hover:scale-105",3,"click"],[1,"shadow-md","bg-white","border","border-gray-100","rounded-lg","p-3","text-center","hover:shadow-md","hover:scale-105","transition-all"],[1,"text-4xl","font-bold","text-gray-900","mb-2"],[1,"text-md","text-gray-600"],[1,"mb-4"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"flex","justify-center","items-center","py-12"],[1,"text-center","py-8","bg-gray-50","rounded-lg"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-emerald-900"],[1,"mb-6"],[1,"text-md","font-medium","text-green-700","mb-3"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-4","gap-4"],[1,"text-md","font-medium","text-red-700","mb-3"],[1,"bg-white","rounded-lg","p-4","shadow-sm","hover:shadow-md","hover:scale-105","transition-all","duration-200","border","border-green-100"],[1,"flex","flex-col","items-center","gap-3"],[1,"w-30","h-30","rounded-lg","flex","items-center","justify-center"],[1,"max-w-full","max-h-full","object-contain",3,"src","alt"],[1,"font-semibold","text-gray-900","text-center"],[1,"bg-white","rounded-lg","p-4","shadow-sm","hover:shadow-md","hover:scale-105","transition-all","duration-200","border","border-red-100"],[1,"w-30","h-30","rounded-lg","flex","items-center","justify-center","opacity-60"],[1,"text-gray-600"]],template:function(e,r){e&1&&(x(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),a(4," account_circle "),g(),x(5,"p",4),a(6),g(),p(7,he,2,1,"p",5),g(),x(8,"div",6)(9,"input",7),re("ngModelChange",function(h){return ne(r.customerCode,h)||(r.customerCode=h),h}),g()(),x(10,"div",8)(11,"button",9),q("click",function(){return r.lendBoxes()}),a(12," Pr\xEAter des bo\xEEtes "),g(),x(13,"button",9),q("click",function(){return r.returnBoxes()}),a(14," Rendre des bo\xEEtes "),g()(),x(15,"div",8)(16,"div",10)(17,"p",11),a(18),g(),x(19,"p",12),a(20,"Bo\xEEtes propres"),g()(),x(21,"div",10)(22,"p",11),a(23),g(),x(24,"p",12),a(25,"Bo\xEEtes en attente de lavage"),g()()(),x(26,"div",13)(27,"h3",14),a(28,"Inventaire d\xE9taill\xE9"),g(),p(29,Ee,2,0,"div",15)(30,Ce,12,0)(31,Pe,3,0,"div",16),g()()()),e&2&&(l(6),v(r.userName()),l(),u(r.proCode()?7:-1),l(2),oe("ngModel",r.customerCode),l(9),v(r.cleanBoxes()),l(5),v(r.dirtyBoxes()),l(6),u(r.isLoadingInventory()?29:r.inventory().length>0?30:31))},dependencies:[M,F,de,me,ce],encapsulation:2})};function ke(i,t){if(i&1){let e=y();o(0,"div",8)(1,"form",13),c("ngSubmit",function(){b(e);let s=d();return f(s.updateNom())}),o(2,"div")(3,"label",14),a(4,"Nouveau nom"),n(),o(5,"input",15),c("input",function(s){b(e);let h=d();return f(h.nom.set(s.target.value))}),n()(),o(6,"button",16),a(7," Enregistrer "),n()()()}if(i&2){let e=d();l(5),_("value",e.nom())}}function Ie(i,t){if(i&1){let e=y();o(0,"div",8)(1,"form",13),c("ngSubmit",function(){b(e);let s=d();return f(s.updateEmail())}),o(2,"div")(3,"label",17),a(4,"Nouvel email"),n(),o(5,"input",18),c("input",function(s){b(e);let h=d();return f(h.email.set(s.target.value))}),n()(),o(6,"button",16),a(7," Enregistrer "),n()()()}if(i&2){let e=d();l(5),_("value",e.email())}}function Be(i,t){if(i&1){let e=y();o(0,"div",8)(1,"form",13),c("ngSubmit",function(){b(e);let s=d();return f(s.updatePassword())}),o(2,"div")(3,"label",19),a(4,"Mot de passe actuel"),n(),o(5,"input",20),c("input",function(s){b(e);let h=d();return f(h.currentPassword.set(s.target.value))}),n()(),o(6,"div")(7,"label",21),a(8,"Nouveau mot de passe"),n(),o(9,"input",22),c("input",function(s){b(e);let h=d();return f(h.newPassword.set(s.target.value))}),n()(),o(10,"div")(11,"label",23),a(12,"Confirmer le mot de passe"),n(),o(13,"input",24),c("input",function(s){b(e);let h=d();return f(h.confirmPassword.set(s.target.value))}),n()(),o(14,"button",16),a(15," Changer le mot de passe "),n()()()}if(i&2){let e=d();l(5),_("value",e.currentPassword()),l(4),_("value",e.newPassword()),l(4),_("value",e.confirmPassword())}}function Te(i,t){if(i&1){let e=y();o(0,"div",8)(1,"p",25)(2,"strong",26),a(3,"Attention !"),n(),a(4," Cette action est irr\xE9versible. Toutes vos donn\xE9es seront d\xE9finitivement supprim\xE9es. "),n(),o(5,"form",13),c("ngSubmit",function(){b(e);let s=d();return f(s.deleteAccount())}),o(6,"div")(7,"label",27),a(8,'Tapez "SUPPRIMER" pour confirmer'),n(),o(9,"input",28),c("input",function(s){b(e);let h=d();return f(h.deleteConfirmation.set(s.target.value))}),n()(),o(10,"button",29),a(11," Supprimer d\xE9finitivement mon compte "),n()()()}if(i&2){let e=d();l(9),_("value",e.deleteConfirmation()),l(),_("disabled",e.deleteConfirmation()!=="SUPPRIMER")}}var X=class i{authInitService=E(pe);nom=m("Pr\xE9nom");prenom=m("Nom");email=m("email@example.com");solde=m(1250.5);currentPassword=m("");newPassword=m("");confirmPassword=m("");deleteConfirmation=m("");expandedSection=m(null);toggleSection(t){this.expandedSection()===t?this.expandedSection.set(null):this.expandedSection.set(t)}updateNom(){console.log("Mise \xE0 jour du nom:",this.nom()),alert(`Nom mis \xE0 jour: ${this.nom()}`),this.expandedSection.set(null)}updatePrenom(){console.log("Mise \xE0 jour du pr\xE9nom:",this.prenom()),alert(`Pr\xE9nom mis \xE0 jour: ${this.prenom()}`),this.expandedSection.set(null)}updateEmail(){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email())){alert("Veuillez entrer un email valide");return}console.log("Mise \xE0 jour de l'email:",this.email()),alert(`Email mis \xE0 jour: ${this.email()}`),this.expandedSection.set(null)}updatePassword(){if(!this.currentPassword()){alert("Veuillez entrer votre mot de passe actuel");return}if(this.newPassword().length<8){alert("Le nouveau mot de passe doit contenir au moins 8 caract\xE8res");return}if(this.newPassword()!==this.confirmPassword()){alert("Les mots de passe ne correspondent pas");return}console.log("Changement de mot de passe"),alert("Mot de passe chang\xE9 avec succ\xE8s"),this.currentPassword.set(""),this.newPassword.set(""),this.confirmPassword.set(""),this.expandedSection.set(null)}recupererSolde(){console.log("R\xE9cup\xE9ration de la solde:",this.solde()),alert(`Demande de r\xE9cup\xE9ration de ${this.solde()} \u20AC envoy\xE9e`),this.expandedSection.set(null)}async logout(){console.log("D\xE9connexion de l'utilisateur"),await this.authInitService.logout(),this.expandedSection.set(null)}deleteAccount(){if(this.deleteConfirmation()!=="SUPPRIMER"){alert('Veuillez taper "SUPPRIMER" pour confirmer');return}console.log("Suppression du compte"),confirm("\xCAtes-vous absolument certain de vouloir supprimer votre compte ?")&&(alert("Compte supprim\xE9. Vous allez \xEAtre redirig\xE9..."),this.expandedSection.set(null))}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-pro-settings"]],decls:42,vars:14,consts:[[1,"max-w-3xl","mx-auto","px-4","md:px-8","pt-22"],[1,"bg-white","border","border-gray-200","rounded-xl","mb-4","overflow-hidden","hover:shadow-md","transition-shadow"],["type","button",1,"w-full","flex","items-center","justify-between","p-5","text-left","hover:bg-gray-50","transition-colors","hover:cursor-pointer",3,"click"],[1,"text-base","font-semibold","text-gray-700"],[1,"flex","items-center","gap-3"],[1,"text-sm","text-gray-500","max-w-[200px]","truncate"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-5","h-5","text-gray-400","transition-transform","duration-300"],["points","6 9 12 15 18 9"],[1,"p-6","bg-gray-50","border-t","border-gray-200","animate-fadeIn"],[1,"text-sm","text-gray-500"],[1,"bg-white","border","border-red-200","rounded-xl","mb-4","overflow-hidden","hover:shadow-md","transition-shadow","hover:cursor-pointer"],["type","button",1,"w-full","flex","items-center","justify-between","p-5","text-left","hover:bg-red-50","transition-colors","hover:cursor-pointer",3,"click"],[1,"text-base","font-semibold","text-red-600"],[1,"space-y-4",3,"ngSubmit"],["for","nom",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","nom","type","text","placeholder","Entrez votre nom",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["type","submit",1,"w-full","px-6","py-3","bg-emerald-500","text-white","font-semibold","rounded-lg","hover:bg-emerald-600","hover:-translate-y-0.5","hover:shadow-lg","transition-all","hover:cursor-pointer"],["for","email",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","email","type","email","placeholder","Entrez votre email",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","current-password",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","current-password","type","password","placeholder","Entrez votre mot de passe actuel",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","new-password",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","new-password","type","password","placeholder","Entrez votre nouveau mot de passe",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","confirm-password",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","confirm-password","type","password","placeholder","Confirmez votre nouveau mot de passe",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],[1,"text-sm","text-red-900","mb-4","p-4","bg-red-50","rounded-lg","border","border-red-200"],[1,"font-bold"],["for","confirm-delete",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","confirm-delete","type","text","placeholder","SUPPRIMER",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-red-500","focus:border-red-500","transition-all",3,"input","value"],["type","submit",1,"w-full","px-6","py-3","bg-red-600","text-white","font-semibold","rounded-lg","hover:bg-red-700","hover:-translate-y-0.5","hover:shadow-lg","transition-all","hover:cursor-pointer","disabled:bg-gray-300","disabled:cursor-not-allowed","disabled:hover:translate-y-0","disabled:hover:shadow-none","disabled:opacity-60","cursor-pointer",3,"disabled"]],template:function(e,r){e&1&&(o(0,"section",0)(1,"div",1)(2,"button",2),c("click",function(){return r.toggleSection("nom")}),o(3,"span",3),a(4,"Nom"),n(),o(5,"div",4)(6,"span",5),a(7),n(),w(),o(8,"svg",6),S(9,"polyline",7),n()()(),p(10,ke,8,1,"div",8),n(),C(),o(11,"div",1)(12,"button",2),c("click",function(){return r.toggleSection("email")}),o(13,"span",3),a(14,"Email"),n(),o(15,"div",4)(16,"span",5),a(17),n(),w(),o(18,"svg",6),S(19,"polyline",7),n()()(),p(20,Ie,8,1,"div",8),n(),C(),o(21,"div",1)(22,"button",2),c("click",function(){return r.toggleSection("password")}),o(23,"span",3),a(24,"Mot de passe"),n(),o(25,"div",4)(26,"span",9),a(27,"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"),n(),w(),o(28,"svg",6),S(29,"polyline",7),n()()(),p(30,Be,16,3,"div",8),n(),C(),o(31,"div",10)(32,"button",11),c("click",function(){return r.logout()}),o(33,"span",12),a(34,"Se d\xE9connecter"),n()()(),o(35,"div",1)(36,"button",2),c("click",function(){return r.toggleSection("delete")}),o(37,"span",3),a(38,"Supprimer le compte"),n(),w(),o(39,"svg",6),S(40,"polyline",7),n()(),p(41,Te,12,2,"div",8),n()()),e&2&&(l(7),v(r.nom()),l(),j("rotate-180",r.expandedSection()==="nom"),l(2),u(r.expandedSection()==="nom"?10:-1),l(7),v(r.email()),l(),j("rotate-180",r.expandedSection()==="email"),l(2),u(r.expandedSection()==="email"?20:-1),l(8),j("rotate-180",r.expandedSection()==="password"),l(2),u(r.expandedSection()==="password"?30:-1),l(9),j("rotate-180",r.expandedSection()==="delete"),l(2),u(r.expandedSection()==="delete"?41:-1))},encapsulation:2,changeDetection:0})};var Me=(i,t)=>t.id;function Ve(i,t){i&1&&(o(0,"div",2),S(1,"div",6),n())}function Ne(i,t){if(i&1){let e=y();o(0,"div",3)(1,"p",7),a(2),n(),o(3,"button",8),c("click",function(){b(e);let s=d();return f(s.refresh())}),a(4," R\xE9essayer "),n()()}if(i&2){let e=d();l(2),v(e.errorMessage())}}function De(i,t){i&1&&(o(0,"div",4)(1,"span",9),a(2," calendar_month "),n(),o(3,"p",10),a(4,"Aucun historique pour le moment"),n()())}function Re(i,t){if(i&1&&(o(0,"div",11)(1,"div",12)(2,"div",13)(3,"span",14),a(4," calendar_month "),n()(),o(5,"div",15)(6,"p",16),a(7),n(),o(8,"p",17),a(9),n()(),o(10,"p",18),a(11),n()()()),i&2){let e=t.$implicit,r=d(2);l(7),v(r.formatMonth(e.month)),l(2),v(r.getBoxesText(e.numberOfBoxes)),l(2),B(" ",e.numberOfBoxes," ")}}function Le(i,t){if(i&1&&(o(0,"div",5),k(1,Re,12,3,"div",11,Me),n()),i&2){let e=d();l(),I(e.monthlyHistory())}}var Q=class i{proBorrowService=E(N);monthlyHistory=m([]);isLoading=m(!0);errorMessage=m(null);ngOnInit(){this.loadMonthlyHistory()}loadMonthlyHistory(){this.isLoading.set(!0),this.errorMessage.set(null),this.proBorrowService.getMonthlyHistory(12).subscribe({next:t=>{t.success&&this.monthlyHistory.set(t.history),this.isLoading.set(!1)},error:t=>{console.error("Erreur lors du chargement de l'historique:",t),this.errorMessage.set("Impossible de charger l'historique mensuel"),this.isLoading.set(!1)}})}formatMonth(t){return new Date(t).toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}getBoxesText(t){return t===0?"Aucune bo\xEEte emprunt\xE9e":t===1?"1 bo\xEEte emprunt\xE9e":`${t} bo\xEEtes emprunt\xE9es`}refresh(){this.loadMonthlyHistory()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-pro-historical"]],decls:6,vars:1,consts:[[1,"h-full","overflow-y-auto","pt-16"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"flex","justify-center","items-center","py-12"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","text-center"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-8","text-center"],[1,"space-y-3"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-emerald-600"],[1,"text-red-800"],["type","button",1,"mt-3","px-4","py-2","bg-red-100","hover:bg-red-200","text-red-800","rounded-md","transition-colors",3,"click"],[1,"material-symbols-outlined","text-gray-400","text-6xl","mb-4","block"],[1,"text-gray-600","text-lg"],[1,"bg-white","rounded-lg","p-4","shadow-sm","hover:shadow-md","hover:translate-x-1","transition-all","duration-200","border","border-gray-100"],[1,"flex","items-center","gap-4"],[1,"w-12","h-12","bg-emerald-100","rounded-lg","flex","items-center","justify-center","text-2xl","flex-shrink-0"],[1,"material-symbols-outlined","text-emerald-700"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"text-2xl","font-bold","text-emerald-600","flex-shrink-0"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1),p(2,Ve,2,0,"div",2)(3,Ne,5,1,"div",3)(4,De,5,0,"div",4)(5,Le,3,0,"div",5),n()()),e&2&&(l(2),u(r.isLoading()?2:r.errorMessage()?3:r.monthlyHistory().length===0?4:5))},dependencies:[M],encapsulation:2})};var je=(i,t)=>t.id;function Ge(i,t){i&1&&(o(0,"div",2),S(1,"div",5),o(2,"p",6),a(3,"Chargement de la proposition..."),n()())}function He(i,t){if(i&1){let e=y();o(0,"div",3)(1,"div",7),w(),o(2,"svg",8),S(3,"path",9),n(),C(),o(4,"p",10),a(5),n()(),o(6,"button",11),c("click",function(){b(e);let s=d();return f(s.goBack())}),a(7," Retour "),n()()}if(i&2){let e=d();l(5),v(e.error())}}function $e(i,t){i&1&&(o(0,"span",16),a(1," En attente "),n())}function Ae(i,t){i&1&&(o(0,"span",17),a(1," Valid\xE9 "),n())}function ze(i,t){i&1&&(o(0,"span",18),a(1," Refus\xE9 "),n())}function Oe(i,t){i&1&&(o(0,"span",19),a(1," Expir\xE9 "),n())}function qe(i,t){if(i&1&&(o(0,"div",23)(1,"div",32)(2,"div")(3,"p",33),a(4,"Type de bo\xEEte"),n(),o(5,"p",34),a(6),n()(),o(7,"div",35)(8,"p",33),a(9,"Quantit\xE9"),n(),o(10,"p",36),a(11),n()()()()),i&2){let e=t.$implicit,r=d(2);l(6),v(r.getBoxTypeName(e.type)),l(5),v(e.number)}}function Fe(i,t){if(i&1&&(o(0,"div",24)(1,"div",32)(2,"span",37),a(3,"Total de bo\xEEtes"),n(),o(4,"span",38),a(5),n()()()),i&2){let e=d(2);l(5),v(e.totalBoxes())}}function Ue(i,t){if(i&1){let e=y();o(0,"button",39),c("click",function(){b(e);let s=d(2);return f(s.cancelProposal())}),a(1," Annuler la proposition "),n()}if(i&2){let e=d(2);_("disabled",e.loading())}}function Je(i,t){if(i&1){let e=y();o(0,"button",40),c("click",function(){b(e);let s=d(2);return f(s.goBack())}),a(1," Retour au tableau de bord "),n()}}function We(i,t){if(i&1&&(o(0,"div",4)(1,"div",12)(2,"div",13)(3,"div")(4,"h1",14),a(5),n(),o(6,"p",15),a(7),n()(),p(8,$e,2,0,"span",16),p(9,Ae,2,0,"span",17),p(10,ze,2,0,"span",18),p(11,Oe,2,0,"span",19),n()(),o(12,"div",20)(13,"h2",21),a(14),n(),o(15,"div",22),k(16,qe,12,2,"div",23,je),n(),p(18,Fe,6,1,"div",24),o(19,"div",25)(20,"div",26)(21,"span",27),a(22,"Client"),n(),o(23,"span",28),a(24),n()()()(),o(25,"div",29),p(26,Ue,2,1,"button",30)(27,Je,2,0,"button",31),n()()),i&2){let e=d();l(5),B(" ",e.proposals().length===1?"Proposition envoy\xE9e":e.proposals().length+" propositions envoy\xE9es"," "),l(2),H("\xC0 ",e.userInfo().firstName," ",e.userInfo().lastName),l(),u(e.status()==="pending"?8:-1),l(),u(e.status()==="accepted"?9:-1),l(),u(e.status()==="rejected"?10:-1),l(),u(e.status()==="expired"?11:-1),l(3),B(" ",e.proposals().length===1?"D\xE9tails de la proposition":"D\xE9tails des propositions"," "),l(2),I(e.proposals()),l(2),u(e.proposals().length>1?18:-1),l(6),H(" ",e.userInfo().firstName," ",e.userInfo().lastName," "),l(2),u(e.status()==="pending"&&!e.isExpired()?26:27)}}var K=class i{route=E(A);router=E(V);borrowService=E(N);batchId=m(null);proposals=m([]);userInfo=m(null);status=m("pending");loading=m(!0);error=m(null);timeRemaining=m(3e5);timerInterval=null;pollingInterval=null;minutes=D(()=>Math.floor(this.timeRemaining()/6e4));seconds=D(()=>Math.floor(this.timeRemaining()%6e4/1e3));isExpired=D(()=>this.timeRemaining()<=0);canCancel=D(()=>this.status()==="pending"&&!this.isExpired());totalBoxes=D(()=>this.proposals().reduce((t,e)=>t+e.number,0));ngOnInit(){let t=this.route.snapshot.paramMap.get("id");if(!t){this.error.set("ID de batch manquant"),this.loading.set(!1);return}this.batchId.set(t),this.loadBatchProposals(t)}ngOnDestroy(){this.stopTimer(),this.stopPolling()}loadBatchProposals(t){this.borrowService.getBatchProposals(t).subscribe({next:e=>{if(e.success&&e.proposals){this.proposals.set(e.proposals),this.userInfo.set(e.user);let r=e.proposals[0];r&&(this.timeRemaining.set(r.timeRemaining),r.accepted===!0?(this.status.set("accepted"),this.stopPolling()):r.accepted===!1?(this.status.set("rejected"),this.stopPolling()):r.timeRemaining<=0?(this.status.set("expired"),this.stopPolling()):(this.status.set("pending"),this.startTimer(),this.startPolling(t)))}this.loading.set(!1)},error:e=>{console.error("Erreur lors du chargement du batch:",e),this.error.set("Impossible de charger les propositions"),this.loading.set(!1)}})}startPolling(t){console.log("\u{1F504} D\xE9marrage du polling..."),this.pollingInterval=setInterval(()=>{this.checkBatchStatus(t)},2e3)}stopPolling(){this.pollingInterval&&(console.log("\u23F9\uFE0F Arr\xEAt du polling"),clearInterval(this.pollingInterval),this.pollingInterval=null)}checkBatchStatus(t){this.borrowService.getBatchProposals(t).subscribe({next:e=>{if(e.success&&e.proposals&&e.proposals.length>0){let r=e.proposals[0];this.timeRemaining.set(r.timeRemaining),r.accepted===!0&&this.status()!=="accepted"?(console.log("\u2705 Propositions accept\xE9es !"),this.status.set("accepted"),this.proposals.set(e.proposals),this.stopTimer(),this.stopPolling()):r.accepted===!1&&this.status()!=="rejected"?(console.log("\u274C Propositions rejet\xE9es"),this.status.set("rejected"),this.proposals.set(e.proposals),this.stopTimer(),this.stopPolling()):r.timeRemaining<=0&&this.status()!=="expired"&&(console.log("\u23F0 Propositions expir\xE9es"),this.status.set("expired"),this.proposals.set(e.proposals),this.stopTimer(),this.stopPolling())}},error:e=>{console.error("Erreur lors de la v\xE9rification du statut:",e)}})}startTimer(){this.timerInterval=setInterval(()=>{let t=this.timeRemaining()-1e3;this.timeRemaining.set(Math.max(0,t)),t<=0&&(this.status.set("expired"),this.stopTimer(),this.stopPolling())},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}cancelProposal(){let t=this.proposals();if(t.length===0||!this.canCancel())return;this.loading.set(!0);let e=t[0].id;this.borrowService.cancelProposal(e).subscribe({next:r=>{r.success&&(this.status.set("rejected"),this.stopTimer(),this.stopPolling()),this.loading.set(!1)},error:r=>{console.error("Erreur lors de l'annulation:",r),this.error.set("Erreur lors de l'annulation de la proposition"),this.loading.set(!1)}})}goBack(){this.router.navigate(["/pro/dashboard"])}getBoxTypeName(t){return{1:"Boite Salade Verre",2:"Boite Salade Plastique",3:"Boite Frites",4:"Boite Pizza",5:"Gobelet",6:"Boite Burger"}[t]||`Type ${t}`}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-pro-validation"]],decls:5,vars:3,consts:[[1,"pt-20","bg-gradient-to-br","from-indigo-50","to-purple-50","p-4"],[1,"max-w-3xl","mx-auto","pt-8"],[1,"bg-white","rounded-lg","shadow-lg","p-8","text-center"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-6"],[1,"bg-white","rounded-lg","shadow-lg","overflow-hidden"],[1,"inline-block","animate-spin","rounded-full","h-12","w-12","border-b-2","border-indigo-600"],[1,"mt-4","text-gray-600"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-red-600","mr-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-red-800","font-medium"],[1,"mt-4","px-4","py-2","bg-red-600","text-white","rounded-lg","hover:bg-red-700","transition-colors",3,"click"],[1,"p-6","bg-gradient-to-r","from-indigo-600","to-purple-600","text-white"],[1,"flex","justify-between","items-start"],[1,"text-lg","font-bold"],[1,"mt-1","opacity-90"],[1,"px-4","py-2","bg-white/20","backdrop-blur-sm","rounded-full","font-medium"],[1,"px-4","py-2","bg-green-500","rounded-full","font-medium"],[1,"px-4","py-2","bg-red-500","rounded-full","font-medium"],[1,"px-4","py-2","bg-gray-500","rounded-full","font-medium"],[1,"p-6"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"space-y-3","mb-6"],[1,"bg-gradient-to-br","from-indigo-50","to-purple-50","rounded-lg","p-4"],[1,"bg-indigo-100","border","border-indigo-200","rounded-lg","p-4","mb-6"],[1,"space-y-3","text-sm","border-t","border-gray-200","pt-6"],[1,"flex","justify-between","py-3"],[1,"text-gray-600"],[1,"font-medium","text-gray-900"],[1,"p-6","bg-gray-50","border-t","border-gray-200"],[1,"w-full","px-6","py-3","bg-red-600","text-white","rounded-lg","font-semibold","hover:bg-red-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"disabled"],[1,"w-full","px-6","py-3","bg-gray-600","text-white","rounded-lg","font-semibold","hover:bg-gray-700","transition-colors"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-gray-600"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-right"],[1,"text-3xl","font-bold","text-indigo-600"],[1,"font-semibold","text-indigo-900"],[1,"text-2xl","font-bold","text-indigo-600"],[1,"w-full","px-6","py-3","bg-red-600","text-white","rounded-lg","font-semibold","hover:bg-red-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"w-full","px-6","py-3","bg-gray-600","text-white","rounded-lg","font-semibold","hover:bg-gray-700","transition-colors",3,"click"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1),p(2,Ge,4,0,"div",2),p(3,He,8,1,"div",3),p(4,We,28,12,"div",4),n()()),e&2&&(l(2),u(r.loading()?2:-1),l(),u(r.error()&&!r.loading()?3:-1),l(),u(r.proposals().length>0&&!r.loading()&&!r.error()?4:-1))},dependencies:[M],encapsulation:2})};var ge=(i,t)=>t.id;function Xe(i,t){if(i&1&&(o(0,"div",10)(1,"div",19),w(),o(2,"svg",20),S(3,"path",21),n(),C(),o(4,"p",22),a(5),n()()()),i&2){let e=d();l(5),v(e.error())}}function Qe(i,t){if(i&1){let e=y();o(0,"div",12)(1,"div",23)(2,"img",24),c("error",function(s){return b(e),f(s.target.src="/assets/boxes/box-default.png")}),n()(),o(3,"div",25)(4,"h3",26),a(5),n(),o(6,"div",27)(7,"button",28),c("click",function(){let s=b(e).$implicit,h=d();return f(h.decrement(s.id))}),a(8," \u2212 "),n(),o(9,"div",29)(10,"span",4),a(11),n()(),o(12,"button",30),c("click",function(){let s=b(e).$implicit,h=d();return f(h.increment(s.id))}),a(13," + "),n()()()()}if(i&2){let e=t.$implicit;l(2),_("src",e.image,L)("alt",e.name),l(3),v(e.name),l(2),_("disabled",e.quantity===0),l(4),v(e.quantity)}}function Ke(i,t){i&1&&(o(0,"span",17),w(),o(1,"svg",31),S(2,"circle",32)(3,"path",33),n(),a(4," Envoi en cours... "),n())}function Ye(i,t){i&1&&a(0," Envoyer la proposition ")}function Ze(i,t){if(i&1&&(o(0,"div",36),a(1),o(2,"span",6),a(3),n()()),i&2){let e=d().$implicit;l(),B(" ",e.name," : "),l(2),v(e.quantity)}}function et(i,t){if(i&1&&p(0,Ze,4,2,"div",36),i&2){let e=t.$implicit;u(e.quantity>0?0:-1)}}function tt(i,t){if(i&1&&(o(0,"div",18)(1,"p",34),a(2,"R\xE9capitulatif :"),n(),o(3,"div",35),k(4,et,1,1,null,null,ge),n()()),i&2){let e=d();l(4),I(e.boxTypes())}}var Y=class i{route=E(A);router=E(V);borrowService=E(N);customerCode=m("");boxTypes=m([{id:1,name:"Boite Salade Verre",image:"verre-salade.webp",quantity:0},{id:2,name:"Boite Salade Plastique",image:"plastique-salade.webp",quantity:0},{id:3,name:"Boite Frites",image:"frites.jpg",quantity:0},{id:4,name:"Boite Pizza",image:"pizza.png",quantity:0},{id:5,name:"Gobelet",image:"gobelet.jpg",quantity:0},{id:6,name:"Boite Burger",image:"burger.jpg",quantity:0}]);loading=m(!1);error=m(null);totalBoxes=D(()=>this.boxTypes().reduce((t,e)=>t+e.quantity,0));hasSelection=D(()=>this.totalBoxes()>0);ngOnInit(){let t=this.route.snapshot.queryParamMap.get("code");t?this.customerCode.set(t):this.error.set("Code client manquant")}increment(t){let e=this.boxTypes(),r=e.find(s=>s.id===t);r&&(r.quantity++,this.boxTypes.set([...e]))}decrement(t){let e=this.boxTypes(),r=e.find(s=>s.id===t);r&&r.quantity>0&&(r.quantity--,this.boxTypes.set([...e]))}cancel(){this.router.navigate(["/pro/dashboard"])}submit(){if(!this.hasSelection())return;if(!this.customerCode()){this.error.set("Code client manquant");return}this.loading.set(!0),this.error.set(null);let t=this.boxTypes().filter(e=>e.quantity>0).map(e=>({type:e.id,number:e.quantity}));this.borrowService.createProposal({userCode:this.customerCode(),items:t}).subscribe({next:e=>{e.success&&e.batchId?this.router.navigate(["/pro/borrow/validation",e.batchId]):(this.error.set("Erreur lors de la cr\xE9ation de la proposition"),this.loading.set(!1))},error:e=>{console.error("Erreur lors de la cr\xE9ation de la proposition:",e),this.error.set(e.error?.message||"Erreur lors de la cr\xE9ation de la proposition"),this.loading.set(!1)}})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-pro-selection"]],decls:28,vars:7,consts:[[1,"pt-20","bg-gradient-to-br","from-indigo-50","to-purple-50","p-4"],[1,"max-w-3xl","mx-auto","pt-8"],[1,"bg-white","rounded-lg","shadow-lg","p-6","mb-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600","mt-1"],[1,"font-semibold"],[1,"text-right"],[1,"text-sm","text-gray-600"],[1,"text-3xl","font-bold","text-indigo-600"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","mb-6"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-6"],[1,"bg-white","rounded-lg","shadow-md","overflow-hidden","hover:shadow-lg","transition-shadow"],[1,"bg-white","rounded-lg","shadow-lg","p-6"],[1,"flex","gap-4"],[1,"flex-1","px-6","py-4","bg-white","border-2","border-gray-300","text-gray-700","rounded-lg","font-semibold","hover:bg-gray-50","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"flex-1","px-6","py-4","bg-indigo-600","text-white","rounded-lg","font-semibold","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","shadow-lg",3,"click","disabled"],[1,"flex","items-center","justify-center"],[1,"mt-4","p-4","bg-indigo-50","rounded-lg"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-red-600","mr-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-red-800","font-medium"],[1,"aspect-square","bg-gradient-to-br","from-indigo-100","to-purple-100","flex","items-center","justify-center","p-6"],[1,"w-full","h-full","object-contain",3,"error","src","alt"],[1,"p-4"],[1,"font-semibold","text-gray-900","text-center","mb-3"],[1,"flex","items-center","justify-center","gap-3"],[1,"w-10","h-10","rounded-full","bg-red-100","text-red-600","hover:bg-red-200","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors","flex","items-center","justify-center","font-bold","text-xl",3,"click","disabled"],[1,"w-16","text-center"],[1,"w-10","h-10","rounded-full","bg-green-100","text-green-600","hover:bg-green-200","transition-colors","flex","items-center","justify-center","font-bold","text-xl",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-sm","text-indigo-900","font-medium","mb-2"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-2"],[1,"text-sm","text-indigo-700"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"h1",4),a(6,"S\xE9lection des bo\xEEtes"),n(),o(7,"p",5),a(8,"Code client : "),o(9,"span",6),a(10),n()()(),o(11,"div",7)(12,"p",8),a(13,"Total s\xE9lectionn\xE9"),n(),o(14,"p",9),a(15),n()()()(),p(16,Xe,6,1,"div",10),o(17,"div",11),k(18,Qe,14,5,"div",12,ge),n(),o(20,"div",13)(21,"div",14)(22,"button",15),c("click",function(){return r.cancel()}),a(23," Annuler "),n(),o(24,"button",16),c("click",function(){return r.submit()}),p(25,Ke,5,0,"span",17)(26,Ye,1,0),n()(),p(27,tt,6,0,"div",18),n()()()),e&2&&(l(10),v(r.customerCode()),l(5),v(r.totalBoxes()),l(),u(r.error()?16:-1),l(2),I(r.boxTypes()),l(4),_("disabled",r.loading()),l(2),_("disabled",!r.hasSelection()||r.loading()),l(),u(r.loading()?25:26),l(2),u(r.hasSelection()?27:-1))},dependencies:[M],encapsulation:2})};var Z=class i{http=E($);apiUrl=`${z.apiUrl}/give-back`;getUserBorrows(t){return this.http.get(`${this.apiUrl}/user-borrows/${t}`,{withCredentials:!0})}recordGiveBack(t,e){return this.http.post(`${this.apiUrl}/record`,{userCode:t,items:e},{withCredentials:!0})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=G({token:i,factory:i.\u0275fac,providedIn:"root"})};var xe=(i,t)=>t.type;function it(i,t){i&1&&(o(0,"div",2)(1,"div",4),S(2,"div",5),o(3,"p",6),a(4,"Chargement des bo\xEEtes emprunt\xE9es..."),n()()())}function ot(i,t){if(i&1){let e=y();o(0,"div",3)(1,"div",7)(2,"div",8),w(),o(3,"svg",9),S(4,"path",10),n(),C(),o(5,"p",11),a(6),n()()(),o(7,"button",12),c("click",function(){b(e);let s=d();return f(s.cancel())}),a(8," Retour au dashboard "),n()()}if(i&2){let e=d();l(6),v(e.errorMessage())}}function nt(i,t){if(i&1){let e=y();o(0,"div",4)(1,"div",24),w(),o(2,"svg",25),S(3,"path",26),n(),C(),o(4,"p",27),a(5,"Aucune bo\xEEte emprunt\xE9e"),n(),o(6,"p",28),a(7,"Ce client n'a pas de bo\xEEtes \xE0 retourner"),n(),o(8,"button",29),c("click",function(){b(e);let s=d(2);return f(s.cancel())}),a(9," Retour au dashboard "),n()()()}}function rt(i,t){if(i&1){let e=y();o(0,"div",31)(1,"div",38)(2,"img",39),c("error",function(s){return b(e),f(s.target.src="/assets/boxes/box-default.png")}),n()(),o(3,"div",40)(4,"h3",41),a(5),n(),o(6,"div",42)(7,"p",43),a(8," Emprunt\xE9es : "),o(9,"span",18),a(10),n()()(),o(11,"div",44)(12,"button",45),c("click",function(){let s=b(e).$implicit,h=d(3);return f(h.decrementSelection(s))}),a(13," \u2212 "),n(),o(14,"div",46)(15,"input",47),c("input",function(s){let h=b(e).$implicit,be=d(3);return f(be.onInputChange(h,s.target.value))}),n()(),o(16,"button",48),c("click",function(){let s=b(e).$implicit,h=d(3);return f(h.incrementSelection(s))}),a(17," + "),n()()()()}if(i&2){let e=t.$implicit,r=d(3);l(2),_("src",r.getBoxImage(e.type),L)("alt",e.label),l(3),v(e.label),l(5),v(e.maxNumber),l(2),_("disabled",e.selectedNumber===0),l(3),_("value",e.selectedNumber)("max",e.maxNumber),l(),_("disabled",e.selectedNumber>=e.maxNumber)}}function at(i,t){i&1&&(o(0,"span",36),w(),o(1,"svg",49),S(2,"circle",50)(3,"path",51),n(),a(4," Enregistrement... "),n())}function lt(i,t){i&1&&a(0," Valider le retour ")}function st(i,t){if(i&1&&(o(0,"div",57)(1,"span",58),a(2),n(),o(3,"span",59),a(4),n()()),i&2){let e=d().$implicit;l(2),v(e.label),l(2),B(" ",e.selectedNumber," bo\xEEte(s) ")}}function dt(i,t){if(i&1&&p(0,st,5,2,"div",57),i&2){let e=t.$implicit;u(e.selectedNumber>0?0:-1)}}function mt(i,t){if(i&1&&(o(0,"div",37)(1,"p",52),a(2,"R\xE9capitulatif :"),n(),o(3,"div",16),k(4,dt,1,1,null,null,xe),o(6,"div",53)(7,"div",54)(8,"span",55),a(9,"Total"),n(),o(10,"span",56),a(11),n()()()()()),i&2){let e=d(3);l(4),I(e.boxSelections()),l(7),B("",e.getTotalSelectedBoxes()," bo\xEEte(s)")}}function ct(i,t){if(i&1){let e=y();o(0,"div",30),k(1,rt,18,8,"div",31,xe),n(),o(3,"div",32)(4,"div",33)(5,"button",34),c("click",function(){b(e);let s=d(2);return f(s.cancel())}),a(6," Annuler "),n(),o(7,"button",35),c("click",function(){b(e);let s=d(2);return f(s.validateReturn())}),p(8,at,5,0,"span",36)(9,lt,1,0),n()(),p(10,mt,12,1,"div",37),n()}if(i&2){let e=d(2);l(),I(e.boxSelections()),l(4),_("disabled",e.isSubmitting()),l(2),_("disabled",!e.hasSelection()||e.isSubmitting()),l(),u(e.isSubmitting()?8:9),l(2),u(e.hasSelection()?10:-1)}}function pt(i,t){if(i&1&&(o(0,"div",3)(1,"div",13)(2,"div",14)(3,"h1",15),a(4,"Retour de bo\xEEtes"),n(),o(5,"div",16)(6,"p",17),a(7," Client : "),o(8,"span",18),a(9),n()(),o(10,"p",19),a(11),n(),o(12,"p",20),a(13," Code : "),o(14,"span",21),a(15),n()()()(),o(16,"div",22)(17,"p",20),a(18,"Bo\xEEtes \xE0 retourner"),n(),o(19,"p",23),a(20),n()()()(),p(21,nt,10,0,"div",4)(22,ct,11,4)),i&2){let e=d();l(9),v(e.userName()),l(2),v(e.userEmail()),l(4),v(e.userCode()),l(5),v(e.getTotalSelectedBoxes()),l(),u(e.borrowedBoxes().length===0?21:22)}}var ee=class i{route=E(A);router=E(V);giveBackService=E(Z);userCode=m("");userName=m("");userEmail=m("");borrowedBoxes=m([]);boxSelections=m([]);isLoading=m(!0);isSubmitting=m(!1);errorMessage=m("");boxTypeImages={1:"verre-salade.webp",2:"plastique-salade.webp",3:"frites.jpg",4:"pizza.png",5:"gobelet.jpg",6:"burger.jpg"};ngOnInit(){this.route.queryParams.subscribe(t=>{let e=t.code;e?(this.userCode.set(e),this.loadUserBorrows(e)):(this.errorMessage.set("Code utilisateur manquant"),this.isLoading.set(!1))})}loadUserBorrows(t){this.isLoading.set(!0),this.errorMessage.set(""),this.giveBackService.getUserBorrows(t).subscribe({next:e=>{if(e.success){this.userName.set(`${e.user.firstName} ${e.user.lastName}`),this.userEmail.set(e.user.email),this.borrowedBoxes.set(e.borrows);let r=e.borrows.map(s=>({type:s.type,label:s.label,maxNumber:s.totalNumber,selectedNumber:0}));this.boxSelections.set(r)}this.isLoading.set(!1)},error:e=>{console.error("Erreur lors du chargement des bo\xEEtes:",e),this.errorMessage.set(e.error?.message||"Erreur lors du chargement des bo\xEEtes emprunt\xE9es"),this.isLoading.set(!1)}})}getBoxImage(t){return this.boxTypeImages[t]||"default-box.png"}incrementSelection(t){t.selectedNumber<t.maxNumber&&(t.selectedNumber++,this.updateSelections())}decrementSelection(t){t.selectedNumber>0&&(t.selectedNumber--,this.updateSelections())}onInputChange(t,e){let r=parseInt(e)||0;t.selectedNumber=Math.min(Math.max(0,r),t.maxNumber),this.updateSelections()}updateSelections(){this.boxSelections.set([...this.boxSelections()])}getTotalSelectedBoxes(){return this.boxSelections().reduce((t,e)=>t+e.selectedNumber,0)}hasSelection(){return this.getTotalSelectedBoxes()>0}validateReturn(){if(!this.hasSelection())return;let t=this.boxSelections().filter(e=>e.selectedNumber>0).map(e=>({type:e.type,number:e.selectedNumber}));this.isSubmitting.set(!0),this.errorMessage.set(""),this.giveBackService.recordGiveBack(this.userCode(),t).subscribe({next:e=>{e.success&&this.router.navigate(["/pro/dashboard"]),this.isSubmitting.set(!1)},error:e=>{console.error("Erreur lors de l'enregistrement du retour:",e),this.errorMessage.set(e.error?.message||"Erreur lors de l'enregistrement du retour"),this.isSubmitting.set(!1)}})}cancel(){this.router.navigate(["/pro/dashboard"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-pro-give-back-validation"]],decls:5,vars:1,consts:[[1,"pt-20","bg-gradient-to-br","from-emerald-50","to-teal-50","p-4"],[1,"max-w-3xl","mx-auto","pt-8"],[1,"flex","justify-center","items-center","py-12"],[1,"bg-white","rounded-lg","shadow-lg","p-6","mb-6"],[1,"bg-white","rounded-lg","shadow-lg","p-8"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-emerald-600","mx-auto","mb-4"],[1,"text-gray-600","text-center"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","mb-6"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-red-600","mr-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-red-800","font-medium"],[1,"w-full","px-6","py-4","bg-white","border-2","border-gray-300","text-gray-700","rounded-lg","font-semibold","hover:bg-gray-50","transition-colors",3,"click"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"space-y-1"],[1,"text-gray-600"],[1,"font-semibold","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"text-sm","text-gray-600"],[1,"font-semibold"],[1,"text-right"],[1,"text-3xl","font-bold","text-emerald-600"],[1,"text-center","py-8"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-24","h-24","text-gray-300","mx-auto","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"],[1,"text-gray-600","font-medium","text-lg","mb-2"],[1,"text-sm","text-gray-500","mb-6"],[1,"px-6","py-3","bg-gray-600","hover:bg-gray-700","text-white","rounded-lg","font-semibold","transition-colors",3,"click"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-6"],[1,"bg-white","rounded-lg","shadow-md","overflow-hidden","hover:shadow-lg","transition-shadow"],[1,"bg-white","rounded-lg","shadow-lg","p-6"],[1,"flex","gap-4"],[1,"flex-1","px-6","py-4","bg-white","border-2","border-gray-300","text-gray-700","rounded-lg","font-semibold","hover:bg-gray-50","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"flex-1","px-6","py-4","bg-emerald-600","text-white","rounded-lg","font-semibold","hover:bg-emerald-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","shadow-lg",3,"click","disabled"],[1,"flex","items-center","justify-center"],[1,"mt-4","p-4","bg-emerald-50","rounded-lg"],[1,"aspect-square","bg-gradient-to-br","from-emerald-100","to-teal-100","flex","items-center","justify-center","p-6"],[1,"w-full","h-full","object-contain",3,"error","src","alt"],[1,"p-4"],[1,"font-semibold","text-gray-900","text-center","mb-3"],[1,"bg-gray-50","rounded-lg","p-2","mb-3"],[1,"text-xs","text-gray-600","text-center"],[1,"flex","items-center","justify-center","gap-3"],[1,"w-10","h-10","rounded-full","bg-red-100","text-red-600","hover:bg-red-200","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors","flex","items-center","justify-center","font-bold","text-xl",3,"click","disabled"],[1,"w-16","text-center"],["type","number","min","0",1,"w-full","text-center","text-2xl","font-bold","text-gray-900","bg-transparent","border-none","focus:outline-none",3,"input","value","max"],[1,"w-10","h-10","rounded-full","bg-green-100","text-green-600","hover:bg-green-200","disabled:opacity-30","disabled:cursor-not-allowed","transition-colors","flex","items-center","justify-center","font-bold","text-xl",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-sm","text-emerald-900","font-medium","mb-2"],[1,"border-t","border-emerald-200","pt-2","mt-2"],[1,"flex","justify-between","items-center"],[1,"font-bold","text-emerald-900"],[1,"font-bold","text-emerald-600","text-lg"],[1,"flex","justify-between","items-center","text-sm"],[1,"text-emerald-700"],[1,"font-semibold","text-emerald-900"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1),p(2,it,5,0,"div",2)(3,ot,9,1,"div",3)(4,pt,23,5),n()()),e&2&&(l(2),u(r.isLoading()?2:r.errorMessage()?3:4))},dependencies:[M,F],encapsulation:2})};var Ni=[{path:"",component:U,children:[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",component:W},{path:"parametres",component:X},{path:"historique",component:Q},{path:"borrow/validation/:id",component:K},{path:"borrow/select",component:Y},{path:"give-back/validate",component:ee}]}];export{Ni as PRO_ROUTES};
