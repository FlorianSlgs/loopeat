import{a as M,b as y,c as F,d as N,f as I,g as V,h as k,i as T,k as D}from"./chunk-N7OUXL7M.js";import{B as S,Ia as P,J as m,K as c,Ka as _,L as $,M as q,N as K,O as u,P as o,Pa as E,Q as n,Qa as C,R as g,S as z,T as B,U as Q,V as W,X as v,Z as x,ca as b,da as G,ea as a,ga as h,l as d,m as H,n as O,na as Z,o as L,r as p,sa as J,y as s}from"./chunk-6W4ZNQTC.js";function re(r,i){r&1&&(z(0,"span",4),a(1," Espace Pro "),B())}var w=class r{isPro=J(!1);static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["app-header"]],inputs:{isPro:[1,"isPro"]},decls:5,vars:1,consts:[[1,"top-0","left-0","right-0","z-[1500]","flex","justify-center","items-center"],["href","/",1,"mt-2","flex","items-center"],[1,"flex","items-center","space-x-2"],["src","logo.jpg","alt","logo loop-eat",1,"h-22","w-auto"],[1,"text-sm","font-medium","text-gray-700","bg-gray-100","px-3","py-1","rounded-full"]],template:function(t,e){t&1&&(z(0,"header",0)(1,"a",1)(2,"div",2),Q(3,"img",3),m(4,re,2,0,"span",4),B()()()),t&2&&(s(4),c(e.isPro()?4:-1))},encapsulation:2})};function oe(r,i){r&1&&(o(0,"p",6),a(1," Veuillez saisir une adresse email valide. "),n())}function ne(r,i){if(r&1&&(o(0,"p",6),a(1),n()),r&2){let t=x();s(),h(" ",t.errorMessage()," ")}}var X=class r{fb=d(T);router=d(_);route=d(P);authService=d(E);authStateService=d(C);isSubmitting=p(!1);submitAttempted=p(!1);errorMessage=p("");isPro=p(!1);loginForm=this.fb.group({email:["",[y.required,y.email]]});ngOnInit(){this.isPro.set(this.route.snapshot.data.isPro||!1)}isFieldInvalid(){let i=this.loginForm.get("email");return!!(i?.invalid&&(i?.touched||this.submitAttempted()))}isFormValid(){return this.loginForm.valid}getButtonClasses(){let i="w-92 font-medium py-4 px-6 rounded-lg transition-all duration-200 text-lg";return!this.loginForm.valid||this.isSubmitting()?`${i} bg-gray-300 text-gray-500 cursor-not-allowed opacity-60`:`${i} bg-black text-white cursor-pointer hover:bg-gray-800 active:scale-98`}handleSubmit(){if(console.log("\u{1F680} === D\xC9BUT HANDLESUBMIT ==="),this.submitAttempted.set(!0),this.errorMessage.set(""),!this.loginForm.valid){console.log("\u274C Formulaire invalide");return}this.isSubmitting.set(!0);let i=this.loginForm.get("email")?.value,t=this.isPro();console.log("\u{1F4E7} Email extrait:",i),console.log("\u{1F3E2} Mode Pro:",t),this.authService.checkEmail(i,t).subscribe({next:e=>{console.log("\u2705 === R\xC9PONSE RE\xC7UE ==="),console.log("\u{1F4E6} R\xE9ponse compl\xE8te:",e),this.authStateService.setEmailCheckResult(i,e.exists,e.requirePassword||!1,e.requireVerification||!1,t);let l=t?"/connexion-pro":"/connexion";e.exists&&e.verified&&e.requirePassword?(console.log("\u{1F511} Navigation vers mot-de-passe (utilisateur existant v\xE9rifi\xE9)"),this.router.navigate([`${l}/mot-de-passe`])):e.exists&&!e.verified&&e.requireVerification?(console.log("\u{1F504} Inscription incompl\xE8te d\xE9tect\xE9e - Renvoi du code de v\xE9rification"),this.router.navigate([`${l}/verification`])):!e.exists&&e.requireVerification?(console.log("\u{1F4E8} Nouvel utilisateur - Navigation vers v\xE9rification"),this.router.navigate([`${l}/verification`])):e.exists&&e.requireVerification?(console.log("\u{1F504} Inscription en cours - Navigation vers v\xE9rification"),this.router.navigate([`${l}/verification`])):(console.log("\u26A0\uFE0F Cas non g\xE9r\xE9:",e),this.errorMessage.set("\xC9tat inattendu. Veuillez r\xE9essayer.")),this.isSubmitting.set(!1)},error:e=>{console.error("\u274C === ERREUR D\xC9TECT\xC9E ==="),console.error("\u{1F4E6} Erreur compl\xE8te:",e);let l="Une erreur est survenue. Veuillez r\xE9essayer.";e.error&&typeof e.error=="object"?l=e.error.message||l:e.error&&typeof e.error=="string"&&(l=e.error),this.errorMessage.set(l),this.isSubmitting.set(!1)}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["app-email-step"]],decls:12,vars:14,consts:[[3,"isPro"],[1,"flex","items-center","justify-center","py-8","px-4"],[1,"w-92","max-w-md","space-y-6"],[1,"text-2xl","md:text-3xl","font-normal","text-center","text-gray-900"],[1,"space-y-4",3,"ngSubmit","formGroup"],["type","text","formControlName","email","placeholder","Saisissez une adresse email",1,"w-92","px-4","py-3","bg-gray-100","border-0","rounded-lg","text-gray-900","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-gray-900","transition-all"],[1,"text-red-500","text-sm","mt-1"],["type","submit",3,"disabled"]],template:function(t,e){t&1&&(g(0,"app-header",0),o(1,"div",1)(2,"div",2)(3,"p",3),a(4," Indiquez votre adresse email "),n(),o(5,"form",4),v("ngSubmit",function(){return e.handleSubmit()}),o(6,"div"),g(7,"input",5),n(),m(8,oe,2,0,"p",6),m(9,ne,2,1,"p",6),o(10,"button",7),a(11),n()()()()),t&2&&(u("isPro",e.isPro()),s(5),u("formGroup",e.loginForm),s(2),b("border-red-500",e.isFieldInvalid()||e.errorMessage())("ring-2",e.isFieldInvalid()||e.errorMessage())("ring-red-500",e.isFieldInvalid()||e.errorMessage()),s(),c(e.isFieldInvalid()?8:-1),s(),c(e.errorMessage()?9:-1),s(),G(e.getButtonClasses()),u("disabled",!e.loginForm.valid||e.isSubmitting()),s(),h(" ",e.isSubmitting()?"Traitement...":"Continuer"," "))},dependencies:[D,I,M,F,N,V,k,w],encapsulation:2,changeDetection:0})};var se=()=>[0,1,2,3];function ae(r,i){if(r&1){let t=W();o(0,"input",15),v("input",function(l){let f=H(t).$implicit,R=x();return O(R.onInput(l,f))})("keydown",function(l){let f=H(t).$implicit,R=x();return O(R.onKeyDown(l,f))}),n()}if(r&2){let t=i.$implicit,e=x();b("border-gray-300",!e.errorMessage())("focus:ring-gray-900",!e.errorMessage())("border-red-500",e.errorMessage())("ring-2",e.errorMessage())("ring-red-500",e.errorMessage()),u("value",e.code[t])("disabled",e.isVerifying())}}function le(r,i){if(r&1&&(o(0,"p",6),a(1),n()),r&2){let t=x();s(),h(" ",t.errorMessage()," ")}}function de(r,i){r&1&&(o(0,"p",7),a(1," V\xE9rification en cours... "),n())}var Y=class r{router=d(_);authService=d(E);authStateService=d(C);code=["","","",""];currentEmail=p("");isVerifying=p(!1);errorMessage=p("");isCodeVerified=p(!1);isPro=p(!1);ngOnInit(){let i=this.authStateService.getCurrentEmail(),t=this.authStateService.getIsPro();if(!i){this.router.navigate([t?"/connexion-pro":"/connexion"]);return}this.currentEmail.set(i),this.isPro.set(t),console.log("\u{1F510} Verification Step - Email:",i),console.log("\u{1F510} Verification Step - Mode:",t?"PRO":"USER")}onInput(i,t){let e=i.target,f=e.value.replace(/[^0-9]/g,"");f.length>1?e.value=f.slice(-1):e.value=f,this.code[t]=e.value,this.errorMessage.set(""),e.value&&t<3&&e.nextElementSibling?.focus(),this.isCodeComplete()&&t===3&&!this.isVerifying()&&!this.isCodeVerified()&&this.verifyCode()}onKeyDown(i,t){let e=i.target;i.key==="Backspace"&&!e.value&&t>0&&e.previousElementSibling?.focus()}isCodeComplete(){return this.code.every(i=>i!=="")}verifyCode(){if(this.isVerifying()||this.isCodeVerified()){console.log("\u26A0\uFE0F V\xE9rification d\xE9j\xE0 en cours ou code d\xE9j\xE0 v\xE9rifi\xE9");return}if(!this.isCodeComplete()){this.errorMessage.set("Veuillez saisir les 4 chiffres du code");return}let i=this.code.join(""),t=this.currentEmail(),e=this.isPro();if(!t){this.errorMessage.set("Email non trouv\xE9. Veuillez recommencer.");let l=e?"/connexion-pro":"/connexion";this.router.navigate([l]);return}console.log("\u{1F50D} D\xE9but v\xE9rification du code:",i),console.log("\u{1F3E2} Mode:",e?"PRO":"USER"),this.isVerifying.set(!0),this.errorMessage.set(""),this.authService.verifyCode(t,i,e).subscribe({next:l=>{if(console.log("\u2705 Code v\xE9rifi\xE9:",l),this.isVerifying.set(!1),this.isCodeVerified.set(!0),l.success&&l.verified){let f=e?"/connexion-pro":"/connexion";console.log(`\u{1F4DD} Redirection vers ${f}/nom`),this.router.navigate([`${f}/nom`])}else this.errorMessage.set(l.message||"Code invalide"),this.isCodeVerified.set(!1),this.clearCode()},error:l=>{console.error("\u274C Erreur de v\xE9rification:",l),this.isVerifying.set(!1),this.isCodeVerified.set(!1);let f="Code invalide. Veuillez r\xE9essayer.";l.error&&typeof l.error=="object"&&(f=l.error.message||f),this.errorMessage.set(f),this.clearCode()}})}clearCode(){this.code=["","","",""],setTimeout(()=>{document.querySelector('input[type="text"]')?.focus()},100)}resendCode(){let i=this.currentEmail(),t=this.isPro();if(!i){this.errorMessage.set("Email non trouv\xE9. Veuillez recommencer.");return}this.isCodeVerified.set(!1),console.log("\u{1F4E8} Renvoi du code pour:",i,t?"(PRO)":"(USER)"),this.authService.checkEmail(i,t).subscribe({next:e=>{console.log("\u2705 Code renvoy\xE9"),this.errorMessage.set(""),alert("Un nouveau code a \xE9t\xE9 envoy\xE9 \xE0 votre adresse email"),this.clearCode()},error:e=>{console.error("\u274C Erreur lors du renvoi:",e),this.errorMessage.set("Erreur lors du renvoi du code")}})}goBack(){let i=this.isPro()?"/connexion-pro":"/connexion";this.authStateService.clearState(),this.router.navigate([i])}goNext(){this.verifyCode()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["app-verification-step"]],decls:25,vars:9,consts:[[3,"isPro"],[1,"flex","flex-col","items-center","justify-center","text-center","space-y-6","p-4"],[1,"text-2xl","font-semibold","text-gray-900"],[1,"text-lg","font-bold","text-gray-900","mt-1"],[1,"flex","justify-center","space-x-4","mt-4"],["type","text","inputmode","numeric","maxlength","1",1,"w-14","h-14","text-center","text-2xl","font-medium","border","rounded-lg","focus:outline-none","focus:ring-2","transition-all",3,"border-gray-300","focus:ring-gray-900","border-red-500","ring-2","ring-red-500","value","disabled"],[1,"text-red-500","text-sm","mt-2"],[1,"text-gray-600","text-sm","mt-2"],[1,"text-sm","text-gray-500","max-w-sm","mt-2"],["type","button",1,"mt-4","px-6","py-2","bg-gray-100","text-gray-900","rounded-lg","hover:bg-gray-200","transition","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"flex","justify-between","items-center","w-full","max-w-xs","mt-8"],["type","button",1,"flex","items-center","px-4","py-2","text-gray-700","rounded-lg","hover:bg-gray-100","transition","disabled:opacity-50","hover:curser-pointer",3,"click","disabled"],[1,"text-2xl","mr-1"],["type","button",1,"flex","items-center","px-4","py-2","bg-gray-900","text-white","rounded-lg","hover:bg-gray-800","transition","disabled:opacity-50","disabled:cursor-not-allowed","hover:curser-pointer",3,"click","disabled"],[1,"text-2xl","ml-1"],["type","text","inputmode","numeric","maxlength","1",1,"w-14","h-14","text-center","text-2xl","font-medium","border","rounded-lg","focus:outline-none","focus:ring-2","transition-all",3,"input","keydown","value","disabled"]],template:function(t,e){t&1&&(g(0,"app-header",0),o(1,"div",1)(2,"div")(3,"h2",2),a(4," Saisissez le code \xE0 4 chiffres envoy\xE9 \xE0 : "),n(),o(5,"p",3),a(6),n()(),o(7,"div",4),q(8,ae,1,12,"input",5,$),n(),m(10,le,2,1,"p",6),m(11,de,2,0,"p",7),o(12,"p",8),a(13," Conseil : v\xE9rifiez votre bo\xEEte de r\xE9ception et le dossier des courriers ind\xE9sirables "),n(),o(14,"button",9),v("click",function(){return e.resendCode()}),a(15," Renvoyer le code "),n(),o(16,"div",10)(17,"button",11),v("click",function(){return e.goBack()}),o(18,"span",12),a(19,"\u2190"),n(),a(20," Retour "),n(),o(21,"button",13),v("click",function(){return e.goNext()}),a(22),o(23,"span",14),a(24,"\u2192"),n()()()()),t&2&&(u("isPro",e.isPro()),s(6),h(" ",e.currentEmail()," "),s(2),K(Z(8,se)),s(2),c(e.errorMessage()?10:-1),s(),c(e.isVerifying()?11:-1),s(3),u("disabled",e.isVerifying()),s(3),u("disabled",e.isVerifying()),s(4),u("disabled",!e.isCodeComplete()||e.isVerifying()),s(),h(" ",e.isVerifying()?"V\xE9rification...":"Suivant"," "))},dependencies:[w],encapsulation:2,changeDetection:0})};function me(r,i){r&1&&a(0," Quel est le nom de votre \xE9tablissement ? ")}function ce(r,i){r&1&&a(0," Quel est votre nom ? ")}function ue(r,i){r&1&&(o(0,"p",11),a(1," Veuillez saisir un nom d'\xE9tablissement valide (minimum 2 caract\xE8res). "),n())}function pe(r,i){if(r&1&&(o(0,"div"),g(1,"input",10),m(2,ue,2,0,"p",11),n()),r&2){let t=x();s(),b("border-red-500",t.isFieldInvalid("name"))("ring-2",t.isFieldInvalid("name"))("ring-red-500",t.isFieldInvalid("name")),s(),c(t.isFieldInvalid("name")?2:-1)}}function ge(r,i){r&1&&(o(0,"p",11),a(1," Veuillez saisir un pr\xE9nom valide (minimum 2 caract\xE8res). "),n())}function fe(r,i){r&1&&(o(0,"p",11),a(1," Veuillez saisir un nom valide (minimum 2 caract\xE8res). "),n())}function ve(r,i){if(r&1&&(o(0,"div"),g(1,"input",12),m(2,ge,2,0,"p",11),n(),o(3,"div"),g(4,"input",13),m(5,fe,2,0,"p",11),n()),r&2){let t=x();s(),b("border-red-500",t.isFieldInvalid("firstName"))("ring-2",t.isFieldInvalid("firstName"))("ring-red-500",t.isFieldInvalid("firstName")),s(),c(t.isFieldInvalid("firstName")?2:-1),s(2),b("border-red-500",t.isFieldInvalid("lastName"))("ring-2",t.isFieldInvalid("lastName"))("ring-red-500",t.isFieldInvalid("lastName")),s(),c(t.isFieldInvalid("lastName")?5:-1)}}function he(r,i){if(r&1&&(o(0,"p",4),a(1),n()),r&2){let t=x();s(),h(" ",t.errorMessage()," ")}}var ee=class r{fb=d(T);router=d(_);route=d(P);authService=d(E);authStateService=d(C);nameForm;isSubmitting=p(!1);errorMessage=p("");isPro=p(!1);constructor(){this.nameForm=this.fb.group({})}ngOnInit(){let i=this.authStateService.getCurrentEmail(),t=this.authStateService.getIsPro();if(!i){console.warn("\u26A0\uFE0F Pas d'email en m\xE9moire, redirection vers /connexion"),this.router.navigate([t?"/connexion-pro":"/connexion"]);return}this.isPro.set(t),t?this.nameForm=this.fb.group({name:["",[y.required,y.minLength(2)]]}):this.nameForm=this.fb.group({firstName:["",[y.required,y.minLength(2)]],lastName:["",[y.required,y.minLength(2)]]})}isFieldInvalid(i){let t=this.nameForm.get(i);return!!(t&&t.invalid&&t.touched)}goBack(){let i=this.isPro()?"/connexion-pro":"/connexion";this.router.navigate([`${i}/verification`])}goNext(){if(!this.nameForm.valid){Object.keys(this.nameForm.controls).forEach(e=>{this.nameForm.get(e)?.markAsTouched()});return}this.isSubmitting.set(!0),this.errorMessage.set("");let i=this.isPro(),t;if(i){let{name:e}=this.nameForm.value;t={name:e.trim()},console.log("\u{1F3E2} Sauvegarde du nom d'\xE9tablissement"),console.log("\u{1F4E6} Nom:",e)}else{let{firstName:e,lastName:l}=this.nameForm.value;t={first_name:e.trim(),last_name:l.trim()},console.log("\u{1F464} Sauvegarde des informations utilisateur"),console.log("\u{1F4E6} Pr\xE9nom:",e),console.log("\u{1F4E6} Nom:",l)}this.authService.saveUserInfo(t,i).subscribe({next:e=>{if(console.log("\u2705 Informations sauvegard\xE9es:",e),this.isSubmitting.set(!1),e.success){let l=i?"/connexion-pro":"/connexion";console.log(`\u{1F510} Redirection vers ${l}/mdp`),this.router.navigate([`${l}/mdp`])}else this.errorMessage.set(e.message||"Erreur lors de la sauvegarde")},error:e=>{console.error("\u274C Erreur lors de la sauvegarde:",e),this.isSubmitting.set(!1);let l="Une erreur est survenue. Veuillez r\xE9essayer.";e.error&&typeof e.error=="object"&&(l=e.error.message||l),this.errorMessage.set(l)}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["app-name-step"]],decls:19,vars:8,consts:[[3,"isPro"],[1,"flex","flex-col","items-center","justify-center","text-center","space-y-6","p-4"],[1,"text-2xl","font-semibold","text-gray-900"],[1,"w-full","max-w-md","space-y-4",3,"formGroup"],[1,"text-red-500","text-sm","mt-2"],[1,"flex","justify-between","items-center","w-full","max-w-md","mt-8"],["type","button",1,"flex","items-center","px-4","py-2","text-gray-700","rounded-lg","hover:bg-gray-100","transition","disabled:opacity-50","hover:curser-pointer",3,"click","disabled"],[1,"text-2xl","mr-1"],["type","button",1,"flex","items-center","px-4","py-2","bg-gray-900","text-white","rounded-lg","hover:bg-gray-800","transition","disabled:bg-gray-400","disabled:cursor-not-allowed","hover:curser-pointer",3,"click","disabled"],[1,"text-2xl","ml-1"],["type","text","formControlName","name","placeholder","Nom de l'\xE9tablissement",1,"w-full","px-4","py-3","bg-gray-100","border-0","rounded-lg","text-gray-900","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-gray-900","transition-all"],[1,"text-red-500","text-sm","mt-1","text-left"],["type","text","formControlName","firstName","placeholder","Pr\xE9nom",1,"w-full","px-4","py-3","bg-gray-100","border-0","rounded-lg","text-gray-900","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-gray-900","transition-all"],["type","text","formControlName","lastName","placeholder","Nom",1,"w-full","px-4","py-3","bg-gray-100","border-0","rounded-lg","text-gray-900","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-gray-900","transition-all"]],template:function(t,e){t&1&&(g(0,"app-header",0),o(1,"div",1)(2,"div")(3,"h2",2),m(4,me,1,0)(5,ce,1,0),n()(),o(6,"form",3),m(7,pe,3,7,"div")(8,ve,6,14),m(9,he,2,1,"p",4),n(),o(10,"div",5)(11,"button",6),v("click",function(){return e.goBack()}),o(12,"span",7),a(13,"\u2190"),n(),a(14," Retour "),n(),o(15,"button",8),v("click",function(){return e.goNext()}),a(16),o(17,"span",9),a(18,"\u2192"),n()()()()),t&2&&(u("isPro",e.isPro()),s(4),c(e.isPro()?4:5),s(2),u("formGroup",e.nameForm),s(),c(e.isPro()?7:8),s(2),c(e.errorMessage()?9:-1),s(2),u("disabled",e.isSubmitting()),s(4),u("disabled",e.isSubmitting()),s(),h(" ",e.isSubmitting()?"Traitement...":"Suivant"," "))},dependencies:[D,I,M,F,N,V,k,w],encapsulation:2,changeDetection:0})};function xe(r,i){r&1&&(L(),o(0,"svg",8),g(1,"path",23),n())}function ye(r,i){r&1&&(L(),o(0,"svg",8),g(1,"path",24)(2,"path",25),n())}function be(r,i){r&1&&(o(0,"p"),a(1,"Le mot de passe est requis."),n())}function Se(r,i){r&1&&(o(0,"p"),a(1,"Le mot de passe doit contenir au moins 8 caract\xE8res."),n())}function we(r,i){r&1&&(o(0,"p"),a(1,"Le mot de passe doit contenir : majuscule, minuscule, chiffre et caract\xE8re sp\xE9cial."),n())}function _e(r,i){if(r&1&&(o(0,"div",9),m(1,be,2,0,"p"),m(2,Se,2,0,"p"),m(3,we,2,0,"p"),n()),r&2){let t,e,l,f=x();s(),c((t=f.passwordForm.get("password"))!=null&&t.hasError("required")?1:-1),s(),c((e=f.passwordForm.get("password"))!=null&&e.hasError("minlength")?2:-1),s(),c((l=f.passwordForm.get("password"))!=null&&l.hasError("passwordStrength")?3:-1)}}function Ee(r,i){r&1&&(o(0,"p",11),a(1," Veuillez confirmer votre mot de passe. "),n())}function Ce(r,i){r&1&&(o(0,"p",11),a(1," Les mots de passe ne correspondent pas. "),n())}function Pe(r,i){if(r&1&&(o(0,"p",12),a(1),n()),r&2){let t=x();s(),h(" ",t.errorMessage()," ")}}var te=class r{fb=d(T);router=d(_);route=d(P);authService=d(E);authStateService=d(C);passwordForm;isSubmitting=p(!1);showPassword=p(!1);errorMessage=p("");isPro=p(!1);constructor(){this.passwordForm=this.fb.group({password:["",[y.required,y.minLength(8),this.passwordStrengthValidator]],confirmPassword:["",[y.required]]},{validators:this.passwordMatchValidator})}ngOnInit(){let i=this.authStateService.getCurrentEmail(),t=this.authStateService.getIsPro();if(!i){console.warn("\u26A0\uFE0F Pas d'email en m\xE9moire, redirection vers /connexion"),this.router.navigate([t?"/connexion-pro":"/connexion"]);return}this.isPro.set(t),console.log("\u{1F510} Password Step - Mode:",t?"PRO":"USER")}passwordStrengthValidator=i=>{let t=i.value;if(!t)return null;let e=/[A-Z]/.test(t),l=/[a-z]/.test(t),f=/[0-9]/.test(t),R=/[!@#$%^&*(),.?":{}|_<>]/.test(t);return e&&l&&f&&R?null:{passwordStrength:!0}};passwordMatchValidator(i){let t=i.get("password")?.value,e=i.get("confirmPassword")?.value;return t===e?null:{passwordMismatch:!0}}isFieldInvalid(i){let t=this.passwordForm.get(i);return!!(t&&t.invalid&&t.touched)}hasPasswordMismatch(){return!!(this.passwordForm.get("confirmPassword")?.touched&&this.passwordForm.hasError("passwordMismatch"))}togglePasswordVisibility(){this.showPassword.set(!this.showPassword())}goBack(){let i=this.isPro()?"/connexion-pro":"/connexion";console.log("\u2B05\uFE0F Retour vers:",`${i}/nom`),this.router.navigate([`${i}/nom`])}goNext(){if(!this.passwordForm.valid){Object.keys(this.passwordForm.controls).forEach(e=>{this.passwordForm.get(e)?.markAsTouched()});return}this.isSubmitting.set(!0),this.errorMessage.set("");let{password:i}=this.passwordForm.value,t=this.isPro();console.log("\u{1F512} D\xE9finition du mot de passe"),console.log("\u{1F3E2} Mode:",t?"PRO":"USER"),this.authService.setPassword(i,t).subscribe({next:e=>{console.log("\u2705 Mot de passe d\xE9fini:",e),this.isSubmitting.set(!1),e.success?(console.log("\u{1F389} Inscription termin\xE9e, utilisateur connect\xE9"),this.authStateService.clearState(),t?(console.log("\u27A1\uFE0F Redirection vers /pro"),this.router.navigate(["/pro"])):(console.log("\u27A1\uFE0F Redirection vers /utilisateurs"),this.router.navigate(["/utilisateurs"]))):this.errorMessage.set(e.message||"Erreur lors de la d\xE9finition du mot de passe")},error:e=>{console.error("\u274C Erreur lors de la d\xE9finition du mot de passe:",e),this.isSubmitting.set(!1);let l="Une erreur est survenue. Veuillez r\xE9essayer.";e.error&&typeof e.error=="object"&&(l=e.error.message||l),this.errorMessage.set(l)}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["app-password-step"]],decls:49,vars:24,consts:[[3,"isPro"],[1,"flex","flex-col","items-center","justify-center","text-center","space-y-6","p-4"],[1,"text-2xl","font-semibold","text-gray-900"],[1,"text-sm","text-gray-500","mt-2"],[1,"w-full","max-w-md","space-y-4",3,"formGroup"],[1,"relative"],["formControlName","password","placeholder","Mot de passe",1,"w-full","px-4","py-3","bg-gray-100","border-0","rounded-lg","text-gray-900","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-gray-900","transition-all","pr-12",3,"type"],["type","button",1,"absolute","right-3","top-1/2","-translate-y-1/2","text-gray-500","hover:text-gray-700","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-5","h-5"],[1,"text-red-500","text-sm","mt-1","text-left","space-y-1"],["formControlName","confirmPassword","placeholder","Confirmer le mot de passe",1,"w-full","px-4","py-3","bg-gray-100","border-0","rounded-lg","text-gray-900","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-gray-900","transition-all",3,"type"],[1,"text-red-500","text-sm","mt-1","text-left"],[1,"text-red-500","text-sm","mt-2"],[1,"bg-gray-50","p-4","rounded-lg","text-left"],[1,"text-xs","font-medium","text-gray-700","mb-2"],[1,"text-xs","text-gray-600","space-y-1"],[1,"flex","items-center"],[1,"mr-2"],[1,"flex","justify-between","items-center","w-full","max-w-md","mt-8"],["type","button",1,"flex","items-center","px-4","py-2","text-gray-700","rounded-lg","hover:bg-gray-100","transition","disabled:opacity-50","hover:curser-pointer",3,"click","disabled"],[1,"text-2xl","mr-1"],["type","button",1,"flex","items-center","px-4","py-2","bg-gray-900","text-white","rounded-lg","hover:bg-gray-800","transition","disabled:bg-gray-400","disabled:cursor-not-allowed","hover:curser-pointer",3,"click","disabled"],[1,"text-2xl","ml-1"],["stroke-linecap","round","stroke-linejoin","round","d","M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"],["stroke-linecap","round","stroke-linejoin","round","d","M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"]],template:function(t,e){t&1&&(g(0,"app-header",0),o(1,"div",1)(2,"div")(3,"h2",2),a(4," Cr\xE9ez votre mot de passe "),n(),o(5,"p",3),a(6," Votre mot de passe doit contenir au moins 8 caract\xE8res "),n()(),o(7,"form",4)(8,"div")(9,"div",5),g(10,"input",6),o(11,"button",7),v("click",function(){return e.togglePasswordVisibility()}),m(12,xe,2,0,":svg:svg",8)(13,ye,3,0,":svg:svg",8),n()(),m(14,_e,4,3,"div",9),n(),o(15,"div"),g(16,"input",10),m(17,Ee,2,0,"p",11),m(18,Ce,2,0,"p",11),n(),m(19,Pe,2,1,"p",12),o(20,"div",13)(21,"p",14),a(22,"Le mot de passe doit contenir :"),n(),o(23,"ul",15)(24,"li",16)(25,"span",17),a(26,"\u2022"),n(),a(27," Au moins 8 caract\xE8res "),n(),o(28,"li",16)(29,"span",17),a(30,"\u2022"),n(),a(31," Une lettre majuscule et une minuscule "),n(),o(32,"li",16)(33,"span",17),a(34,"\u2022"),n(),a(35," Un chiffre "),n(),o(36,"li",16)(37,"span",17),a(38,"\u2022"),n(),a(39," Un caract\xE8re sp\xE9cial (!@#$%^&*...) "),n()()()(),o(40,"div",18)(41,"button",19),v("click",function(){return e.goBack()}),o(42,"span",20),a(43,"\u2190"),n(),a(44," Retour "),n(),o(45,"button",21),v("click",function(){return e.goNext()}),a(46),o(47,"span",22),a(48,"\u2192"),n()()()()),t&2&&(u("isPro",e.isPro()),s(7),u("formGroup",e.passwordForm),s(3),b("border-red-500",e.isFieldInvalid("password"))("ring-2",e.isFieldInvalid("password"))("ring-red-500",e.isFieldInvalid("password")),u("type",e.showPassword()?"text":"password"),s(2),c(e.showPassword()?12:13),s(2),c(e.isFieldInvalid("password")?14:-1),s(2),b("border-red-500",e.isFieldInvalid("confirmPassword")||e.hasPasswordMismatch())("ring-2",e.isFieldInvalid("confirmPassword")||e.hasPasswordMismatch())("ring-red-500",e.isFieldInvalid("confirmPassword")||e.hasPasswordMismatch()),u("type",e.showPassword()?"text":"password"),s(),c(e.isFieldInvalid("confirmPassword")?17:-1),s(),c(e.hasPasswordMismatch()?18:-1),s(),c(e.errorMessage()?19:-1),s(22),u("disabled",e.isSubmitting()),s(4),u("disabled",e.isSubmitting()),s(),h(" ",e.isSubmitting()?"Traitement...":"Terminer"," "))},dependencies:[D,I,M,F,N,V,k,w],encapsulation:2,changeDetection:0})};function Me(r,i){r&1&&(L(),o(0,"svg",10),g(1,"path",16),n())}function Fe(r,i){r&1&&(L(),o(0,"svg",10),g(1,"path",17)(2,"path",18),n())}function Ne(r,i){r&1&&(o(0,"p",11),a(1," Le mot de passe est requis. "),n())}function Ie(r,i){if(r&1&&(o(0,"p",11),a(1),n()),r&2){let t=x();s(),h(" ",t.errorMessage()," ")}}var ie=class r{fb=d(T);router=d(_);route=d(P);authService=d(E);authStateService=d(C);passwordForm;isSubmitting=p(!1);showPassword=p(!1);errorMessage=p("");userEmail=p("");isPro=p(!1);constructor(){this.passwordForm=this.fb.group({password:["",[y.required]]})}ngOnInit(){let i=this.authStateService.getCurrentEmail(),t=this.authStateService.getIsPro();if(!i){console.warn("\u26A0\uFE0F Pas d'email en m\xE9moire, redirection vers /connexion"),this.router.navigate([t?"/connexion-pro":"/connexion"]);return}this.userEmail.set(i),this.isPro.set(t),console.log("\u{1F510} Login Password - Email:",i),console.log("\u{1F510} Login Password - Mode:",t?"PRO":"USER")}isFieldInvalid(){let i=this.passwordForm.get("password");return!!(i&&i.invalid&&i.touched)}togglePasswordVisibility(){this.showPassword.set(!this.showPassword())}goBack(){let i=this.isPro()?"/connexion-pro":"/connexion";this.router.navigate([i])}getButtonClasses(){let i="w-full font-medium py-4 px-6 rounded-lg transition-all duration-200 text-lg";return!this.passwordForm.valid||this.isSubmitting()?`${i} bg-gray-300 text-gray-500 cursor-not-allowed opacity-60`:`${i} bg-black text-white cursor-pointer hover:bg-gray-800 active:scale-98`}handleSubmit(){if(!this.passwordForm.valid){this.passwordForm.get("password")?.markAsTouched();return}this.isSubmitting.set(!0),this.errorMessage.set("");let{password:i}=this.passwordForm.value;console.log("\u{1F510} Tentative de connexion avec mot de passe"),console.log("\u{1F3E2} Mode:",this.isPro()?"PRO":"USER"),this.authService.loginWithPassword(i,this.isPro()).subscribe({next:t=>{if(console.log("\u2705 Connexion r\xE9ussie:",t),this.isSubmitting.set(!1),t.success){console.log("\u{1F389} Utilisateur connect\xE9");let e=t.user?.isPro||this.isPro();console.log("\u{1F464} User:",t.user),console.log("\u{1F3E2} isPro final:",e),this.authStateService.clearState(),e?(console.log("\u27A1\uFE0F Redirection vers /pro"),this.router.navigate(["/pro"])):(console.log("\u27A1\uFE0F Redirection vers /utilisateurs"),this.router.navigate(["/utilisateurs"]))}else this.errorMessage.set(t.message||"Erreur lors de la connexion")},error:t=>{console.error("\u274C Erreur lors de la connexion:",t),this.isSubmitting.set(!1);let e="Mot de passe incorrect.";t.error&&typeof t.error=="object"&&(e=t.error.message||e),this.errorMessage.set(e)}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=S({type:r,selectors:[["app-login-password"]],decls:24,vars:17,consts:[[3,"isPro"],[1,"flex","items-center","justify-center","py-8","px-4"],[1,"w-92","max-w-md","space-y-6"],[1,"text-center","space-y-2"],[1,"text-2xl","md:text-3xl","font-normal","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"relative"],["formControlName","password","placeholder","Mot de passe",1,"w-full","px-4","py-3","bg-gray-100","border-0","rounded-lg","text-gray-900","placeholder-gray-500","focus:outline-none","focus:ring-2","focus:ring-gray-900","transition-all","pr-12",3,"type"],["type","button",1,"absolute","right-3","top-1/2","-translate-y-1/2","text-gray-500","hover:text-gray-700","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-5","h-5"],[1,"text-red-500","text-sm","mt-1"],[1,"text-right"],["type","button",1,"text-sm","text-gray-600","hover:text-gray-900","transition"],["type","submit",3,"disabled"],["type","button",1,"w-full","text-sm","text-gray-600","hover:text-gray-900","transition","py-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"],["stroke-linecap","round","stroke-linejoin","round","d","M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"]],template:function(t,e){t&1&&(g(0,"app-header",0),o(1,"div",1)(2,"div",2)(3,"div",3)(4,"p",4),a(5," Bon retour ! "),n(),o(6,"p",5),a(7),n()(),o(8,"form",6),v("ngSubmit",function(){return e.handleSubmit()}),o(9,"div")(10,"div",7),g(11,"input",8),o(12,"button",9),v("click",function(){return e.togglePasswordVisibility()}),m(13,Me,2,0,":svg:svg",10)(14,Fe,3,0,":svg:svg",10),n()(),m(15,Ne,2,0,"p",11),n(),m(16,Ie,2,1,"p",11),o(17,"div",12)(18,"button",13),a(19," Mot de passe oubli\xE9 ? "),n()(),o(20,"button",14),a(21),n(),o(22,"button",15),v("click",function(){return e.goBack()}),a(23," \u2190 Utiliser un autre email "),n()()()()),t&2&&(u("isPro",e.isPro()),s(7),h(" ",e.userEmail()," "),s(),u("formGroup",e.passwordForm),s(3),b("border-red-500",e.isFieldInvalid()||e.errorMessage())("ring-2",e.isFieldInvalid()||e.errorMessage())("ring-red-500",e.isFieldInvalid()||e.errorMessage()),u("type",e.showPassword()?"text":"password"),s(2),c(e.showPassword()?13:14),s(2),c(e.isFieldInvalid()?15:-1),s(),c(e.errorMessage()?16:-1),s(4),G(e.getButtonClasses()),u("disabled",!e.passwordForm.valid||e.isSubmitting()),s(),h(" ",e.isSubmitting()?"Connexion...":"Se connecter"," "))},dependencies:[D,I,M,F,N,V,k,w],encapsulation:2,changeDetection:0})};export{X as a,Y as b,ee as c,te as d,ie as e};
