import{a as Mt}from"./chunk-EU6JIHYY.js";import{a as Ct,c as wt,e as Pt,j as St}from"./chunk-C333S26M.js";import{$ as ut,Ba as Z,C as k,Ia as ke,J as f,Ja as vt,K as g,Ka as ee,L as pt,La as yt,M as U,Ma as Et,N as z,O as H,Oa as q,P as m,Q as p,R,S as a,T as l,U as T,V as S,W as A,X as j,Y as E,Z as u,_ as mt,aa as ht,ba as Me,ca as ft,da as G,fa as s,ga as w,ha as M,i as $,ia as le,ja as gt,ka as bt,l as x,la as xt,m as v,n as y,o as O,p as D,r as h,ra as Q,sa as ce,v as dt,x as se,xa as _t,y as c,ya as V,za as Je}from"./chunk-XJOSYW3Z.js";import{e as rn}from"./chunk-MYNB6ETT.js";var F=Object.create(null);F.open="0";F.close="1";F.ping="2";F.pong="3";F.message="4";F.upgrade="5";F.noop="6";var be=Object.create(null);Object.keys(F).forEach(n=>{be[F[n]]=n});var xe={type:"error",data:"parser error"};var Tt=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Rt=typeof ArrayBuffer=="function",Bt=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,_e=({type:n,data:t},e,o)=>Tt&&t instanceof Blob?e?o(t):kt(t,o):Rt&&(t instanceof ArrayBuffer||Bt(t))?e?o(t):kt(new Blob([t]),o):o(F[n]+(t||"")),kt=(n,t)=>{let e=new FileReader;return e.onload=function(){let o=e.result.split(",")[1];t("b"+(o||""))},e.readAsDataURL(n)};function Ot(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}var Xe;function Dt(n,t){if(Tt&&n.data instanceof Blob)return n.data.arrayBuffer().then(Ot).then(t);if(Rt&&(n.data instanceof ArrayBuffer||Bt(n.data)))return t(Ot(n.data));_e(n,!1,e=>{Xe||(Xe=new TextEncoder),t(Xe.encode(e))})}var At="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ve=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<At.length;n++)ve[At.charCodeAt(n)]=n;var It=n=>{let t=n.length*.75,e=n.length,o,i=0,r,d,b,C;n[n.length-1]==="="&&(t--,n[n.length-2]==="="&&t--);let W=new ArrayBuffer(t),L=new Uint8Array(W);for(o=0;o<e;o+=4)r=ve[n.charCodeAt(o)],d=ve[n.charCodeAt(o+1)],b=ve[n.charCodeAt(o+2)],C=ve[n.charCodeAt(o+3)],L[i++]=r<<2|d>>4,L[i++]=(d&15)<<4|b>>2,L[i++]=(b&3)<<6|C&63;return W};var sn=typeof ArrayBuffer=="function",ye=(n,t)=>{if(typeof n!="string")return{type:"message",data:Nt(n,t)};let e=n.charAt(0);return e==="b"?{type:"message",data:an(n.substring(1),t)}:be[e]?n.length>1?{type:be[e],data:n.substring(1)}:{type:be[e]}:xe},an=(n,t)=>{if(sn){let e=It(n);return Nt(e,t)}else return{base64:!0,data:n}},Nt=(n,t)=>{switch(t){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}};var Lt="",Vt=(n,t)=>{let e=n.length,o=new Array(e),i=0;n.forEach((r,d)=>{_e(r,!1,b=>{o[d]=b,++i===e&&t(o.join(Lt))})})},Ut=(n,t)=>{let e=n.split(Lt),o=[];for(let i=0;i<e.length;i++){let r=ye(e[i],t);if(o.push(r),r.type==="error")break}return o};function zt(){return new TransformStream({transform(n,t){Dt(n,e=>{let o=e.length,i;if(o<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,o);else if(o<65536){i=new Uint8Array(3);let r=new DataView(i.buffer);r.setUint8(0,126),r.setUint16(1,o)}else{i=new Uint8Array(9);let r=new DataView(i.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(o))}n.data&&typeof n.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(e)})}})}var Ye;function Oe(n){return n.reduce((t,e)=>t+e.length,0)}function Te(n,t){if(n[0].length===t)return n.shift();let e=new Uint8Array(t),o=0;for(let i=0;i<t;i++)e[i]=n[0][o++],o===n[0].length&&(n.shift(),o=0);return n.length&&o<n[0].length&&(n[0]=n[0].slice(o)),e}function Ht(n,t){Ye||(Ye=new TextDecoder);let e=[],o=0,i=-1,r=!1;return new TransformStream({transform(d,b){for(e.push(d);;){if(o===0){if(Oe(e)<1)break;let C=Te(e,1);r=(C[0]&128)===128,i=C[0]&127,i<126?o=3:i===126?o=1:o=2}else if(o===1){if(Oe(e)<2)break;let C=Te(e,2);i=new DataView(C.buffer,C.byteOffset,C.length).getUint16(0),o=3}else if(o===2){if(Oe(e)<8)break;let C=Te(e,8),W=new DataView(C.buffer,C.byteOffset,C.length),L=W.getUint32(0);if(L>Math.pow(2,21)-1){b.enqueue(xe);break}i=L*Math.pow(2,32)+W.getUint32(4),o=3}else{if(Oe(e)<i)break;let C=Te(e,i);b.enqueue(ye(r?C:Ye.decode(C),t)),o=0}if(i===0||i>n){b.enqueue(xe);break}}}})}var Qe=4;function P(n){if(n)return ln(n)}function ln(n){for(var t in P.prototype)n[t]=P.prototype[t];return n}P.prototype.on=P.prototype.addEventListener=function(n,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(t),this};P.prototype.once=function(n,t){function e(){this.off(n,e),t.apply(this,arguments)}return e.fn=t,this.on(n,e),this};P.prototype.off=P.prototype.removeListener=P.prototype.removeAllListeners=P.prototype.removeEventListener=function(n,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var e=this._callbacks["$"+n];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var o,i=0;i<e.length;i++)if(o=e[i],o===t||o.fn===t){e.splice(i,1);break}return e.length===0&&delete this._callbacks["$"+n],this};P.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+n],o=1;o<arguments.length;o++)t[o-1]=arguments[o];if(e){e=e.slice(0);for(var o=0,i=e.length;o<i;++o)e[o].apply(this,t)}return this};P.prototype.emitReserved=P.prototype.emit;P.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};P.prototype.hasListeners=function(n){return!!this.listeners(n).length};var K=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,e)=>e(t,0),B=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),jt="arraybuffer";function Re(n,...t){return t.reduce((e,o)=>(n.hasOwnProperty(o)&&(e[o]=n[o]),e),{})}var cn=B.setTimeout,dn=B.clearTimeout;function J(n,t){t.useNativeTimers?(n.setTimeoutFn=cn.bind(B),n.clearTimeoutFn=dn.bind(B)):(n.setTimeoutFn=B.setTimeout.bind(B),n.clearTimeoutFn=B.clearTimeout.bind(B))}var pn=1.33;function qt(n){return typeof n=="string"?mn(n):Math.ceil((n.byteLength||n.size)*pn)}function mn(n){let t=0,e=0;for(let o=0,i=n.length;o<i;o++)t=n.charCodeAt(o),t<128?e+=1:t<2048?e+=2:t<55296||t>=57344?e+=3:(o++,e+=4);return e}function Be(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Ft(n){let t="";for(let e in n)n.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(n[e]));return t}function $t(n){let t={},e=n.split("&");for(let o=0,i=e.length;o<i;o++){let r=e[o].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}var De=class extends Error{constructor(t,e,o){super(t),this.description=e,this.context=o,this.type="TransportError"}},X=class extends P{constructor(t){super(),this.writable=!1,J(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,e,o){return super.emitReserved("error",new De(t,e,o)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){let e=ye(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){let t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){let e=Ft(t);return e.length?"?"+e:""}};var Ee=class extends X{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";let e=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let o=0;this._polling&&(o++,this.once("pollComplete",function(){--o||e()})),this.writable||(o++,this.once("drain",function(){--o||e()}))}else e()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){let e=o=>{if(this.readyState==="opening"&&o.type==="open"&&this.onOpen(),o.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(o)};Ut(t,this.socket.binaryType).forEach(e),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){let t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Vt(t,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.opts.secure?"https":"http",e=this.query||{};return this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Be()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(t,e)}};var Wt=!1;try{Wt=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var Gt=Wt;function un(){}var Ze=class extends Ee{constructor(t){if(super(t),typeof location<"u"){let e=location.protocol==="https:",o=location.port;o||(o=e?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||o!==t.port}}doWrite(t,e){let o=this.request({method:"POST",data:t});o.on("success",e),o.on("error",(i,r)=>{this.onError("xhr post error",i,r)})}doPoll(){let t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(e,o)=>{this.onError("xhr poll error",e,o)}),this.pollXhr=t}},Ae=(()=>{class n extends P{constructor(e,o,i){super(),this.createRequest=e,J(this,i),this._opts=i,this._method=i.method||"GET",this._uri=o,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;let o=Re(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");o.xdomain=!!this._opts.xd;let i=this._xhr=this.createRequest(o);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&i.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var r;i.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=n.requestsCount++,n.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=un,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete n.requests[this._index],this._xhr=null}}_onLoad(){let e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}return n.requestsCount=0,n.requests={},n})();if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Kt);else if(typeof addEventListener=="function"){let n="onpagehide"in B?"pagehide":"unload";addEventListener(n,Kt,!1)}}function Kt(){for(let n in Ae.requests)Ae.requests.hasOwnProperty(n)&&Ae.requests[n].abort()}var hn=(function(){let n=Jt({xdomain:!1});return n&&n.responseType!==null})(),te=class extends Ze{constructor(t){super(t);let e=t&&t.forceBase64;this.supportsBinary=hn&&!e}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Ae(Jt,this.uri(),t)}};function Jt(n){let t=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Gt))return new XMLHttpRequest}catch{}if(!t)try{return new B[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}var Xt=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",tt=class extends X{get name(){return"websocket"}doOpen(){let t=this.uri(),e=this.opts.protocols,o=Xt?{}:Re(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(o.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,e,o)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let o=t[e],i=e===t.length-1;_e(o,this.supportsBinary,r=>{try{this.doWrite(o,r)}catch{}i&&K(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=Be()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}},et=B.WebSocket||B.MozWebSocket,ne=class extends tt{createSocket(t,e,o){return Xt?new et(t,e,o):e?new et(t,e):new et(t)}doWrite(t,e){this.ws.send(e)}};var de=class extends X{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{let e=Ht(Number.MAX_SAFE_INTEGER,this.socket.binaryType),o=t.readable.pipeThrough(e).getReader(),i=zt();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();let r=()=>{o.read().then(({done:b,value:C})=>{b||(this.onPacket(C),r())}).catch(b=>{})};r();let d={type:"open"};this.query.sid&&(d.data=`{"sid":"${this.query.sid}"}`),this._writer.write(d).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let o=t[e],i=e===t.length-1;this._writer.write(o).then(()=>{i&&K(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}};var nt={websocket:ne,webtransport:de,polling:te};var fn=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,gn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function pe(n){if(n.length>8e3)throw"URI too long";let t=n,e=n.indexOf("["),o=n.indexOf("]");e!=-1&&o!=-1&&(n=n.substring(0,e)+n.substring(e,o).replace(/:/g,";")+n.substring(o,n.length));let i=fn.exec(n||""),r={},d=14;for(;d--;)r[gn[d]]=i[d]||"";return e!=-1&&o!=-1&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=bn(r,r.path),r.queryKey=xn(r,r.query),r}function bn(n,t){let e=/\/{2,9}/g,o=t.replace(e,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&o.splice(0,1),t.slice(-1)=="/"&&o.splice(o.length-1,1),o}function xn(n,t){let e={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(o,i,r){i&&(e[i]=r)}),e}var ot=typeof addEventListener=="function"&&typeof removeEventListener=="function",Ie=[];ot&&addEventListener("offline",()=>{Ie.forEach(n=>n())},!1);var Ne=(()=>{class n extends P{constructor(e,o){if(super(),this.binaryType=jt,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(o=e,e=null),e){let i=pe(e);o.hostname=i.host,o.secure=i.protocol==="https"||i.protocol==="wss",o.port=i.port,i.query&&(o.query=i.query)}else o.host&&(o.hostname=pe(o.host).host);J(this,o),this.secure=o.secure!=null?o.secure:typeof location<"u"&&location.protocol==="https:",o.hostname&&!o.port&&(o.port=this.secure?"443":"80"),this.hostname=o.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=o.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},o.transports.forEach(i=>{let r=i.prototype.name;this.transports.push(r),this._transportsByName[r]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},o),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=$t(this.opts.query)),ot&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Ie.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){let o=Object.assign({},this.opts.query);o.EIO=Qe,o.transport=e,this.id&&(o.sid=this.id);let i=Object.assign({},this.opts,{query:o,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}let e=this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";let o=this.createTransport(e);o.open(),this.setTransport(o)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",o=>this._onClose("transport close",o))}onOpen(){this.readyState="open",n.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let o=new Error("server error");o.code=e.data,this._onError(o);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let o=1;for(let i=0;i<this.writeBuffer.length;i++){let r=this.writeBuffer[i].data;if(r&&(o+=qt(r)),i>0&&o>this._maxPayload)return this.writeBuffer.slice(0,i);o+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,K(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,o,i){return this._sendPacket("message",e,o,i),this}send(e,o,i){return this._sendPacket("message",e,o,i),this}_sendPacket(e,o,i,r){if(typeof o=="function"&&(r=o,o=void 0),typeof i=="function"&&(r=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;let d={type:e,data:o,options:i};this.emitReserved("packetCreate",d),this.writeBuffer.push(d),r&&this.once("flush",r),this.flush()}close(){let e=()=>{this._onClose("forced close"),this.transport.close()},o=()=>{this.off("upgrade",o),this.off("upgradeError",o),e()},i=()=>{this.once("upgrade",o),this.once("upgradeError",o)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(n.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,o){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ot&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){let i=Ie.indexOf(this._offlineEventListener);i!==-1&&Ie.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,o),this.writeBuffer=[],this._prevBufferLen=0}}}return n.protocol=Qe,n})(),Le=class extends Ne{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let e=this.createTransport(t),o=!1;Ne.priorWebsocketSuccess=!1;let i=()=>{o||(e.send([{type:"ping",data:"probe"}]),e.once("packet",Y=>{if(!o)if(Y.type==="pong"&&Y.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;Ne.priorWebsocketSuccess=e.name==="websocket",this.transport.pause(()=>{o||this.readyState!=="closed"&&(L(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())})}else{let ge=new Error("probe error");ge.transport=e.name,this.emitReserved("upgradeError",ge)}}))};function r(){o||(o=!0,L(),e.close(),e=null)}let d=Y=>{let ge=new Error("probe error: "+Y);ge.transport=e.name,r(),this.emitReserved("upgradeError",ge)};function b(){d("transport closed")}function C(){d("socket closed")}function W(Y){e&&Y.name!==e.name&&r()}let L=()=>{e.removeListener("open",i),e.removeListener("error",d),e.removeListener("close",b),this.off("close",C),this.off("upgrading",W)};e.once("open",i),e.once("error",d),e.once("close",b),this.once("close",C),this.once("upgrading",W),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{o||e.open()},200):e.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){let e=[];for(let o=0;o<t.length;o++)~this.transports.indexOf(t[o])&&e.push(t[o]);return e}},me=class extends Le{constructor(t,e={}){let o=typeof t=="object"?t:e;(!o.transports||o.transports&&typeof o.transports[0]=="string")&&(o.transports=(o.transports||["polling","websocket","webtransport"]).map(i=>nt[i]).filter(i=>!!i)),super(t,o)}};var Ri=me.protocol;function Yt(n,t="",e){let o=n;e=e||typeof location<"u"&&location,n==null&&(n=e.protocol+"//"+e.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=e.protocol+n:n=e.host+n),/^(https?|wss?):\/\//.test(n)||(typeof e<"u"?n=e.protocol+"//"+n:n="https://"+n),o=pe(n)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";let r=o.host.indexOf(":")!==-1?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+r+":"+o.port+t,o.href=o.protocol+"://"+r+(e&&e.port===o.port?"":":"+o.port),o}var ct={};rn(ct,{Decoder:()=>at,Encoder:()=>st,PacketType:()=>_,protocol:()=>nn});var vn=typeof ArrayBuffer=="function",yn=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Qt=Object.prototype.toString,En=typeof Blob=="function"||typeof Blob<"u"&&Qt.call(Blob)==="[object BlobConstructor]",Cn=typeof File=="function"||typeof File<"u"&&Qt.call(File)==="[object FileConstructor]";function we(n){return vn&&(n instanceof ArrayBuffer||yn(n))||En&&n instanceof Blob||Cn&&n instanceof File}function Ce(n,t){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let e=0,o=n.length;e<o;e++)if(Ce(n[e]))return!0;return!1}if(we(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Ce(n.toJSON(),!0);for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e)&&Ce(n[e]))return!0;return!1}function Zt(n){let t=[],e=n.data,o=n;return o.data=it(e,t),o.attachments=t.length,{packet:o,buffers:t}}function it(n,t){if(!n)return n;if(we(n)){let e={_placeholder:!0,num:t.length};return t.push(n),e}else if(Array.isArray(n)){let e=new Array(n.length);for(let o=0;o<n.length;o++)e[o]=it(n[o],t);return e}else if(typeof n=="object"&&!(n instanceof Date)){let e={};for(let o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=it(n[o],t));return e}return n}function en(n,t){return n.data=rt(n.data,t),delete n.attachments,n}function rt(n,t){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<t.length)return t[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let e=0;e<n.length;e++)n[e]=rt(n[e],t);else if(typeof n=="object")for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&(n[e]=rt(n[e],t));return n}var wn=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],nn=5,_=(function(n){return n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK",n})(_||{}),st=class{constructor(t){this.replacer=t}encode(t){return(t.type===_.EVENT||t.type===_.ACK)&&Ce(t)?this.encodeAsBinary({type:t.type===_.EVENT?_.BINARY_EVENT:_.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let e=""+t.type;return(t.type===_.BINARY_EVENT||t.type===_.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(e+=t.nsp+","),t.id!=null&&(e+=t.id),t.data!=null&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){let e=Zt(t),o=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(o),i}};function tn(n){return Object.prototype.toString.call(n)==="[object Object]"}var at=class n extends P{constructor(t){super(),this.reviver=t}add(t){let e;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);let o=e.type===_.BINARY_EVENT;o||e.type===_.BINARY_ACK?(e.type=o?_.EVENT:_.ACK,this.reconstructor=new lt(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(we(t)||t.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let e=0,o={type:Number(t.charAt(0))};if(_[o.type]===void 0)throw new Error("unknown packet type "+o.type);if(o.type===_.BINARY_EVENT||o.type===_.BINARY_ACK){let r=e+1;for(;t.charAt(++e)!=="-"&&e!=t.length;);let d=t.substring(r,e);if(d!=Number(d)||t.charAt(e)!=="-")throw new Error("Illegal attachments");o.attachments=Number(d)}if(t.charAt(e+1)==="/"){let r=e+1;for(;++e&&!(t.charAt(e)===","||e===t.length););o.nsp=t.substring(r,e)}else o.nsp="/";let i=t.charAt(e+1);if(i!==""&&Number(i)==i){let r=e+1;for(;++e;){let d=t.charAt(e);if(d==null||Number(d)!=d){--e;break}if(e===t.length)break}o.id=Number(t.substring(r,e+1))}if(t.charAt(++e)){let r=this.tryParse(t.substr(e));if(n.isPayloadValid(o.type,r))o.data=r;else throw new Error("invalid payload")}return o}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,e){switch(t){case _.CONNECT:return tn(e);case _.DISCONNECT:return e===void 0;case _.CONNECT_ERROR:return typeof e=="string"||tn(e);case _.EVENT:case _.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&wn.indexOf(e[0])===-1);case _.ACK:case _.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},lt=class{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){let e=en(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function I(n,t,e){return n.on(t,e),function(){n.off(t,e)}}var Pn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),ue=class extends P{constructor(t,e,o){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,o&&o.auth&&(this.auth=o.auth),this._opts=Object.assign({},o),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let t=this.io;this.subs=[I(t,"open",this.onopen.bind(this)),I(t,"packet",this.onpacket.bind(this)),I(t,"error",this.onerror.bind(this)),I(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){var o,i,r;if(Pn.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;let d={type:_.EVENT,data:e};if(d.options={},d.options.compress=this.flags.compress!==!1,typeof e[e.length-1]=="function"){let L=this.ids++,Y=e.pop();this._registerAckCallback(L,Y),d.id=L}let b=(i=(o=this.io.engine)===null||o===void 0?void 0:o.transport)===null||i===void 0?void 0:i.writable,C=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!b||(C?(this.notifyOutgoingListeners(d),this.packet(d)):this.sendBuffer.push(d)),this.flags={},this}_registerAckCallback(t,e){var o;let i=(o=this.flags.timeout)!==null&&o!==void 0?o:this._opts.ackTimeout;if(i===void 0){this.acks[t]=e;return}let r=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let b=0;b<this.sendBuffer.length;b++)this.sendBuffer[b].id===t&&this.sendBuffer.splice(b,1);e.call(this,new Error("operation has timed out"))},i),d=(...b)=>{this.io.clearTimeoutFn(r),e.apply(this,b)};d.withError=!0,this.acks[t]=d}emitWithAck(t,...e){return new Promise((o,i)=>{let r=(d,b)=>d?i(d):o(b);r.withError=!0,e.push(r),this.emit(t,...e)})}_addToQueue(t){let e;typeof t[t.length-1]=="function"&&(e=t.pop());let o={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...r)=>o!==this._queue[0]?void 0:(i!==null?o.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(i)):(this._queue.shift(),e&&e(null,...r)),o.pending=!1,this._drainQueue())),this._queue.push(o),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;let e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:_.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(o=>String(o.id)===t)){let o=this.acks[t];delete this.acks[t],o.withError&&o.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case _.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case _.EVENT:case _.BINARY_EVENT:this.onevent(t);break;case _.ACK:case _.BINARY_ACK:this.onack(t);break;case _.DISCONNECT:this.ondisconnect();break;case _.CONNECT_ERROR:this.destroy();let o=new Error(t.data.message);o.data=t.data.data,this.emitReserved("connect_error",o);break}}onevent(t){let e=t.data||[];t.id!=null&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){let e=this._anyListeners.slice();for(let o of e)o.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){let e=this,o=!1;return function(...i){o||(o=!0,e.packet({type:_.ACK,id:t,data:i}))}}onack(t){let e=this.acks[t.id];typeof e=="function"&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:_.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){let e=this._anyListeners;for(let o=0;o<e.length;o++)if(t===e[o])return e.splice(o,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){let e=this._anyOutgoingListeners;for(let o=0;o<e.length;o++)if(t===e[o])return e.splice(o,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let e=this._anyOutgoingListeners.slice();for(let o of e)o.apply(this,t.data)}}};function ae(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}ae.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*n);n=(Math.floor(t*10)&1)==0?n-e:n+e}return Math.min(n,this.max)|0};ae.prototype.reset=function(){this.attempts=0};ae.prototype.setMin=function(n){this.ms=n};ae.prototype.setMax=function(n){this.max=n};ae.prototype.setJitter=function(n){this.jitter=n};var he=class extends P{constructor(t,e){var o;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,J(this,e),this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor((o=e.randomizationFactor)!==null&&o!==void 0?o:.5),this.backoff=new ae({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this._readyState="closed",this.uri=t;let i=e.parser||ct;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=e.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(e=this.backoff)===null||e===void 0||e.setMin(t),this)}randomizationFactor(t){var e;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(e=this.backoff)===null||e===void 0||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(e=this.backoff)===null||e===void 0||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new me(this.uri,this.opts);let e=this.engine,o=this;this._readyState="opening",this.skipReconnect=!1;let i=I(e,"open",function(){o.onopen(),t&&t()}),r=b=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",b),t?t(b):this.maybeReconnectOnOpen()},d=I(e,"error",r);if(this._timeout!==!1){let b=this._timeout,C=this.setTimeoutFn(()=>{i(),r(new Error("timeout")),e.close()},b);this.opts.autoUnref&&C.unref(),this.subs.push(()=>{this.clearTimeoutFn(C)})}return this.subs.push(i),this.subs.push(d),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let t=this.engine;this.subs.push(I(t,"ping",this.onping.bind(this)),I(t,"data",this.ondata.bind(this)),I(t,"error",this.onerror.bind(this)),I(t,"close",this.onclose.bind(this)),I(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){K(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let o=this.nsps[t];return o?this._autoConnect&&!o.active&&o.connect():(o=new ue(this,t,e),this.nsps[t]=o),o}_destroy(t){let e=Object.keys(this.nsps);for(let o of e)if(this.nsps[o].active)return;this._close()}_packet(t){let e=this.encoder.encode(t);for(let o=0;o<e.length;o++)this.engine.write(e[o],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var o;this.cleanup(),(o=this.engine)===null||o===void 0||o.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let e=this.backoff.duration();this._reconnecting=!0;let o=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},e);this.opts.autoUnref&&o.unref(),this.subs.push(()=>{this.clearTimeoutFn(o)})}}onreconnect(){let t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}};var Pe={};function Se(n,t){typeof n=="object"&&(t=n,n=void 0),t=t||{};let e=Yt(n,t.path||"/socket.io"),o=e.source,i=e.id,r=e.path,d=Pe[i]&&r in Pe[i].nsps,b=t.forceNew||t["force new connection"]||t.multiplex===!1||d,C;return b?C=new he(o,t):(Pe[i]||(Pe[i]=new he(o,t)),C=Pe[i]),e.query&&!t.query&&(t.query=e.queryKey),C.socket(e.path,t)}Object.assign(Se,{Manager:he,Socket:ue,io:Se,connect:Se});var fe=class n{socket=null;connected=h(!1);proposalCreated=h(null);proposalAccepted=h(null);proposalRejected=h(null);proposalExpired=h(null);connect(t){if(this.socket?.connected){console.log("\u{1F50C} D\xE9j\xE0 connect\xE9 au WebSocket");return}let e=q.apiUrl,o=new URL(e),i=o.protocol==="https:"?"wss:":"ws:",r=o.host;e=`${i}//${r}`,console.log("\u{1F50C} [USER] Connexion au WebSocket:",e),console.log("\u{1F50C} [USER] API URL source:",q.apiUrl),this.socket=Se(e,{auth:{token:t},transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5}),this.setupEventListeners()}disconnect(){this.socket&&(console.log("\u{1F50C} [USER] D\xE9connexion du WebSocket"),this.socket.disconnect(),this.socket=null,this.connected.set(!1))}joinProposal(t){this.socket?.connected&&(console.log("\u{1F4E6} [USER] Rejoindre la proposition:",t),this.socket.emit("join:proposal",t))}leaveProposal(t){this.socket?.connected&&(console.log("\u{1F4E4} [USER] Quitter la proposition:",t),this.socket.emit("leave:proposal",t))}setupEventListeners(){this.socket&&(this.socket.on("connect",()=>{console.log("\u2705 [USER] Connect\xE9 au WebSocket"),this.connected.set(!0)}),this.socket.on("disconnect",()=>{console.log("\u274C [USER] D\xE9connect\xE9 du WebSocket"),this.connected.set(!1)}),this.socket.on("connect_error",t=>{console.error("\u274C [USER] Erreur de connexion WebSocket:",t),this.connected.set(!1)}),this.socket.on("proposal:created",t=>{console.log("\u{1F4E6} [USER] Nouvelle proposition re\xE7ue:",t),this.proposalCreated.set(t)}),this.socket.on("proposal:accepted",t=>{console.log("\u2705 [USER] Proposition accept\xE9e:",t),this.proposalAccepted.set(t.proposalId)}),this.socket.on("proposal:rejected",t=>{console.log("\u274C [USER] Proposition refus\xE9e:",t),this.proposalRejected.set(t)}),this.socket.on("proposal:expired",t=>{console.log("\u23F0 [USER] Proposition expir\xE9e:",t),this.proposalExpired.set(t.proposalId)}))}isConnected(){return this.connected()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ve=class n{http=x(Z);getWebSocketToken(){return this.http.get(`${q.apiUrl}/auth/ws-token`,{withCredentials:!0})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};function Sn(n,t){n&1&&(m(0,"span",22),s(1,"Tableau de bord"),p())}function Mn(n,t){n&1&&(m(0,"span",22),s(1,"Bo\xEEtes"),p())}function kn(n,t){n&1&&(m(0,"span",22),s(1,"Historique"),p())}var Ue=class n{router=x(ee);wsService=x(fe);authService=x(Ve);constructor(){ce(()=>{let t=this.wsService.proposalCreated();t&&(console.log("\u{1F4E6} [USERS-HOME] Nouvelle proposition re\xE7ue:",t),t.isBatch&&t.batchId?(console.log(`\u{1F500} [USERS-HOME] Redirection vers validation batch: ${t.batchId} (${t.proposalIds?.length} propositions)`),this.router.navigate(["/utilisateurs/borrow/validation",t.batchId],{queryParams:{type:"batch"}})):t.proposalId?(console.log("\u{1F500} [USERS-HOME] Redirection vers validation unique:",t.proposalId),this.router.navigate(["/utilisateurs/borrow/validation",t.proposalId])):console.error("\u274C [USERS-HOME] ID de proposition manquant:",t))})}ngOnInit(){console.log("\u{1F680} [USERS-HOME] Initialisation du composant"),this.authService.getWebSocketToken().subscribe({next:t=>{t.success&&t.wsToken?(console.log("\u2705 [USERS-HOME] Token WebSocket obtenu"),this.wsService.connect(t.wsToken)):console.error("\u274C [USERS-HOME] Pas de token WebSocket dans la r\xE9ponse")},error:t=>{console.error("\u274C [USERS-HOME] Erreur r\xE9cup\xE9ration token WebSocket:",t),console.log("\u{1F4A1} [USERS-HOME] L'utilisateur doit \xEAtre connect\xE9 pour recevoir des propositions")}})}ngOnDestroy(){console.log("\u{1F50C} [USERS-HOME] D\xE9connexion du WebSocket"),this.wsService.disconnect()}onSettingsClick(){this.router.url.includes("/utilisateurs/parametres")?this.router.navigate(["/utilisateurs/dashboard"]):this.router.navigate(["/utilisateurs/parametres"])}isOnSettingsPage(){return this.router.url.includes("/utilisateurs/parametres")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-users-home"]],decls:35,vars:5,consts:[["settingsLink","routerLinkActive"],["dashboardLink","routerLinkActive"],["boitesLink","routerLinkActive"],["historiqueLink","routerLinkActive"],[1,"flex","flex-col","h-screen"],[1,"fixed","top-0","left-0","right-0","bg-white","z-[1005]"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","items-center","h-22"],[1,"flex","items-center"],["href","/",1,"flex","items-center"],["src","logo.jpg","alt","logo loop-eat",1,"h-19","w-auto"],["routerLinkActive","active","aria-label","Param\xE8tres",1,"settings","flex","items-center","justify-center","w-11","h-11","rounded-lg","text-gray-600","hover:bg-emerald-100","hover:text-emerald-600","hover:cursor-pointer","transition-all","duration-200",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-9","h-9"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],[1,"flex-1"],[1,"fixed","bottom-0","left-0","right-0","bg-white","border-t","border-gray-200","z-[1005]"],[1,"max-w-3xl","mx-auto","px-4","pb-3"],[1,"flex","justify-around","items-center","h-16"],["routerLink","/utilisateurs/dashboard","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-item","flex","items-center","gap-3","py-2","px-4","rounded-lg","text-gray-600","hover:bg-gray-50","transition-all","duration-200"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-6","h-6","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","d","M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"],[1,"text-sm","font-medium","whitespace-nowrap"],["routerLink","/utilisateurs/boites","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-item","flex","items-center","gap-3","py-2","px-4","rounded-lg","text-gray-600","hover:bg-gray-50","transition-all","duration-200"],["x","4","y","4","width","16","height","3","rx","1","stroke-linecap","round","stroke-linejoin","round"],["stroke-linecap","round","stroke-linejoin","round","d","M5 7v10a2 2 0 002 2h10a2 2 0 002-2V7"],["stroke-linecap","round","stroke-linejoin","round","d","M8 7v3m8-3v3"],["routerLink","/utilisateurs/historique","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-item","flex","items-center","gap-3","py-2","px-4","rounded-lg","text-gray-600","hover:bg-gray-50","transition-all","duration-200"],["stroke-linecap","round","stroke-linejoin","round","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"]],template:function(e,o){if(e&1){let i=S();m(0,"div",4)(1,"header",5)(2,"div",6)(3,"div",7)(4,"div",8)(5,"a",9)(6,"div",8),R(7,"img",10),p()()(),m(8,"button",11,0),j("click",function(){return v(i),y(o.onSettingsClick())}),O(),m(10,"svg",12),R(11,"path",13)(12,"path",14),p()()()()(),D(),m(13,"main",15),R(14,"router-outlet"),p(),m(15,"footer",16)(16,"nav",17)(17,"div",18)(18,"a",19,1),O(),m(20,"svg",20),R(21,"path",21),p(),f(22,Sn,2,0,"span",22),p(),D(),m(23,"a",23,2),O(),m(25,"svg",20),R(26,"rect",24)(27,"path",25)(28,"path",26),p(),f(29,Mn,2,0,"span",22),p(),D(),m(30,"a",27,3),O(),m(32,"svg",20),R(33,"path",28),p(),f(34,kn,2,0,"span",22),p()()()()()}if(e&2){let i=Me(19),r=Me(24),d=Me(31);c(8),G("active",o.isOnSettingsPage()),c(14),g(i.isActive?22:-1),c(7),g(r.isActive?29:-1),c(5),g(d.isActive?34:-1)}},dependencies:[vt,yt,Et],styles:[".nav-item.active[_ngcontent-%COMP%]{background-color:#eefff6;color:#064e3b}.settings.active[_ngcontent-%COMP%]{background-color:#eefff6;color:#059669}.nav-item.active[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke:#064e3b}footer[_ngcontent-%COMP%]{box-shadow:0 -2px 8px #0000001a}main[_ngcontent-%COMP%]{padding-bottom:5rem}"]})};var On=["mapContainer"],Tn=(n,t)=>t.id;function Rn(n,t){if(n&1){let e=S();m(0,"button",13),j("click",function(){v(e);let i=u();return y(i.clearSearch())}),s(1," \u2715 "),p()}}function Bn(n,t){if(n&1){let e=S();m(0,"div",16),j("click",function(){let i=v(e).$implicit,r=u(2);return y(r.centerOnRestaurant(i))}),m(1,"div",17)(2,"span",18),s(3),p(),m(4,"div",19)(5,"div",20),s(6),p(),m(7,"div",21),s(8),p()()()()}if(n&2){let e=t.$implicit;c(3),M(" ",e.type==="restaurant"?"\u{1F37D}\uFE0F":"\u{1F69A}"," "),c(3),w(e.name),c(2),w(e.address)}}function Dn(n,t){if(n&1&&(m(0,"div",10)(1,"div",14),s(2),p(),U(3,Bn,9,3,"div",15,Tn),p()),n&2){let e=u();c(2),M(" ",e.filteredRestaurants().length," r\xE9sultat(s) trouv\xE9(s) "),c(),z(e.filteredRestaurants())}}function An(n,t){if(n&1&&(m(0,"div",25),R(1,"img",35),p()),n&2){let e=u(2);c(),H("src",e.selectedRestaurant().image,se)("alt",e.selectedRestaurant().name)}}function In(n,t){if(n&1&&(m(0,"div",17)(1,"span",9),s(2,"captive_portal"),p(),m(3,"a",36),s(4),p()()),n&2){let e=u(2);c(3),H("href",e.selectedRestaurant().site,se),c(),M(" ",e.selectedRestaurant().site," ")}}function Nn(n,t){if(n&1&&(m(0,"div",17)(1,"span",9),s(2,"phone_enabled"),p(),m(3,"a",37),s(4),p()()),n&2){let e=u(2);c(3),H("href",e.getPhoneUrl(e.selectedRestaurant().contact),se),c(),M(" ",e.selectedRestaurant().contact," ")}}function Ln(n,t){if(n&1&&(m(0,"div",22)(1,"div",23)(2,"div",24),f(3,An,2,2,"div",25),m(4,"div",26)(5,"h3",27),s(6),p()()(),m(7,"div",28)(8,"div",29)(9,"span",30),s(10,"\u{1F4CD}"),p(),m(11,"span",31),s(12),p()(),f(13,In,5,2,"div",17),f(14,Nn,5,2,"div",17),p(),m(15,"div",32)(16,"a",33),s(17," \u{1F4CD} Itin\xE9raire "),p()()(),R(18,"div",34),p()),n&2){let e=u();ft("top",e.tooltipPosition().top,"px")("left",e.tooltipPosition().left,"px"),c(3),g(e.selectedRestaurant().image?3:-1),c(3),M(" ",e.selectedRestaurant().name," "),c(6),w(e.selectedRestaurant().address),c(),g(e.selectedRestaurant().site?13:-1),c(),g(e.selectedRestaurant().contact?14:-1),c(2),H("href",e.getDirectionsUrl(e.selectedRestaurant()),se)}}var ze=class n{platformId=x(dt);map;markers=[];L;mapContainer;searchTerm=h("");selectedRestaurant=h(null);showDetails=h(!1);tooltipPosition=h({top:0,left:0});restaurants=h([{id:1,name:"La Gazette Caf\xE9",address:"6 rue Levat, 34000 Montpellier",lat:43.6104,lng:3.8795,site:"https://gazettecafe.com",contact:"04 67 59 07 59",image:"gazette.avif",description:"Cuisine maison avec produits locaux et bio",type:"restaurant"},{id:2,name:"Green Lab",address:"14 Rue de l'Universit\xE9, 34000 Montpellier",lat:43.6106,lng:3.8767,site:"https://green-lab-universite.eatbu.com",contact:"04 67 92 00 36",image:"greenlab.jpeg",description:"Restaurant 100% v\xE9g\xE9tal",type:"restaurant"},{id:3,name:"Les Cinq Saveurs d'Ananda",address:"8 Rue du Faubourg de la Saunerie, 34000 Montpellier",lat:43.6099,lng:3.8722,site:"https://instagram.com/saveursdana",contact:"04 67 02 88 18",image:"ananda.jpg",description:"Cuisine v\xE9g\xE9tarienne cr\xE9ative",type:"foodtruck"}]);filteredRestaurants=Q(()=>{let t=this.searchTerm().toLowerCase();return t?this.restaurants().filter(e=>e.name.toLowerCase().includes(t)||e.address.toLowerCase().includes(t)):this.restaurants()});async ngOnInit(){if(Je(this.platformId)){let t=await import("./chunk-THHIYB4I.js");this.L=t.default}}ngAfterViewInit(){if(Je(this.platformId)){let t=()=>{this.L&&this.mapContainer?(this.initMap(),this.addMarkers()):setTimeout(t,50)};setTimeout(t,100),document.addEventListener("click",e=>{let o=e.target;!o.closest(".custom-tooltip")&&!o.closest(".leaflet-marker-icon")&&this.closeDetails()})}}initMap(){if(!this.L||!this.mapContainer)return;let t=this.mapContainer.nativeElement;if(!(!t||t.classList.contains("leaflet-container")))try{this.map=this.L.map(t,{center:[43.6108,3.8767],zoom:11}),this.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors"}).addTo(this.map),setTimeout(()=>{this.map&&this.map.invalidateSize()},200),this.map.on("movestart",()=>{this.closeDetails()})}catch(e){console.error("Erreur lors de l'initialisation de la carte:",e)}}createCustomIcon(t){if(!this.L)return;let e=t==="restaurant"?this.getRestaurantIconSvg():this.getFoodtruckIconSvg();return this.L.divIcon({html:e,className:"custom-marker-icon",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-45]})}getRestaurantIconSvg(){return`
      <div class="marker-pin restaurant w-8 h-8">
        <svg id="Calque_1" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 618.5 828.9">
          <defs>
            <style>
              .st0 {
                fill: #fff;
              }

              .st1 {
                fill: #047857;
              }
            </style>
          </defs>
          <path class="st1" d="M536.8,535.3c-56.7,83.9-227.4,293.6-227.4,293.6,0,0-170.7-209.7-227.4-293.6C-29.8,370.1-14.6,207.3,100.7,92S233.9,5.5,309.4,5.5s151.1,28.8,208.7,86.5c115.3,115.3,130.4,278.1,18.7,443.3h0Z"/>
          <path class="st0" d="M462.7,476c10.2,10.2,10.8,26.1,1.5,35.4s-25.3,8.6-35.4-1.5l-104.6-114.8c-7.2,0-15.2-1.7-24.2-5.4l38.2-38.2,24.9,24.9,99.6,99.6ZM242.6,350l47-47-47.6-47.7-98.2-98.2c-3.2-3.2-7.2-4.7-11.7-4.1-3.2.4-7.8,3.4-8.6,11.2-3.3,31.9,20.1,87.4,103.3,170.6,5.5,5.5,10.7,10.5,15.8,15.1h0ZM330,218.9l6.1-6.1h0c0,0-6.2,6.1-6.2,6.1h.1ZM505.9,208.3c-5.3-5.3-12.6-6.6-16.3-2.9l-74.5,74.5c-3.7,3.7-10.6,2.8-15.4-1.9-4.8-4.8-5.6-11.7-1.9-15.4l74.5-74.5c3.7-3.7,2.4-11.1-2.9-16.3-5.3-5.3-12.6-6.6-16.3-2.9l-74.6,74.5c-3.7,3.7-10.6,2.8-15.4-1.9-4.8-4.8-5.6-11.7-1.9-15.4l74.6-74.5c3.7-3.7,2.4-11.1-2.9-16.3-5.3-5.3-12.6-6.6-16.3-2.9l-80.5,80.5c-26.2,26.3-17.8,44.6-2.9,61.2l-207.1,207.1c-10.2,10.2-10.9,26.1-1.5,35.4,9.3,9.3,25.3,8.6,35.4-1.5l207.1-207.1c16.6,15,34.9,23.4,61.3-3l80.4-80.4c3.7-3.7,2.4-11-2.9-16.3h0Z"/>
        </svg>
      </div>
    `}getFoodtruckIconSvg(){return`
      <div class="marker-pin foodtruck w-8 h-8">
        <svg id="Calque_1" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 607.3 824.4">
          <defs>
            <style>
              .st0 {
                fill: #fff;
              }

              .st1 {
                fill: #047857;
              }
            </style>
          </defs>
          <path class="st1" d="M531.1,529.8c-56.7,83.9-227.4,293.6-227.4,293.6,0,0-170.7-209.7-227.4-293.6C-35.5,364.6-20.3,201.8,95,86.5S228.2,0,303.7,0s151.1,28.8,208.7,86.5c115.3,115.3,130.4,278.1,18.7,443.3h0Z"/>
          <path class="st0" d="M479.9,125.3H212.1c-3.8,0-8.3,2.8-9.9,6.3l-49.1,132.9c-1.6,3.5-5.7,7.8-9.1,9.5l-34.6,18.1c-3.4,1.8-6.2,6.4-6.2,10.2v96.2c0,3.8,3.1,7,6.9,7h369.6c3.8,0,6.9-3.1,6.9-7V132.2c0-3.8-3.1-6.9-6.9-6.9h.2Z"/>
          <path class="st0" d="M257.3,405.4c0,27.7-22.5,50.1-50.2,50.1s-50.1-22.4-50.1-50.1,22.5-50.1,50.1-50.1,50.2,22.4,50.2,50.1Z"/>
          <path class="st1" d="M233.4,405.4c0,14.5-11.7,26.2-26.2,26.2s-26.2-11.7-26.2-26.2,11.7-26.2,26.2-26.2,26.2,11.7,26.2,26.2h0Z"/>
          <circle class="st0" cx="391.4" cy="405.4" r="50.2"/>
          <path class="st1" d="M417.5,405.4c0,14.5-11.7,26.2-26.2,26.2s-26.2-11.7-26.2-26.2,11.7-26.2,26.2-26.2,26.2,11.7,26.2,26.2h0Z"/>
          <polygon class="st1" points="174.4 264.7 215 153.7 233.4 153.7 233.4 264.7 174.4 264.7"/>
          <rect class="st1" x="257.3" y="153.7" width="205.2" height="111.1"/>
          <path class="st0" d="M307.7,166.3h-38.6v29.2h0v.5c0,10.1,8.6,18.2,19.2,18.2s19.2-8.2,19.2-18.2,0-.3,0-.5h.2v-29.2h0Z"/>
          <path class="st0" d="M355.4,166.3h-38.6v29.2h0v.5c0,10.1,8.6,18.2,19.2,18.2s19.2-8.2,19.2-18.2,0-.3,0-.5h.2v-29.2h0Z"/>
          <path class="st0" d="M403,166.3h-38.6v29.2h0v.5c0,10.1,8.6,18.2,19.2,18.2s19.2-8.2,19.2-18.2,0-.3,0-.5h.2v-29.2h0Z"/>
          <path class="st0" d="M450.7,166.3h-38.6v29.2h0v.5c0,10.1,8.6,18.2,19.2,18.2s19.2-8.2,19.2-18.2,0-.3,0-.5h.2v-29.2h0Z"/>
        </svg>
      </div>
    `}addMarkers(){!this.L||!this.map||(this.clearMarkers(),this.filteredRestaurants().forEach(t=>{let e=this.createCustomIcon(t.type),o=this.L.marker([t.lat,t.lng],{icon:e}).addTo(this.map).on("click",i=>{this.showRestaurantDetails(t,i)});this.markers.push(o)}))}clearMarkers(){this.markers.forEach(t=>t.remove()),this.markers=[]}showRestaurantDetails(t,e){if(this.selectedRestaurant.set(t),e&&this.map){let o=this.map.latLngToContainerPoint([t.lat,t.lng]);this.tooltipPosition.set({top:o.y-50,left:o.x})}this.showDetails.set(!0)}closeDetails(){this.showDetails.set(!1),setTimeout(()=>{this.selectedRestaurant.set(null)},200)}getDirectionsUrl(t){return`https://www.google.com/maps/dir/?api=1&destination=${t.lat},${t.lng}`}onSearch(){this.closeDetails(),this.addMarkers()}getPhoneUrl(t){return`tel:${t.replace(/\s/g,"")}`}centerOnRestaurant(t){this.map&&(this.map.setView([t.lat,t.lng],14),setTimeout(()=>{let e=this.map.latLngToContainerPoint([t.lat,t.lng]);this.tooltipPosition.set({top:e.y-50,left:e.x}),this.showRestaurantDetails(t)},300))}clearSearch(){this.searchTerm.set(""),this.closeDetails(),this.addMarkers()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-dashboard-map"]],viewQuery:function(e,o){if(e&1&&mt(On,5),e&2){let i;ut(i=ht())&&(o.mapContainer=i.first)}},decls:14,vars:4,consts:[["mapContainer",""],["id","commercants",1,"flex","items-center","justify-center","pb-4"],[1,"w-full","max-w-3xl"],[1,"relative","w-full","h-[400px]","md:h-[500px]","lg:h-[500px]","rounded-lg","overflow-hidden","shadow-md"],[1,"absolute","top-2","left-1/2","transform","-translate-x-1/2","z-[1001]","bg-white","rounded-lg","shadow-lg","p-2","w-96","max-w-[calc(100%-2rem)]"],[1,"flex","gap-2"],["type","text","placeholder","Rechercher un commer\xE7ant...",1,"text-sm","flex-1","px-4","h-8","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent",3,"ngModelChange","ngModel"],["title","Effacer",1,"px-3","py-2","text-gray-500","hover:text-gray-700","transition-colors","hover:cursor-pointer"],[1,"flex","items-center","px-3","bg-green-500","text-white","rounded-lg","hover:bg-green-600","transition-colors","font-medium","hover:cursor-pointer",3,"click"],[1,"material-symbols-outlined"],[1,"mt-3","max-h-60","overflow-y-auto"],[1,"w-full","h-full"],[1,"custom-tooltip",3,"top","left"],["title","Effacer",1,"px-3","py-2","text-gray-500","hover:text-gray-700","transition-colors","hover:cursor-pointer",3,"click"],[1,"text-sm","text-gray-600","mb-2"],[1,"p-3","hover:bg-gray-50","cursor-pointer","border-b","border-gray-100","last:border-0","rounded","transition-colors"],[1,"p-3","hover:bg-gray-50","cursor-pointer","border-b","border-gray-100","last:border-0","rounded","transition-colors",3,"click"],[1,"flex","items-center","gap-2"],[1,"text-lg"],[1,"flex-1"],[1,"font-medium","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"custom-tooltip"],[1,"tooltip-content"],[1,"flex","items-start","gap-3","mb-3"],[1,"w-16","h-16","rounded-lg","overflow-hidden","flex-shrink-0","bg-gray-200"],[1,"flex-1","min-w-0"],[1,"font-bold","text-gray-900","text-sm","truncate"],[1,"space-y-2","text-xs"],[1,"flex","items-start","gap-2"],[1,"text-sm","flex-shrink-0"],[1,"text-gray-700","line-clamp-2"],[1,"flex","gap-2","mt-3","pt-3","border-t","border-gray-100","hover:cursor-pointer"],["target","_blank","rel","noopener noreferrer",1,"flex-1","px-3","py-1.5","bg-green-500","text-white","rounded","text-xs","font-medium","hover:bg-green-600","transition-colors","text-center",3,"href"],[1,"tooltip-arrow"],[1,"w-full","h-full","object-cover",3,"src","alt"],["target","_blank","rel","noopener noreferrer",1,"text-green-600","hover:text-green-700","font-medium",3,"href"],[1,"text-green-600","hover:text-green-700","font-medium","truncate",3,"href"]],template:function(e,o){if(e&1){let i=S();m(0,"section",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"input",6),xt("ngModelChange",function(d){return v(i),bt(o.searchTerm,d)||(o.searchTerm=d),y(d)}),j("ngModelChange",function(){return v(i),y(o.onSearch())}),p(),f(6,Rn,2,0,"button",7),m(7,"button",8),j("click",function(){return v(i),y(o.onSearch())}),m(8,"span",9),s(9,"search"),p()()(),f(10,Dn,5,1,"div",10),p(),R(11,"div",11,0),f(13,Ln,19,10,"div",12),p()()()}e&2&&(c(5),gt("ngModel",o.searchTerm),c(),g(o.searchTerm()?6:-1),c(4),g(o.searchTerm()&&o.filteredRestaurants().length>0?10:-1),c(3),g(o.showDetails()&&o.selectedRestaurant()?13:-1))},dependencies:[St,Ct,wt,Pt],styles:[`.leaflet-pane[_ngcontent-%COMP%], .leaflet-tile[_ngcontent-%COMP%], .leaflet-marker-icon[_ngcontent-%COMP%], .leaflet-marker-shadow[_ngcontent-%COMP%], .leaflet-tile-container[_ngcontent-%COMP%], .leaflet-pane[_ngcontent-%COMP%] > svg[_ngcontent-%COMP%], .leaflet-pane[_ngcontent-%COMP%] > canvas[_ngcontent-%COMP%], .leaflet-zoom-box[_ngcontent-%COMP%], .leaflet-image-layer[_ngcontent-%COMP%], .leaflet-layer[_ngcontent-%COMP%]{position:absolute;left:0;top:0}.leaflet-container[_ngcontent-%COMP%]{overflow:hidden}.leaflet-tile[_ngcontent-%COMP%], .leaflet-marker-icon[_ngcontent-%COMP%], .leaflet-marker-shadow[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-user-drag:none}.leaflet-tile[_ngcontent-%COMP%]::selection{background:transparent}.leaflet-safari[_ngcontent-%COMP%]   .leaflet-tile[_ngcontent-%COMP%]{image-rendering:-webkit-optimize-contrast}.leaflet-safari[_ngcontent-%COMP%]   .leaflet-tile-container[_ngcontent-%COMP%]{width:1600px;height:1600px;-webkit-transform-origin:0 0}.leaflet-marker-icon[_ngcontent-%COMP%], .leaflet-marker-shadow[_ngcontent-%COMP%]{display:block}.leaflet-container[_ngcontent-%COMP%]   .leaflet-overlay-pane[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{max-width:none!important;max-height:none!important}.leaflet-container[_ngcontent-%COMP%]   .leaflet-marker-pane[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .leaflet-container[_ngcontent-%COMP%]   .leaflet-shadow-pane[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .leaflet-container[_ngcontent-%COMP%]   .leaflet-tile-pane[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .leaflet-container[_ngcontent-%COMP%]   img.leaflet-image-layer[_ngcontent-%COMP%], .leaflet-container[_ngcontent-%COMP%]   .leaflet-tile[_ngcontent-%COMP%]{max-width:none!important;max-height:none!important;width:auto;padding:0}.leaflet-container[_ngcontent-%COMP%]   img.leaflet-tile[_ngcontent-%COMP%]{mix-blend-mode:plus-lighter}.leaflet-container.leaflet-touch-zoom[_ngcontent-%COMP%]{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.leaflet-container.leaflet-touch-drag[_ngcontent-%COMP%]{-ms-touch-action:pinch-zoom;touch-action:none;touch-action:pinch-zoom}.leaflet-container.leaflet-touch-drag.leaflet-touch-zoom[_ngcontent-%COMP%]{-ms-touch-action:none;touch-action:none}.leaflet-container[_ngcontent-%COMP%]{-webkit-tap-highlight-color:transparent}.leaflet-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{-webkit-tap-highlight-color:rgba(51,181,229,.4)}.leaflet-tile[_ngcontent-%COMP%]{filter:inherit;visibility:hidden}.leaflet-tile-loaded[_ngcontent-%COMP%]{visibility:inherit}.leaflet-zoom-box[_ngcontent-%COMP%]{width:0;height:0;-moz-box-sizing:border-box;box-sizing:border-box;z-index:800}.leaflet-overlay-pane[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{-moz-user-select:none}.leaflet-pane[_ngcontent-%COMP%]{z-index:400}.leaflet-tile-pane[_ngcontent-%COMP%]{z-index:200}.leaflet-overlay-pane[_ngcontent-%COMP%]{z-index:400}.leaflet-shadow-pane[_ngcontent-%COMP%]{z-index:500}.leaflet-marker-pane[_ngcontent-%COMP%]{z-index:600}.leaflet-tooltip-pane[_ngcontent-%COMP%]{z-index:650}.leaflet-popup-pane[_ngcontent-%COMP%]{z-index:700}.leaflet-map-pane[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{z-index:100}.leaflet-map-pane[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{z-index:200}.leaflet-vml-shape[_ngcontent-%COMP%]{width:1px;height:1px}.lvml[_ngcontent-%COMP%]{behavior:url(#default#VML);display:inline-block;position:absolute}.leaflet-control[_ngcontent-%COMP%]{position:relative;z-index:800;pointer-events:visiblePainted;pointer-events:auto}.leaflet-top[_ngcontent-%COMP%], .leaflet-bottom[_ngcontent-%COMP%]{position:absolute;z-index:1000;pointer-events:none}.leaflet-top[_ngcontent-%COMP%]{top:0}.leaflet-right[_ngcontent-%COMP%]{right:0}.leaflet-bottom[_ngcontent-%COMP%]{bottom:0}.leaflet-left[_ngcontent-%COMP%]{left:0}.leaflet-control[_ngcontent-%COMP%]{float:left;clear:both}.leaflet-right[_ngcontent-%COMP%]   .leaflet-control[_ngcontent-%COMP%]{float:right}.leaflet-top[_ngcontent-%COMP%]   .leaflet-control[_ngcontent-%COMP%]{margin-top:10px}.leaflet-bottom[_ngcontent-%COMP%]   .leaflet-control[_ngcontent-%COMP%]{margin-bottom:10px}.leaflet-left[_ngcontent-%COMP%]   .leaflet-control[_ngcontent-%COMP%]{margin-left:10px}.leaflet-right[_ngcontent-%COMP%]   .leaflet-control[_ngcontent-%COMP%]{margin-right:10px}.leaflet-fade-anim[_ngcontent-%COMP%]   .leaflet-popup[_ngcontent-%COMP%]{opacity:0;-webkit-transition:opacity .2s linear;-moz-transition:opacity .2s linear;transition:opacity .2s linear}.leaflet-fade-anim[_ngcontent-%COMP%]   .leaflet-map-pane[_ngcontent-%COMP%]   .leaflet-popup[_ngcontent-%COMP%]{opacity:1}.leaflet-zoom-animated[_ngcontent-%COMP%]{-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0}svg.leaflet-zoom-animated[_ngcontent-%COMP%]{will-change:transform}.leaflet-zoom-anim[_ngcontent-%COMP%]   .leaflet-zoom-animated[_ngcontent-%COMP%]{-webkit-transition:-webkit-transform .25s cubic-bezier(0,0,.25,1);-moz-transition:-moz-transform .25s cubic-bezier(0,0,.25,1);transition:transform .25s cubic-bezier(0,0,.25,1)}.leaflet-zoom-anim[_ngcontent-%COMP%]   .leaflet-tile[_ngcontent-%COMP%], .leaflet-pan-anim[_ngcontent-%COMP%]   .leaflet-tile[_ngcontent-%COMP%]{-webkit-transition:none;-moz-transition:none;transition:none}.leaflet-zoom-anim[_ngcontent-%COMP%]   .leaflet-zoom-hide[_ngcontent-%COMP%]{visibility:hidden}.leaflet-interactive[_ngcontent-%COMP%]{cursor:pointer}.leaflet-grab[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.leaflet-crosshair[_ngcontent-%COMP%], .leaflet-crosshair[_ngcontent-%COMP%]   .leaflet-interactive[_ngcontent-%COMP%]{cursor:crosshair}.leaflet-popup-pane[_ngcontent-%COMP%], .leaflet-control[_ngcontent-%COMP%]{cursor:auto}.leaflet-dragging[_ngcontent-%COMP%]   .leaflet-grab[_ngcontent-%COMP%], .leaflet-dragging[_ngcontent-%COMP%]   .leaflet-grab[_ngcontent-%COMP%]   .leaflet-interactive[_ngcontent-%COMP%], .leaflet-dragging[_ngcontent-%COMP%]   .leaflet-marker-draggable[_ngcontent-%COMP%]{cursor:move;cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.leaflet-marker-icon[_ngcontent-%COMP%], .leaflet-marker-shadow[_ngcontent-%COMP%], .leaflet-image-layer[_ngcontent-%COMP%], .leaflet-pane[_ngcontent-%COMP%] > svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%], .leaflet-tile-container[_ngcontent-%COMP%]{pointer-events:none}.leaflet-marker-icon.leaflet-interactive[_ngcontent-%COMP%], .leaflet-image-layer.leaflet-interactive[_ngcontent-%COMP%], .leaflet-pane[_ngcontent-%COMP%] > svg[_ngcontent-%COMP%]   path.leaflet-interactive[_ngcontent-%COMP%], svg.leaflet-image-layer.leaflet-interactive[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{pointer-events:visiblePainted;pointer-events:auto}.leaflet-container[_ngcontent-%COMP%]{background:#ddd;outline-offset:1px}.leaflet-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#0078a8}.leaflet-zoom-box[_ngcontent-%COMP%]{border:2px dotted #38f;background:#ffffff80}.leaflet-container[_ngcontent-%COMP%]{font-family:Helvetica Neue,Arial,Helvetica,sans-serif;font-size:12px;font-size:.75rem;line-height:1.5}.leaflet-bar[_ngcontent-%COMP%]{box-shadow:0 1px 5px #000000a6;border-radius:4px}.leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background-color:#fff;border-bottom:1px solid #ccc;width:26px;height:26px;line-height:26px;display:block;text-align:center;text-decoration:none;color:#000}.leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .leaflet-control-layers-toggle[_ngcontent-%COMP%]{background-position:50% 50%;background-repeat:no-repeat;display:block}.leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus{background-color:#f4f4f4}.leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:first-child{border-top-left-radius:4px;border-top-right-radius:4px}.leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:last-child{border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-bottom:none}.leaflet-bar[_ngcontent-%COMP%]   a.leaflet-disabled[_ngcontent-%COMP%]{cursor:default;background-color:#f4f4f4;color:#bbb}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:30px;height:30px;line-height:30px}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:first-child{border-top-left-radius:2px;border-top-right-radius:2px}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:last-child{border-bottom-left-radius:2px;border-bottom-right-radius:2px}.leaflet-control-zoom-in[_ngcontent-%COMP%], .leaflet-control-zoom-out[_ngcontent-%COMP%]{font:700 18px Lucida Console,Monaco,monospace;text-indent:1px}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-zoom-in[_ngcontent-%COMP%], .leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-zoom-out[_ngcontent-%COMP%]{font-size:22px}.leaflet-control-layers[_ngcontent-%COMP%]{box-shadow:0 1px 5px #0006;background:#fff;border-radius:5px}.leaflet-control-layers-toggle[_ngcontent-%COMP%]{background-image:url("./media/layers-55W3Q4RM.png");width:36px;height:36px}.leaflet-retina[_ngcontent-%COMP%]   .leaflet-control-layers-toggle[_ngcontent-%COMP%]{background-image:url("./media/layers-2x-TBM42ERR.png");background-size:26px 26px}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-layers-toggle[_ngcontent-%COMP%]{width:44px;height:44px}.leaflet-control-layers[_ngcontent-%COMP%]   .leaflet-control-layers-list[_ngcontent-%COMP%], .leaflet-control-layers-expanded[_ngcontent-%COMP%]   .leaflet-control-layers-toggle[_ngcontent-%COMP%]{display:none}.leaflet-control-layers-expanded[_ngcontent-%COMP%]   .leaflet-control-layers-list[_ngcontent-%COMP%]{display:block;position:relative}.leaflet-control-layers-expanded[_ngcontent-%COMP%]{padding:6px 10px 6px 6px;color:#333;background:#fff}.leaflet-control-layers-scrollbar[_ngcontent-%COMP%]{overflow-y:scroll;overflow-x:hidden;padding-right:5px}.leaflet-control-layers-selector[_ngcontent-%COMP%]{margin-top:2px;position:relative;top:1px}.leaflet-control-layers[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:13px;font-size:1.08333em}.leaflet-control-layers-separator[_ngcontent-%COMP%]{height:0;border-top:1px solid #ddd;margin:5px -10px 5px -6px}.leaflet-default-icon-path[_ngcontent-%COMP%]{background-image:url("./media/marker-icon-2V3QKKVC.png")}.leaflet-container[_ngcontent-%COMP%]   .leaflet-control-attribution[_ngcontent-%COMP%]{background:#fff;background:#fffc;margin:0}.leaflet-control-attribution[_ngcontent-%COMP%], .leaflet-control-scale-line[_ngcontent-%COMP%]{padding:0 5px;color:#333;line-height:1.4}.leaflet-control-attribution[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.leaflet-control-attribution[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .leaflet-control-attribution[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus{text-decoration:underline}.leaflet-attribution-flag[_ngcontent-%COMP%]{display:inline!important;vertical-align:baseline!important;width:1em;height:.6669em}.leaflet-left[_ngcontent-%COMP%]   .leaflet-control-scale[_ngcontent-%COMP%]{margin-left:5px}.leaflet-bottom[_ngcontent-%COMP%]   .leaflet-control-scale[_ngcontent-%COMP%]{margin-bottom:5px}.leaflet-control-scale-line[_ngcontent-%COMP%]{border:2px solid #777;border-top:none;line-height:1.1;padding:2px 5px 1px;white-space:nowrap;-moz-box-sizing:border-box;box-sizing:border-box;background:#fffc;text-shadow:1px 1px #fff}.leaflet-control-scale-line[_ngcontent-%COMP%]:not(:first-child){border-top:2px solid #777;border-bottom:none;margin-top:-2px}.leaflet-control-scale-line[_ngcontent-%COMP%]:not(:first-child):not(:last-child){border-bottom:2px solid #777}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-attribution[_ngcontent-%COMP%], .leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-layers[_ngcontent-%COMP%], .leaflet-touch[_ngcontent-%COMP%]   .leaflet-bar[_ngcontent-%COMP%]{box-shadow:none}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-layers[_ngcontent-%COMP%], .leaflet-touch[_ngcontent-%COMP%]   .leaflet-bar[_ngcontent-%COMP%]{border:2px solid rgba(0,0,0,.2);background-clip:padding-box}.leaflet-popup[_ngcontent-%COMP%]{position:absolute;text-align:center;margin-bottom:20px}.leaflet-popup-content-wrapper[_ngcontent-%COMP%]{padding:1px;text-align:left;border-radius:12px}.leaflet-popup-content[_ngcontent-%COMP%]{margin:13px 24px 13px 20px;line-height:1.3;font-size:13px;font-size:1.08333em;min-height:1px}.leaflet-popup-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:1.3em 0}.leaflet-popup-tip-container[_ngcontent-%COMP%]{width:40px;height:20px;position:absolute;left:50%;margin-top:-1px;margin-left:-20px;overflow:hidden;pointer-events:none}.leaflet-popup-tip[_ngcontent-%COMP%]{width:17px;height:17px;padding:1px;margin:-10px auto 0;pointer-events:auto;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}.leaflet-popup-content-wrapper[_ngcontent-%COMP%], .leaflet-popup-tip[_ngcontent-%COMP%]{background:#fff;color:#333;box-shadow:0 3px 14px #0006}.leaflet-container[_ngcontent-%COMP%]   a.leaflet-popup-close-button[_ngcontent-%COMP%]{position:absolute;top:0;right:0;border:none;text-align:center;width:24px;height:24px;font:16px/24px Tahoma,Verdana,sans-serif;color:#757575;text-decoration:none;background:transparent}.leaflet-container[_ngcontent-%COMP%]   a.leaflet-popup-close-button[_ngcontent-%COMP%]:hover, .leaflet-container[_ngcontent-%COMP%]   a.leaflet-popup-close-button[_ngcontent-%COMP%]:focus{color:#585858}.leaflet-popup-scrolled[_ngcontent-%COMP%]{overflow:auto}.leaflet-oldie[_ngcontent-%COMP%]   .leaflet-popup-content-wrapper[_ngcontent-%COMP%]{-ms-zoom:1}.leaflet-oldie[_ngcontent-%COMP%]   .leaflet-popup-tip[_ngcontent-%COMP%]{width:24px;margin:0 auto;-ms-filter:"progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)";filter:progid:DXImageTransform.Microsoft.Matrix(M11=.70710678,M12=.70710678,M21=-.70710678,M22=.70710678)}.leaflet-oldie[_ngcontent-%COMP%]   .leaflet-control-zoom[_ngcontent-%COMP%], .leaflet-oldie[_ngcontent-%COMP%]   .leaflet-control-layers[_ngcontent-%COMP%], .leaflet-oldie[_ngcontent-%COMP%]   .leaflet-popup-content-wrapper[_ngcontent-%COMP%], .leaflet-oldie[_ngcontent-%COMP%]   .leaflet-popup-tip[_ngcontent-%COMP%]{border:1px solid #999}.leaflet-div-icon[_ngcontent-%COMP%]{background:#fff;border:1px solid #666}.leaflet-tooltip[_ngcontent-%COMP%]{position:absolute;padding:6px;background-color:#fff;border:1px solid #fff;border-radius:3px;color:#222;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;pointer-events:none;box-shadow:0 1px 3px #0006}.leaflet-tooltip.leaflet-interactive[_ngcontent-%COMP%]{cursor:pointer;pointer-events:auto}.leaflet-tooltip-top[_ngcontent-%COMP%]:before, .leaflet-tooltip-bottom[_ngcontent-%COMP%]:before, .leaflet-tooltip-left[_ngcontent-%COMP%]:before, .leaflet-tooltip-right[_ngcontent-%COMP%]:before{position:absolute;pointer-events:none;border:6px solid transparent;background:transparent;content:""}.leaflet-tooltip-bottom[_ngcontent-%COMP%]{margin-top:6px}.leaflet-tooltip-top[_ngcontent-%COMP%]{margin-top:-6px}.leaflet-tooltip-bottom[_ngcontent-%COMP%]:before, .leaflet-tooltip-top[_ngcontent-%COMP%]:before{left:50%;margin-left:-6px}.leaflet-tooltip-top[_ngcontent-%COMP%]:before{bottom:0;margin-bottom:-12px;border-top-color:#fff}.leaflet-tooltip-bottom[_ngcontent-%COMP%]:before{top:0;margin-top:-12px;margin-left:-6px;border-bottom-color:#fff}.leaflet-tooltip-left[_ngcontent-%COMP%]{margin-left:-6px}.leaflet-tooltip-right[_ngcontent-%COMP%]{margin-left:6px}.leaflet-tooltip-left[_ngcontent-%COMP%]:before, .leaflet-tooltip-right[_ngcontent-%COMP%]:before{top:50%;margin-top:-6px}.leaflet-tooltip-left[_ngcontent-%COMP%]:before{right:0;margin-right:-12px;border-left-color:#fff}.leaflet-tooltip-right[_ngcontent-%COMP%]:before{left:0;margin-left:-12px;border-right-color:#fff}@media print{.leaflet-control[_ngcontent-%COMP%]{-webkit-print-color-adjust:exact;print-color-adjust:exact}}.custom-marker-icon[_ngcontent-%COMP%]{background:none;border:none}.marker-pin[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50% 50% 50% 0;position:relative;transform:rotate(-45deg);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px #0000004d;transition:transform .3s ease;cursor:pointer}.marker-pin[_ngcontent-%COMP%]:hover{transform:rotate(-45deg) scale(1.1)}.marker-pin[_ngcontent-%COMP%]:after{content:"";width:8px;height:8px;border-radius:50%;position:absolute;background:#fff;bottom:-4px;right:-4px;box-shadow:0 2px 4px #0003}.marker-pin[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:rotate(45deg);filter:drop-shadow(0 1px 2px rgba(0,0,0,.2))}.marker-pin.restaurant[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669)}.marker-pin.foodtruck[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706)}.custom-tooltip[_ngcontent-%COMP%]{position:absolute;z-index:1002;pointer-events:none;transform:translate(-50%,-100%);animation:_ngcontent-%COMP%_tooltipFadeIn .2s ease-out}.tooltip-content[_ngcontent-%COMP%]{position:relative;background:#fff;border-radius:12px;padding:16px;box-shadow:0 8px 24px #00000040;width:320px;max-width:calc(100vw - 32px);pointer-events:auto;margin-bottom:12px}.tooltip-arrow[_ngcontent-%COMP%]{position:absolute;bottom:0;left:50%;transform:translate(-50%);width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-top:12px solid white;filter:drop-shadow(0 4px 6px rgba(0,0,0,.1))}@keyframes _ngcontent-%COMP%_tooltipFadeIn{0%{opacity:0;transform:translate(-50%,-100%) scale(.95)}to{opacity:1;transform:translate(-50%,-100%) scale(1)}}.simple-tooltip[_ngcontent-%COMP%]{background-color:#000000d9!important;border:none!important;color:#fff!important;font-weight:500!important;padding:6px 10px!important;border-radius:6px!important;box-shadow:0 4px 12px #0000004d!important;font-size:13px!important}.simple-tooltip[_ngcontent-%COMP%]:before{border-top-color:#000000d9!important}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#10b981;border-radius:3px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#059669}@media (max-width: 640px){.tooltip-content[_ngcontent-%COMP%]{width:280px;padding:12px}.custom-tooltip[_ngcontent-%COMP%]{max-width:calc(100vw - 16px)}}.leaflet-control-zoom[_ngcontent-%COMP%]{margin-top:30px!important}

`]})};var ie=class n{http=x(Z);apiUrl=`${q.apiUrl}/payment`;createRechargeSession(t){return this.http.post(`${this.apiUrl}/create-recharge-session`,{amount:t},{withCredentials:!0})}verifySession(t){return this.http.get(`${this.apiUrl}/verify-session/${t}`,{withCredentials:!0})}getUserBalance(){return this.http.get(`${this.apiUrl}/balance`,{withCredentials:!0})}getBalanceHistory(t=50){return this.http.get(`${this.apiUrl}/history?limit=${t}`,{withCredentials:!0})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};var He=class n{http=x(Z);apiUrl=`${q.apiUrl}/accounts`;getBasicInfo(){return this.http.get(`${this.apiUrl}/info`,{withCredentials:!0})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};var re=class n{http=x(Z);apiUrl=`${q.apiUrl}/borrow`;getProposal(t){return this.http.get(`${this.apiUrl}/proposal/${t}`,{withCredentials:!0})}getPendingProposals(){return this.http.get(`${this.apiUrl}/pending`,{withCredentials:!0})}getActiveBorrows(){return this.http.get(`${this.apiUrl}/active`,{withCredentials:!0})}acceptProposal(t){return this.http.post(`${this.apiUrl}/accept/${t}`,{},{withCredentials:!0})}rejectProposal(t){return this.http.post(`${this.apiUrl}/reject/${t}`,{},{withCredentials:!0})}getBorrowHistory(t=50){return this.http.get(`${this.apiUrl}/history?limit=${t}`,{withCredentials:!0})}getBatchProposals(t){return this.http.get(`${this.apiUrl}/batch/${t}`,{withCredentials:!0})}acceptBatch(t){return this.http.post(`${this.apiUrl}/batch/${t}/accept`,{},{withCredentials:!0})}rejectBatch(t){return this.http.post(`${this.apiUrl}/batch/${t}/reject`,{},{withCredentials:!0})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};function Vn(n,t){n&1&&(m(0,"span",8),s(1,"\u27F3"),p())}function Un(n,t){n&1&&(m(0,"span"),s(1,"+"),p())}function zn(n,t){if(n&1){let e=S();m(0,"button",17),j("click",function(){let i=v(e).$implicit,r=u(2);return y(r.recharge(i))}),m(1,"span",18),s(2),p(),m(3,"span",19),s(4," arrow_forward "),p()()}if(n&2){let e=t.$implicit,o=u(2);H("disabled",o.isLoading()),c(2),M("",e," \u20AC")}}function Hn(n,t){if(n&1&&(m(0,"div",9)(1,"div",14)(2,"p",15),s(3,"Montant \xE0 recharger"),p(),U(4,zn,5,2,"button",16,pt),p()()),n&2){let e=u();c(4),z(e.rechargeAmounts)}}var je=class n{paymentService=x(ie);accountsService=x(He);borrowService=x(re);showRechargeMenu=h(!1);isLoading=h(!1);balance=h(0);userName=h("");borrowedBoxes=h(0);customerCode=h("");rechargeAmounts=[5,10,20,50];ngOnInit(){this.loadUserBasicInfo(),this.loadUserBalance(),this.loadBorrowedBoxes()}loadUserBasicInfo(){this.accountsService.getBasicInfo().subscribe({next:t=>{if(t.success){let e=t.data;this.customerCode.set(e.code),e.isPro?this.userName.set(e.name||""):this.userName.set(`${e.firstName||""} ${e.lastName||""}`.trim())}},error:t=>{console.error("Erreur lors du chargement des infos utilisateur:",t)}})}loadUserBalance(){this.paymentService.getUserBalance().subscribe({next:t=>{t.success&&this.balance.set(t.balance)},error:t=>{console.error("Erreur lors du chargement du solde:",t)}})}loadBorrowedBoxes(){this.borrowService.getActiveBorrows().subscribe({next:t=>{t.success&&this.borrowedBoxes.set(t.totalBoxes)},error:t=>{console.error("Erreur lors du chargement des bo\xEEtes emprunt\xE9es:",t)}})}toggleRechargeMenu(){this.showRechargeMenu.update(t=>!t)}closeRechargeMenu(){this.showRechargeMenu.set(!1)}async recharge(t){if(!this.isLoading()){this.isLoading.set(!0),this.closeRechargeMenu();try{let e=await this.paymentService.createRechargeSession(t).toPromise();e?.success&&e.url&&(window.location.href=e.url)}catch(e){console.error("Erreur lors de la cr\xE9ation de la session de paiement:",e),alert("Une erreur est survenue. Veuillez r\xE9essayer."),this.isLoading.set(!1)}}}refreshBalance(){this.loadUserBalance()}refreshBorrowedBoxes(){this.loadBorrowedBoxes()}handleClickOutside(t){t.target.closest(".recharge-container")||this.closeRechargeMenu()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-dashboard"]],decls:28,vars:7,consts:[[1,"h-full","overflow-y-auto","pt-23",3,"click"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"shadow-md","bg-white","rounded-sm","p-4","lg:p-8","mb-6","text-center","w-fit","mx-auto","border","border-gray-100","hover:shadow-md","hover:scale-105","transition-all"],[1,"material-symbols-outlined","block","mb-1",2,"font-size","30px"],[1,"text-xl","font-bold","text-gray-900"],[1,"grid","grid-cols-2","gap-6","mb-6"],[1,"recharge-container","shadow-md","bg-white","border","border-gray-100","rounded-lg","p-3","text-center","relative","hover:shadow-md","hover:scale-105","transition-all","z-[1003]"],["type","button","aria-label","Recharger le solde",1,"absolute","-top-1","-right-1","w-10","h-10","bg-emerald-50","border-1","border-emerald-900","rounded-full","flex","items-center","justify-center","text-emerald-900","font-bold","text-xl","hover:bg-emerald-100","hover:cursor-pointer","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"animate-spin"],[1,"absolute","top-12","right-0","bg-white","border","border-gray-200","rounded-lg","shadow-xl","z-[1003]","min-w-[150px]","overflow-hidden"],[1,"text-4xl","font-bold","text-gray-900","mb-2"],[1,"text-md","text-gray-600"],[1,"shadow-md","bg-white","border","border-gray-100","rounded-lg","p-3","text-center","hover:shadow-md","hover:scale-105","transition-all"],[1,"shadow-md","bg-white","border","border-gray-100","rounded-lg","p-3","text-center","mb-6","hover:shadow-md","hover:scale-105","transition-all"],[1,"p-2"],[1,"text-sm","text-gray-600","font-semibold","mb-2","px-2"],["type","button",1,"w-full","text-left","px-4","py-3","hover:bg-emerald-50","transition-colors","rounded-md","flex","justify-between","items-center","group","disabled:opacity-50","disabled:cursor-not-allowed","cursor-pointer",3,"disabled"],["type","button",1,"w-full","text-left","px-4","py-3","hover:bg-emerald-50","transition-colors","rounded-md","flex","justify-between","items-center","group","disabled:opacity-50","disabled:cursor-not-allowed","cursor-pointer",3,"click","disabled"],[1,"font-medium","text-gray-900","group-hover:text-emerald-900"],[1,"material-symbols-outlined","text-gray-400","group-hover:text-emerald-900","text-sm"]],template:function(e,o){e&1&&(m(0,"div",0),j("click",function(r){return o.handleClickOutside(r)}),m(1,"div",1)(2,"div",2)(3,"span",3),s(4," account_circle "),p(),m(5,"p",4),s(6),p()(),m(7,"div",5)(8,"div",6)(9,"button",7),j("click",function(){return o.toggleRechargeMenu()}),f(10,Vn,2,0,"span",8)(11,Un,2,0,"span"),p(),f(12,Hn,6,0,"div",9),m(13,"p",10),s(14),p(),m(15,"p",11),s(16,"Solde"),p()(),m(17,"div",12)(18,"p",10),s(19),p(),m(20,"p",11),s(21,"Bo\xEEtes emprunt\xE9es"),p()()(),m(22,"div",13)(23,"p",10),s(24),p(),m(25,"p",11),s(26,"Code client"),p()(),R(27,"app-dashboard-map"),p()()),e&2&&(c(6),w(o.userName()),c(3),H("disabled",o.isLoading()),c(),g(o.isLoading()?10:11),c(2),g(o.showRechargeMenu()?12:-1),c(2),M("",o.balance()," \u20AC"),c(5),w(o.borrowedBoxes()),c(5),w(o.customerCode()))},dependencies:[ze,V],encapsulation:2})};var jn=(n,t)=>t.id;function qn(n,t){n&1&&(m(0,"div",2),R(1,"div",5),p())}function Fn(n,t){if(n&1&&(m(0,"div",6)(1,"div",7)(2,"div",8)(3,"span",9),s(4),p()(),m(5,"div",10)(6,"p",11),s(7),p(),m(8,"p",12),s(9),p()(),m(10,"p",13),s(11),p()()()),n&2){let e=t.$implicit,o=u(2);c(2),H("ngClass",o.isAddition(e)?"bg-green-100":"bg-red-100"),c(2),M(" ",o.getIcon(e)," "),c(3),w(e.title),c(2),w(o.formatDate(e.date)),c(),H("ngClass",o.isAddition(e)?"text-green-600":"text-red-600"),c(),le(" ",o.isAddition(e)?"+":"-"," ",o.getAbsoluteAmount(e)," \u20AC ")}}function $n(n,t){if(n&1&&(m(0,"div",3),U(1,Fn,12,7,"div",6,jn),p()),n&2){let e=u();c(),z(e.transactions())}}function Wn(n,t){n&1&&(m(0,"div",4)(1,"span",14),s(2," receipt_long "),p(),m(3,"p",15),s(4,"Aucune transaction pour le moment"),p()())}var qe=class n{paymentService=x(ie);transactions=h([]);isLoading=h(!0);ngOnInit(){this.loadHistory()}loadHistory(){this.isLoading.set(!0),this.paymentService.getBalanceHistory().subscribe({next:t=>{if(t.success&&t.history){let e=t.history.map(o=>{let i=o.add!==null&&o.add>0,r=i?o.add||0:o.subtract||0;return{id:`transaction-${o.id}`,title:o.title,date:o.created,amount:r,isAddition:i}});this.transactions.set(e)}this.isLoading.set(!1)},error:t=>{console.error("Erreur lors du chargement de l'historique:",t),this.isLoading.set(!1)}})}isAddition(t){return t.isAddition}formatDate(t){return new Date(t).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})}getAbsoluteAmount(t){return Math.abs(t.amount)}getIcon(t){let e=t.title.toLowerCase();return e.includes("rendue")||e.includes("retour")?"stockpot":e.includes("emprunt")?"lunch_dining":"add_card"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-historical"]],decls:5,vars:1,consts:[[1,"h-full","overflow-y-auto","pt-16"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"flex","justify-center","items-center","py-12"],[1,"space-y-3"],[1,"text-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-emerald-600"],[1,"bg-white","rounded-lg","p-4","shadow-sm","hover:shadow-md","hover:translate-x-1","transition-all","duration-200","border","border-gray-100"],[1,"flex","items-center","gap-4"],[1,"w-12","h-12","rounded-lg","flex","items-center","justify-center","text-2xl","flex-shrink-0",3,"ngClass"],[1,"material-symbols-outlined"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"text-lg","font-bold","flex-shrink-0",3,"ngClass"],[1,"material-symbols-outlined","text-gray-400","text-6xl","mb-4"],[1,"text-gray-600","text-lg"]],template:function(e,o){e&1&&(m(0,"div",0)(1,"div",1),f(2,qn,2,0,"div",2)(3,$n,3,0,"div",3)(4,Wn,5,0,"div",4),p()()),e&2&&(c(2),g(o.isLoading()?2:o.transactions().length>0?3:4))},dependencies:[V,_t],encapsulation:2})};var Gn=(n,t)=>t.type;function Kn(n,t){n&1&&(a(0,"div",2),T(1,"div",6),l())}function Jn(n,t){if(n&1&&(a(0,"div",3)(1,"p",7),s(2),l()()),n&2){let e=u();c(2),w(e.errorMessage())}}function Xn(n,t){n&1&&(a(0,"div",4),O(),a(1,"svg",8),T(2,"path",9),l(),D(),a(3,"h3",10),s(4,"Aucune bo\xEEte emprunt\xE9e"),l(),a(5,"p",11),s(6,"Vous n'avez pas encore emprunt\xE9 de contenants r\xE9utilisables."),l()())}function Yn(n,t){if(n&1&&(a(0,"div",12)(1,"div",13)(2,"div",14),T(3,"img",15),l(),a(4,"p",16),s(5),l()()()),n&2){let e=t.$implicit,o=u(2);c(3),A("src",e.image,se)("alt",e.label),c(2),M(" ",o.getBoxText(e)," ")}}function Qn(n,t){if(n&1&&(a(0,"div",5),U(1,Yn,6,3,"div",12,Gn),l()),n&2){let e=u();c(),z(e.boxes())}}var Fe=class n{borrowService=x(re);boxes=h([]);isLoading=h(!0);errorMessage=h(null);boxTypeConfig={1:{image:"verre-salade.webp",label:"Bo\xEEte Verre Salade"},2:{image:"plastique-salade.webp",label:"Bo\xEEte Plastique Salade"},3:{image:"frites.jpg",label:"Bo\xEEte Frite"},4:{image:"pizza.png",label:"Bo\xEEte Pizza"},5:{image:"gobelet.jpg",label:"Gobelet"},6:{image:"burger.jpg",label:"Bo\xEEte Burger"}};ngOnInit(){this.loadBorrowedBoxes()}loadBorrowedBoxes(){this.isLoading.set(!0),this.errorMessage.set(null),this.borrowService.getActiveBorrows().subscribe({next:t=>{if(t.success&&t.borrows){let e=new Map;t.borrows.forEach(i=>{i.items.forEach(r=>{let d=typeof r.type=="string"?parseInt(r.type):r.type,b=e.get(d)||0;e.set(d,b+r.number)})});let o=Array.from(e.entries()).map(([i,r])=>{let d=this.boxTypeConfig[i]||{image:"default-box.png",label:`Bo\xEEte Type ${i}`};return{type:i,totalNumber:r,image:d.image,label:d.label}});o.sort((i,r)=>i.type-r.type),this.boxes.set(o)}else this.boxes.set([]);this.isLoading.set(!1)},error:t=>{console.error("Erreur lors du chargement des bo\xEEtes:",t),this.errorMessage.set("Impossible de charger vos bo\xEEtes emprunt\xE9es"),this.isLoading.set(!1)}})}getBoxText(t){return t.totalNumber===1?`1 ${t.label} emprunt\xE9e`:`${t.totalNumber} ${t.label}s emprunt\xE9es`}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-boxes"]],decls:6,vars:1,consts:[[1,"h-full","overflow-y-auto","pt-16"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"flex","justify-center","items-center","py-12"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","text-center"],[1,"bg-gray-50","border","border-gray-200","rounded-lg","p-8","text-center"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-4","gap-4"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-emerald-900"],[1,"text-red-800"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"mx-auto","h-16","w-16","text-gray-400","mb-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"bg-white","rounded-lg","p-4","shadow-sm","hover:shadow-md","hover:scale-105","transition-all","duration-200","border","border-gray-100"],[1,"flex","flex-col","items-center","gap-3"],[1,"w-30","h-30","rounded-lg","flex","items-center","justify-center"],[1,"max-w-full","max-h-full","object-contain",3,"src","alt"],[1,"font-semibold","text-gray-900","text-center"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1),f(2,Kn,2,0,"div",2)(3,Jn,3,1,"div",3)(4,Xn,7,0,"div",4)(5,Qn,3,0,"div",5),l()()),e&2&&(c(2),g(o.isLoading()?2:o.errorMessage()?3:o.boxes().length===0?4:5))},dependencies:[V],encapsulation:2})};function Zn(n,t){if(n&1){let e=S();a(0,"div",8)(1,"form",13),E("ngSubmit",function(){v(e);let i=u();return y(i.updateNom())}),a(2,"div")(3,"label",14),s(4,"Nouveau nom"),l(),a(5,"input",15),E("input",function(i){v(e);let r=u();return y(r.nom.set(i.target.value))}),l()(),a(6,"button",16),s(7," Enregistrer "),l()()()}if(n&2){let e=u();c(5),A("value",e.nom())}}function eo(n,t){if(n&1){let e=S();a(0,"div",8)(1,"form",13),E("ngSubmit",function(){v(e);let i=u();return y(i.updatePrenom())}),a(2,"div")(3,"label",17),s(4,"Nouveau pr\xE9nom"),l(),a(5,"input",18),E("input",function(i){v(e);let r=u();return y(r.prenom.set(i.target.value))}),l()(),a(6,"button",16),s(7," Enregistrer "),l()()()}if(n&2){let e=u();c(5),A("value",e.prenom())}}function to(n,t){if(n&1){let e=S();a(0,"div",8)(1,"form",13),E("ngSubmit",function(){v(e);let i=u();return y(i.updateEmail())}),a(2,"div")(3,"label",19),s(4,"Nouvel email"),l(),a(5,"input",20),E("input",function(i){v(e);let r=u();return y(r.email.set(i.target.value))}),l()(),a(6,"button",16),s(7," Enregistrer "),l()()()}if(n&2){let e=u();c(5),A("value",e.email())}}function no(n,t){if(n&1){let e=S();a(0,"div",8)(1,"form",13),E("ngSubmit",function(){v(e);let i=u();return y(i.updatePassword())}),a(2,"div")(3,"label",21),s(4,"Mot de passe actuel"),l(),a(5,"input",22),E("input",function(i){v(e);let r=u();return y(r.currentPassword.set(i.target.value))}),l()(),a(6,"div")(7,"label",23),s(8,"Nouveau mot de passe"),l(),a(9,"input",24),E("input",function(i){v(e);let r=u();return y(r.newPassword.set(i.target.value))}),l()(),a(10,"div")(11,"label",25),s(12,"Confirmer le mot de passe"),l(),a(13,"input",26),E("input",function(i){v(e);let r=u();return y(r.confirmPassword.set(i.target.value))}),l()(),a(14,"button",16),s(15," Changer le mot de passe "),l()()()}if(n&2){let e=u();c(5),A("value",e.currentPassword()),c(4),A("value",e.newPassword()),c(4),A("value",e.confirmPassword())}}function oo(n,t){if(n&1){let e=S();a(0,"div",8)(1,"p",27),s(2," Votre solde actuel est de "),a(3,"strong",28),s(4),l()(),a(5,"button",29),E("click",function(){v(e);let i=u();return y(i.recupererSolde())}),s(6," R\xE9cup\xE9rer le solde "),l()()}if(n&2){let e=u();c(4),M("",e.solde()," \u20AC")}}function io(n,t){if(n&1){let e=S();a(0,"div",8)(1,"p",30)(2,"strong",31),s(3,"Attention !"),l(),s(4," Cette action est irr\xE9versible. Vous devez d'abord r\xE9cup\xE9rer votre solde et toutes vos donn\xE9es seront d\xE9finitivement supprim\xE9es. "),l(),a(5,"form",13),E("ngSubmit",function(){v(e);let i=u();return y(i.deleteAccount())}),a(6,"div")(7,"label",32),s(8,'Tapez "SUPPRIMER" pour confirmer'),l(),a(9,"input",33),E("input",function(i){v(e);let r=u();return y(r.deleteConfirmation.set(i.target.value))}),l()(),a(10,"button",34),s(11," Supprimer d\xE9finitivement mon compte "),l()()()}if(n&2){let e=u();c(9),A("value",e.deleteConfirmation()),c(),A("disabled",e.deleteConfirmation()!=="SUPPRIMER")}}var $e=class n{authInitService=x(Mt);nom=h("Nom");prenom=h("Pr\xE9nom");email=h("email@example.com");solde=h(0);currentPassword=h("");newPassword=h("");confirmPassword=h("");deleteConfirmation=h("");expandedSection=h(null);toggleSection(t){this.expandedSection()===t?this.expandedSection.set(null):this.expandedSection.set(t)}updateNom(){console.log("Mise \xE0 jour du nom:",this.nom()),alert(`Nom mis \xE0 jour: ${this.nom()}`),this.expandedSection.set(null)}updatePrenom(){console.log("Mise \xE0 jour du pr\xE9nom:",this.prenom()),alert(`Pr\xE9nom mis \xE0 jour: ${this.prenom()}`),this.expandedSection.set(null)}updateEmail(){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email())){alert("Veuillez entrer un email valide");return}console.log("Mise \xE0 jour de l'email:",this.email()),alert(`Email mis \xE0 jour: ${this.email()}`),this.expandedSection.set(null)}updatePassword(){if(!this.currentPassword()){alert("Veuillez entrer votre mot de passe actuel");return}if(this.newPassword().length<8){alert("Le nouveau mot de passe doit contenir au moins 8 caract\xE8res");return}if(this.newPassword()!==this.confirmPassword()){alert("Les mots de passe ne correspondent pas");return}console.log("Changement de mot de passe"),alert("Mot de passe chang\xE9 avec succ\xE8s"),this.currentPassword.set(""),this.newPassword.set(""),this.confirmPassword.set(""),this.expandedSection.set(null)}recupererSolde(){console.log("R\xE9cup\xE9ration du solde:",this.solde()),alert(`Demande de r\xE9cup\xE9ration de ${this.solde()} \u20AC envoy\xE9e`),this.expandedSection.set(null)}async logout(){console.log("D\xE9connexion de l'utilisateur"),await this.authInitService.logout(),this.expandedSection.set(null)}deleteAccount(){if(this.deleteConfirmation()!=="SUPPRIMER"){alert('Veuillez taper "SUPPRIMER" pour confirmer');return}console.log("Suppression du compte"),confirm("\xCAtes-vous absolument certain de vouloir supprimer votre compte ?")&&(alert("Compte supprim\xE9. Vous allez \xEAtre redirig\xE9..."),this.expandedSection.set(null))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-settings"]],decls:62,vars:22,consts:[[1,"max-w-3xl","mx-auto","px-4","md:px-8","pt-22"],[1,"bg-white","border","border-gray-200","rounded-xl","mb-4","overflow-hidden","hover:shadow-md","transition-shadow"],["type","button",1,"w-full","flex","items-center","justify-between","p-5","text-left","hover:bg-gray-50","transition-colors","hover:cursor-pointer",3,"click"],[1,"text-base","font-semibold","text-gray-700"],[1,"flex","items-center","gap-3"],[1,"text-sm","text-gray-500","max-w-[200px]","truncate"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-5","h-5","text-gray-400","transition-transform","duration-300"],["points","6 9 12 15 18 9"],[1,"p-6","bg-gray-50","border-t","border-gray-200","animate-fadeIn"],[1,"text-sm","text-gray-500"],[1,"bg-white","border","border-red-200","rounded-xl","mb-4","overflow-hidden","hover:shadow-md","transition-shadow","hover:cursor-pointer"],["type","button",1,"w-full","flex","items-center","justify-between","p-5","text-left","hover:bg-red-50","transition-colors","hover:cursor-pointer",3,"click"],[1,"text-base","font-semibold","text-red-600"],[1,"space-y-4",3,"ngSubmit"],["for","nom",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","nom","type","text","placeholder","Entrez votre nom",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["type","submit",1,"w-full","px-6","py-3","bg-emerald-500","text-white","font-semibold","rounded-lg","hover:bg-emerald-600","hover:-translate-y-0.5","hover:shadow-lg","transition-all","hover:cursor-pointer"],["for","prenom",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","prenom","type","text","placeholder","Entrez votre pr\xE9nom",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","email",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","email","type","email","placeholder","Entrez votre email",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","current-password",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","current-password","type","password","placeholder","Entrez votre mot de passe actuel",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","new-password",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","new-password","type","password","placeholder","Entrez votre nouveau mot de passe",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","confirm-password",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","confirm-password","type","password","placeholder","Confirmez votre nouveau mot de passe",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],[1,"text-base","text-gray-700","mb-4","p-4","bg-white","rounded-lg","border","border-gray-200"],[1,"text-emerald-600","text-lg"],["type","button",1,"w-full","px-6","py-3","bg-emerald-500","text-white","font-semibold","rounded-lg","hover:bg-emerald-600","hover:-translate-y-0.5","hover:shadow-lg","transition-all","hover:cursor-pointer",3,"click"],[1,"text-sm","text-red-900","mb-4","p-4","bg-red-50","rounded-lg","border","border-red-200"],[1,"font-bold"],["for","confirm-delete",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","confirm-delete","type","text","placeholder","SUPPRIMER",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-red-500","focus:border-red-500","transition-all",3,"input","value"],["type","submit",1,"w-full","px-6","py-3","bg-red-600","text-white","font-semibold","rounded-lg","hover:bg-red-700","hover:-translate-y-0.5","hover:shadow-lg","transition-all","hover:cursor-pointer","disabled:bg-gray-300","disabled:cursor-not-allowed","disabled:hover:translate-y-0","disabled:hover:shadow-none","disabled:opacity-60","cursor-pointer",3,"disabled"]],template:function(e,o){e&1&&(a(0,"section",0)(1,"div",1)(2,"button",2),E("click",function(){return o.toggleSection("nom")}),a(3,"span",3),s(4,"Nom"),l(),a(5,"div",4)(6,"span",5),s(7),l(),O(),a(8,"svg",6),T(9,"polyline",7),l()()(),f(10,Zn,8,1,"div",8),l(),D(),a(11,"div",1)(12,"button",2),E("click",function(){return o.toggleSection("prenom")}),a(13,"span",3),s(14,"Pr\xE9nom"),l(),a(15,"div",4)(16,"span",5),s(17),l(),O(),a(18,"svg",6),T(19,"polyline",7),l()()(),f(20,eo,8,1,"div",8),l(),D(),a(21,"div",1)(22,"button",2),E("click",function(){return o.toggleSection("email")}),a(23,"span",3),s(24,"Email"),l(),a(25,"div",4)(26,"span",5),s(27),l(),O(),a(28,"svg",6),T(29,"polyline",7),l()()(),f(30,to,8,1,"div",8),l(),D(),a(31,"div",1)(32,"button",2),E("click",function(){return o.toggleSection("password")}),a(33,"span",3),s(34,"Mot de passe"),l(),a(35,"div",4)(36,"span",9),s(37,"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"),l(),O(),a(38,"svg",6),T(39,"polyline",7),l()()(),f(40,no,16,3,"div",8),l(),D(),a(41,"div",1)(42,"button",2),E("click",function(){return o.toggleSection("solde")}),a(43,"span",3),s(44,"R\xE9cup\xE9rer le solde"),l(),a(45,"div",4)(46,"span",9),s(47),l(),O(),a(48,"svg",6),T(49,"polyline",7),l()()(),f(50,oo,7,1,"div",8),l(),D(),a(51,"div",10)(52,"button",11),E("click",function(){return o.logout()}),a(53,"span",12),s(54,"Se d\xE9connecter"),l()()(),a(55,"div",1)(56,"button",2),E("click",function(){return o.toggleSection("delete")}),a(57,"span",3),s(58,"Supprimer le compte"),l(),O(),a(59,"svg",6),T(60,"polyline",7),l()(),f(61,io,12,2,"div",8),l()()),e&2&&(c(7),w(o.nom()),c(),G("rotate-180",o.expandedSection()==="nom"),c(2),g(o.expandedSection()==="nom"?10:-1),c(7),w(o.prenom()),c(),G("rotate-180",o.expandedSection()==="prenom"),c(2),g(o.expandedSection()==="prenom"?20:-1),c(7),w(o.email()),c(),G("rotate-180",o.expandedSection()==="email"),c(2),g(o.expandedSection()==="email"?30:-1),c(8),G("rotate-180",o.expandedSection()==="password"),c(2),g(o.expandedSection()==="password"?40:-1),c(7),M("",o.solde()," \u20AC"),c(),G("rotate-180",o.expandedSection()==="solde"),c(2),g(o.expandedSection()==="solde"?50:-1),c(9),G("rotate-180",o.expandedSection()==="delete"),c(2),g(o.expandedSection()==="delete"?61:-1))},encapsulation:2,changeDetection:0})};var We=class n{router=x(ee);goToDashboard(){this.router.navigate(["/utilisateurs"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-recharge-cancel"]],decls:12,vars:0,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-gray-50","px-4"],[1,"max-w-md","w-full","bg-white","rounded-lg","shadow-lg","p-8","text-center"],[1,"mb-6"],[1,"material-symbols-outlined","text-orange-500","text-6xl"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600","mb-6"],[1,"space-y-3"],["type","button",1,"w-full","bg-gray-200","text-gray-700","py-3","px-4","rounded-lg","font-medium","hover:bg-gray-300","transition-colors","cursor-pointer",3,"click"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),s(4," cancel "),l()(),a(5,"h1",4),s(6," Paiement annul\xE9 "),l(),a(7,"p",5),s(8," Votre rechargement a \xE9t\xE9 annul\xE9. Aucun montant n'a \xE9t\xE9 d\xE9bit\xE9. "),l(),a(9,"div",6)(10,"button",7),E("click",function(){return o.goToDashboard()}),s(11," Retour \xE0 l'application "),l()()()())},dependencies:[V],encapsulation:2})};function ro(n,t){n&1&&(T(0,"div",2),a(1,"p",3),s(2,"V\xE9rification du paiement..."),l())}function so(n,t){if(n&1){let e=S();a(0,"div",4)(1,"span",5),s(2," check_circle "),l()(),a(3,"h1",6),s(4," Rechargement r\xE9ussi ! "),l(),a(5,"p",7),s(6," Votre compte a \xE9t\xE9 cr\xE9dit\xE9 de "),a(7,"span",8),s(8),l()(),a(9,"button",9),E("click",function(){v(e);let i=u();return y(i.goToDashboard())}),s(10," Retour sur l'application "),l()}if(n&2){let e,o=u();c(8),le(" ",(e=o.sessionDetails())==null?null:e.session.amount," ",(e=o.sessionDetails())==null?null:e.session.currency.toUpperCase()," ")}}function ao(n,t){if(n&1){let e=S();a(0,"div",4)(1,"span",10),s(2," error "),l()(),a(3,"h1",6),s(4," Erreur "),l(),a(5,"p",7),s(6," Impossible de v\xE9rifier le paiement. "),l(),a(7,"button",11),E("click",function(){v(e);let i=u();return y(i.goToDashboard())}),s(8," Retour sur l'application "),l()}}var Ge=class n{route=x(ke);router=x(ee);paymentService=x(ie);isLoading=h(!0);sessionDetails=h(null);ngOnInit(){let t=this.route.snapshot.queryParamMap.get("session_id");t?this.verifyPayment(t):this.isLoading.set(!1)}async verifyPayment(t){try{let e=await this.paymentService.verifySession(t).toPromise();this.sessionDetails.set(e)}catch(e){console.error("Erreur lors de la v\xE9rification:",e)}finally{this.isLoading.set(!1)}}goToDashboard(){this.router.navigate(["/utilisateurs"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-recharge-success"]],decls:5,vars:1,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-gray-50","px-4"],[1,"max-w-md","w-full","bg-white","rounded-lg","shadow-lg","p-8","text-center"],[1,"animate-spin","rounded-full","h-16","w-16","border-b-2","border-emerald-600","mx-auto","mb-4"],[1,"text-gray-600"],[1,"mb-6"],[1,"material-symbols-outlined","text-emerald-600","text-6xl"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600","mb-6"],[1,"font-bold","text-emerald-600"],["type","button",1,"w-full","bg-emerald-600","text-white","py-3","px-4","rounded-lg","font-medium","hover:bg-emerald-700","transition-colors","cursor-pointer",3,"click"],[1,"material-symbols-outlined","text-red-600","text-6xl"],["type","button",1,"w-full","bg-gray-600","text-white","py-3","px-4","rounded-lg","font-medium","hover:bg-gray-700","transition-colors","cursor-pointer",3,"click"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1),f(2,ro,3,0)(3,so,11,2)(4,ao,9,0),l()()),e&2&&(c(2),g(o.isLoading()?2:o.sessionDetails()?3:4))},dependencies:[V],encapsulation:2})};var on=(n,t)=>t.id;function lo(n,t){n&1&&(a(0,"div",2),T(1,"div",5),a(2,"p",6),s(3,"Chargement de la proposition..."),l()())}function co(n,t){if(n&1){let e=S();a(0,"div",3)(1,"div",7),O(),a(2,"svg",8),T(3,"path",9),l(),D(),a(4,"p",10),s(5),l()(),a(6,"button",11),E("click",function(){v(e);let i=u();return y(i.goBack())}),s(7," Retour "),l()()}if(n&2){let e=u();c(5),w(e.error())}}function po(n,t){n&1&&s(0," Propositions d'emprunt ")}function mo(n,t){n&1&&s(0," Proposition d'emprunt ")}function uo(n,t){if(n&1&&s(0),n&2){let e=u(2);M(" De ",e.batchProposals().pro.name," ")}}function ho(n,t){if(n&1&&s(0),n&2){let e=u(2);M(" De ",e.proposal().pro.name," ")}}function fo(n,t){n&1&&(a(0,"span",16),s(1," En attente "),l())}function go(n,t){n&1&&(a(0,"span",17),s(1," Valid\xE9 "),l())}function bo(n,t){n&1&&(a(0,"span",18),s(1," Refus\xE9 "),l())}function xo(n,t){n&1&&(a(0,"span",19),s(1," Expir\xE9 "),l())}function _o(n,t){if(n&1&&(a(0,"div",26)(1,"div",28)(2,"div")(3,"p",36),s(4,"Type de bo\xEEte"),l(),a(5,"p",37),s(6),l()(),a(7,"div",38)(8,"p",36),s(9,"Quantit\xE9"),l(),a(10,"p",39),s(11),l()()()()),n&2){let e=t.$implicit,o=u(3);c(6),w(o.getBoxTypeName(e.type)),c(5),w(e.number)}}function vo(n,t){n&1&&(a(0,"span",40),s(1," + "),l())}function yo(n,t){if(n&1&&(a(0,"span"),s(1),l(),f(2,vo,2,0,"span",40)),n&2){let e=t.$implicit,o=t.$index,i=t.$count,r=u(3);c(),le("",e.number," ",r.getBoxTypeName(e.type)),c(),g(o!==i-1?2:-1)}}function Eo(n,t){if(n&1&&(a(0,"div",25),U(1,_o,12,2,"div",26,on),l(),a(3,"div",27)(4,"div",28)(5,"span",29),s(6,"Total de bo\xEEtes"),l(),a(7,"span",30),s(8),l()()(),a(9,"div",31)(10,"div",32)(11,"span",33),s(12,"Restaurant"),l(),a(13,"span",34),s(14),l()(),a(15,"div",35)(16,"span",33),s(17,"Types de bo\xEEtes"),l(),a(18,"div",34),U(19,yo,3,3,null,null,on),l()()()),n&2){let e=u(2);c(),z(e.batchProposals().proposals),c(7),w(e.totalBoxes()),c(6),w(e.batchProposals().pro.name),c(5),z(e.batchProposals().proposals)}}function Co(n,t){if(n&1&&(a(0,"div",41)(1,"div",28)(2,"div")(3,"p",36),s(4,"Type de bo\xEEte"),l(),a(5,"p",37),s(6),l()(),a(7,"div",38)(8,"p",36),s(9,"Quantit\xE9"),l(),a(10,"p",39),s(11),l()()()(),a(12,"div",31)(13,"div",32)(14,"span",33),s(15,"Restaurant"),l(),a(16,"span",34),s(17),l()()()),n&2){let e=u(2);c(6),w(e.getBoxTypeName(e.proposal().type)),c(5),w(e.proposal().number),c(6),w(e.proposal().pro.name)}}function wo(n,t){if(n&1){let e=S();a(0,"div",23)(1,"button",42),E("click",function(){v(e);let i=u(2);return y(i.rejectProposal())}),s(2," Refuser "),l(),a(3,"button",43),E("click",function(){v(e);let i=u(2);return y(i.acceptProposal())}),s(4," Accepter "),l()()}if(n&2){let e=u(2);c(),A("disabled",e.loading()),c(2),A("disabled",e.loading())}}function Po(n,t){if(n&1){let e=S();a(0,"button",44),E("click",function(){v(e);let i=u(2);return y(i.goBack())}),s(1," Retour au tableau de bord "),l()}}function So(n,t){if(n&1&&(a(0,"div",4)(1,"div",12)(2,"div",13)(3,"div")(4,"h1",14),f(5,po,1,0)(6,mo,1,0),l(),a(7,"p",15),f(8,uo,1,1)(9,ho,1,1),l()(),f(10,fo,2,0,"span",16),f(11,go,2,0,"span",17),f(12,bo,2,0,"span",18),f(13,xo,2,0,"span",19),l()(),a(14,"div",20)(15,"h2",21),s(16,"D\xE9tails de l'emprunt"),l(),f(17,Eo,21,2)(18,Co,18,3),l(),a(19,"div",22),f(20,wo,5,2,"div",23)(21,Po,2,0,"button",24),l()()),n&2){let e=u();c(5),g(e.isBatch()?5:6),c(3),g(e.isBatch()?8:9),c(2),g(e.status()==="pending"?10:-1),c(),g(e.status()==="accepted"?11:-1),c(),g(e.status()==="rejected"?12:-1),c(),g(e.status()==="expired"?13:-1),c(4),g(e.isBatch()?17:18),c(3),g(e.canInteract()?20:21)}}var Ke=class n{route=x(ke);router=x(ee);borrowService=x(re);wsService=x(fe);proposal=h(null);batchProposals=h(null);isBatch=h(!1);status=h("pending");loading=h(!0);error=h(null);timeRemaining=h(3e5);timerInterval=null;minutes=Q(()=>Math.floor(this.timeRemaining()/6e4));seconds=Q(()=>Math.floor(this.timeRemaining()%6e4/1e3));isExpired=Q(()=>this.timeRemaining()<=0);canInteract=Q(()=>this.status()==="pending"&&!this.isExpired());totalBoxes=Q(()=>this.isBatch()&&this.batchProposals()?this.batchProposals().proposals.reduce((t,e)=>t+e.number,0):this.proposal()?.number||0);constructor(){ce(()=>{let t=this.wsService.proposalAccepted(),e=this.isBatch()?this.batchProposals()?.batchId:this.proposal()?.id;t===e&&(this.status.set("accepted"),this.stopTimer())}),ce(()=>{let t=this.wsService.proposalRejected(),e=this.isBatch()?this.batchProposals()?.batchId:this.proposal()?.id;t?.proposalId===e&&(this.status.set("rejected"),this.stopTimer())}),ce(()=>{let t=this.wsService.proposalExpired(),e=this.isBatch()?this.batchProposals()?.batchId:this.proposal()?.id;t===e&&(this.status.set("expired"),this.stopTimer())})}ngOnInit(){let t=this.route.snapshot.paramMap.get("id"),e=this.route.snapshot.queryParamMap.get("type");if(!t){this.error.set("ID de proposition manquant"),this.loading.set(!1);return}let o=this.getAuthToken();o&&(this.wsService.connect(o),this.wsService.joinProposal(t)),e==="batch"?(this.isBatch.set(!0),this.loadBatch(t)):this.loadProposal(t)}ngOnDestroy(){let t=this.isBatch()?this.batchProposals()?.batchId:this.proposal()?.id;t&&this.wsService.leaveProposal(t),this.stopTimer()}loadProposal(t){this.borrowService.getProposal(t).subscribe({next:e=>{e.success&&e.proposal&&(this.proposal.set(e.proposal),this.timeRemaining.set(e.proposal.timeRemaining),e.proposal.accepted===!0?this.status.set("accepted"):e.proposal.accepted===!1?this.status.set("rejected"):e.proposal.timeRemaining<=0?this.status.set("expired"):(this.status.set("pending"),this.startTimer())),this.loading.set(!1)},error:e=>{console.error("Erreur lors du chargement de la proposition:",e),this.error.set("Impossible de charger la proposition"),this.loading.set(!1)}})}loadBatch(t){this.borrowService.getBatchProposals(t).subscribe({next:e=>{if(e.success&&e.proposals){this.batchProposals.set({success:e.success,batchId:e.batchId,proposals:e.proposals,user:e.user,pro:e.pro});let o=e.proposals[0];this.timeRemaining.set(o.timeRemaining);let i=e.proposals.every(d=>d.accepted===!0),r=e.proposals.some(d=>d.accepted===!1);i?this.status.set("accepted"):r?this.status.set("rejected"):o.timeRemaining<=0?this.status.set("expired"):(this.status.set("pending"),this.startTimer())}this.loading.set(!1)},error:e=>{console.error("Erreur lors du chargement du batch:",e),this.error.set("Impossible de charger les propositions"),this.loading.set(!1)}})}startTimer(){this.timerInterval=setInterval(()=>{let t=this.timeRemaining()-1e3;this.timeRemaining.set(Math.max(0,t)),t<=0&&(this.status.set("expired"),this.stopTimer())},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}acceptProposal(){if(this.canInteract())if(this.loading.set(!0),this.isBatch()){let t=this.batchProposals()?.batchId;if(!t)return;this.borrowService.acceptBatch(t).subscribe({next:e=>{e.success&&(this.status.set("accepted"),this.stopTimer()),this.loading.set(!1)},error:e=>{console.error("Erreur lors de l'acceptation du batch:",e),this.error.set("Erreur lors de l'acceptation des propositions"),this.loading.set(!1)}})}else{let t=this.proposal()?.id;if(!t)return;this.borrowService.acceptProposal(t).subscribe({next:e=>{e.success&&(this.status.set("accepted"),this.stopTimer()),this.loading.set(!1)},error:e=>{console.error("Erreur lors de l'acceptation:",e),this.error.set("Erreur lors de l'acceptation de la proposition"),this.loading.set(!1)}})}}rejectProposal(){if(this.canInteract())if(this.loading.set(!0),this.isBatch()){let t=this.batchProposals()?.batchId;if(!t)return;this.borrowService.rejectBatch(t).subscribe({next:e=>{e.success&&(this.status.set("rejected"),this.stopTimer()),this.loading.set(!1)},error:e=>{console.error("Erreur lors du refus du batch:",e),this.error.set("Erreur lors du refus des propositions"),this.loading.set(!1)}})}else{let t=this.proposal()?.id;if(!t)return;this.borrowService.rejectProposal(t).subscribe({next:e=>{e.success&&(this.status.set("rejected"),this.stopTimer()),this.loading.set(!1)},error:e=>{console.error("Erreur lors du refus:",e),this.error.set("Erreur lors du refus de la proposition"),this.loading.set(!1)}})}}goBack(){this.router.navigate(["/utilisateurs/dashboard"])}getAuthToken(){let e=document.cookie.split(";").find(o=>o.trim().startsWith("auth_token="));return e?e.split("=")[1]:null}getBoxTypeName(t){return{1:"Boite Salade Verre",2:"Boite Salade Plastique",3:"Boite Frites",4:"Boite Pizza",5:"Gobelet",6:"Boite Burger"}[t]||`Type ${t}`}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-validation"]],decls:5,vars:3,consts:[[1,"pt-20","bg-gradient-to-br","from-green-50","to-blue-50","p-4"],[1,"max-w-3xl","mx-auto","pt-8"],[1,"bg-white","rounded-lg","shadow-lg","p-8","text-center"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-6"],[1,"bg-white","rounded-lg","shadow-lg","overflow-hidden"],[1,"inline-block","animate-spin","rounded-full","h-12","w-12","border-b-2","border-green-600"],[1,"mt-4","text-gray-600"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-red-600","mr-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-red-800","font-medium"],[1,"mt-4","px-4","py-2","bg-red-600","text-white","rounded-lg","hover:bg-red-700","transition-colors",3,"click"],[1,"p-6","border-b","border-gray-200"],[1,"flex","justify-between","items-start"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-gray-600","mt-1"],[1,"px-4","py-2","bg-yellow-100","text-yellow-800","rounded-full","font-medium"],[1,"px-4","py-2","bg-green-100","text-green-800","rounded-full","font-medium"],[1,"px-4","py-2","bg-red-100","text-red-800","rounded-full","font-medium"],[1,"px-4","py-2","bg-gray-100","text-gray-800","rounded-full","font-medium"],[1,"p-6"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"p-6","bg-gray-50","border-t","border-gray-200"],[1,"flex","gap-4"],[1,"w-full","px-6","py-3","bg-gray-600","text-white","rounded-lg","font-semibold","hover:bg-gray-700","transition-colors"],[1,"space-y-3","mb-6"],[1,"bg-gray-50","rounded-lg","p-4"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","mb-6"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-blue-800"],[1,"text-2xl","font-bold","text-blue-600"],[1,"space-y-3","text-sm"],[1,"flex","justify-between"],[1,"text-gray-600"],[1,"font-medium","text-gray-900"],[1,"flex","flex-col","gap-1"],[1,"text-sm","text-gray-600"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-right"],[1,"text-3xl","font-bold","text-green-600"],[1,"text-gray-500"],[1,"bg-gray-50","rounded-lg","p-4","mb-6"],[1,"flex-1","px-6","py-3","bg-white","border-2","border-red-600","text-red-600","rounded-lg","font-semibold","hover:bg-red-50","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"flex-1","px-6","py-3","bg-green-600","text-white","rounded-lg","font-semibold","hover:bg-green-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","shadow-lg",3,"click","disabled"],[1,"w-full","px-6","py-3","bg-gray-600","text-white","rounded-lg","font-semibold","hover:bg-gray-700","transition-colors",3,"click"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1),f(2,lo,4,0,"div",2),f(3,co,8,1,"div",3),f(4,So,22,8,"div",4),l()()),e&2&&(c(2),g(o.loading()?2:-1),c(),g(o.error()&&!o.loading()?3:-1),c(),g((o.proposal()||o.batchProposals())&&!o.loading()&&!o.error()?4:-1))},dependencies:[V],encapsulation:2})};var ha=[{path:"",component:Ue,children:[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",component:je},{path:"historique",component:qe},{path:"boites",component:Fe},{path:"parametres",component:$e},{path:"recharge",component:Ge},{path:"annule",component:We},{path:"borrow/validation/:id",component:Ke}]}];export{ha as USERS_ROUTES};
