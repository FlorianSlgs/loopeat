import './polyfills.server.mjs';
import{Ab as n,F as o,Fb as s,Gb as u,i as r,ib as a,m as e}from"./chunk-PMFNFDMQ.mjs";var c=class i{authService=e(s);authStateService=e(u);router=e(n);platformId=e(o);initialized=!1;async initializeAuth(){if(!a(this.platformId)){console.log("\u26A0\uFE0F AuthInit: SSR d\xE9tect\xE9, skip de l'initialisation");return}if(this.initialized){console.log("\u26A0\uFE0F AuthInit: D\xE9j\xE0 initialis\xE9");return}this.initialized=!0,console.log("\u{1F680} AuthInit: V\xE9rification de l'authentification au d\xE9marrage...");try{let t=await this.authService.getCurrentUser().toPromise();t&&t.success&&t.user?(console.log("\u2705 AuthInit: Utilisateur authentifi\xE9 d\xE9tect\xE9:",t.user.email),this.authStateService.setUser(t.user),console.log("\u2705 AuthInit: \xC9tat d'authentification restaur\xE9")):console.log("\u2139\uFE0F AuthInit: Pas d'utilisateur authentifi\xE9")}catch{console.log("\u2139\uFE0F AuthInit: Pas d'authentification active (normal si pas connect\xE9)")}}async logout(){console.log("\u{1F513} AuthInit: D\xE9connexion...");try{await this.authService.logout().toPromise(),this.authStateService.clearState(),console.log("\u2705 AuthInit: D\xE9connexion r\xE9ussie"),this.router.navigate(["/connexion"])}catch(t){console.error("\u274C AuthInit: Erreur lors de la d\xE9connexion:",t),this.authStateService.clearState(),this.router.navigate(["/connexion"])}}isAuthenticated(){return this.authStateService.getCurrentUser()()!==null}getCurrentUser(){return this.authStateService.getCurrentUser()}static \u0275fac=function(l){return new(l||i)};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};export{c as a};
