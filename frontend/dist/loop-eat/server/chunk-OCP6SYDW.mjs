import './polyfills.server.mjs';
import{a as io}from"./chunk-N2QFA25L.mjs";import{a as to,c as no,e as ro,j as oo}from"./chunk-CJZPNBC2.mjs";import{Aa as $,Ab as ze,Ba as st,Bb as Qr,Ca as Xr,Cb as eo,Da as Yr,Ea as Jr,Eb as Se,F as jr,L as Ze,M as f,Na as qe,Oa as at,Q as G,aa as k,ba as O,ca as zr,da as ve,ea as Ce,eb as Kr,fa as Ee,fb as _e,ga as y,ha as x,i as Te,ia as oe,ib as Yn,ja as d,ka as p,la as ie,m as M,ma as j,na as le,oa as we,pa as B,pb as je,q as D,qa as C,r as L,ra as $r,s as ae,sa as Wr,t as ge,ta as Hr,ua as Jt,va as Gr,wa as De,x as w,xb as Kt,ya as c,yb as Zr,za as V}from"./chunk-4CQLODFQ.mjs";import{a as ce,b as Ne,c as R,e as F,f as _s,g as Q}from"./chunk-KXIJJ5ZC.mjs";var lo=F((nd,ao)=>{"use strict";var lt=R("fs"),so=R("url"),bs=R("child_process").spawn;ao.exports=Jn;Jn.XMLHttpRequest=Jn;function Jn(n){"use strict";n=n||{};var e=this,t=R("http"),r=R("https"),o,i,s={},u=!1,m={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},g=Object.assign({},m),a=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],l=["TRACE","TRACK","CONNECT"],h=!1,S=!1,P=!1,_={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),this.status=null,this.statusText=null;var v=function(b){return u||b&&a.indexOf(b.toLowerCase())===-1},N=function(b){return b&&l.indexOf(b)===-1};this.open=function(b,E,H,U,Z){if(this.abort(),S=!1,P=!1,!N(b))throw new Error("SecurityError: Request method not allowed");s={method:b,url:E.toString(),async:typeof H!="boolean"?!0:H,user:U||null,password:Z||null},I(this.OPENED)},this.setDisableHeaderCheck=function(b){u=b},this.setRequestHeader=function(b,E){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!v(b))return console.warn('Refused to set unsafe header "'+b+'"'),!1;if(h)throw new Error("INVALID_STATE_ERR: send flag is true");return g[b]=E,!0},this.getResponseHeader=function(b){return typeof b=="string"&&this.readyState>this.OPENED&&i.headers[b.toLowerCase()]&&!S?i.headers[b.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||S)return"";var b="";for(var E in i.headers)E!=="set-cookie"&&E!=="set-cookie2"&&(b+=E+": "+i.headers[E]+`\r
`);return b.substr(0,b.length-2)},this.getRequestHeader=function(b){return typeof b=="string"&&g[b]?g[b]:""},this.send=function(b){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(h)throw new Error("INVALID_STATE_ERR: send has already been called");var E=!1,H=!1,U=so.parse(s.url),Z;switch(U.protocol){case"https:":E=!0;case"http:":Z=U.hostname;break;case"file:":H=!0;break;case void 0:case"":Z="localhost";break;default:throw new Error("Protocol not supported.")}if(H){if(s.method!=="GET")throw new Error("XMLHttpRequest: Only GET method is supported");if(s.async)lt.readFile(unescape(U.pathname),function(re,Ke){re?e.handleError(re,re.errno||-1):(e.status=200,e.responseText=Ke.toString("utf8"),e.response=Ke,I(e.DONE))});else try{this.response=lt.readFileSync(unescape(U.pathname)),this.responseText=this.response.toString("utf8"),this.status=200,I(e.DONE)}catch(re){this.handleError(re,re.errno||-1)}return}var ne=U.port||(E?443:80),ye=U.pathname+(U.search?U.search:"");if(g.Host=Z,E&&ne===443||ne===80||(g.Host+=":"+U.port),s.user){typeof s.password>"u"&&(s.password="");var $n=new Buffer(s.user+":"+s.password);g.Authorization="Basic "+$n.toString("base64")}if(s.method==="GET"||s.method==="HEAD")b=null;else if(b){g["Content-Length"]=Buffer.isBuffer(b)?b.length:Buffer.byteLength(b);var us=Object.keys(g);us.some(function(re){return re.toLowerCase()==="content-type"})||(g["Content-Type"]="text/plain;charset=UTF-8")}else s.method==="POST"&&(g["Content-Length"]=0);var ps=n.agent||!1,Me={host:Z,port:ne,path:ye,method:s.method,headers:g,agent:ps};if(E&&(Me.pfx=n.pfx,Me.key=n.key,Me.passphrase=n.passphrase,Me.cert=n.cert,Me.ca=n.ca,Me.ciphers=n.ciphers,Me.rejectUnauthorized=n.rejectUnauthorized!==!1),S=!1,s.async){var Wn=E?r.request:t.request;h=!0,e.dispatchEvent("readystatechange");var Hn=function(re){if(i=re,i.statusCode===302||i.statusCode===303||i.statusCode===307){s.url=i.headers.location;var Ke=so.parse(s.url);Z=Ke.hostname;var Ve={hostname:Ke.hostname,port:Ke.port,path:Ke.path,method:i.statusCode===303?"GET":s.method,headers:g};E&&(Ve.pfx=n.pfx,Ve.key=n.key,Ve.passphrase=n.passphrase,Ve.cert=n.cert,Ve.ca=n.ca,Ve.ciphers=n.ciphers,Ve.rejectUnauthorized=n.rejectUnauthorized!==!1),o=Wn(Ve,Hn).on("error",Gn),o.end();return}I(e.HEADERS_RECEIVED),e.status=i.statusCode,i.on("data",function(Yt){if(Yt){var gs=Buffer.from(Yt);e.response=Buffer.concat([e.response,gs])}h&&I(e.LOADING)}),i.on("end",function(){h&&(h=!1,I(e.DONE),e.responseText=e.response.toString("utf8"))}),i.on("error",function(Yt){e.handleError(Yt)})},Gn=function(re){if(o.reusedSocket&&re.code==="ECONNRESET")return Wn(Me,Hn).on("error",Gn);e.handleError(re)};o=Wn(Me,Hn).on("error",Gn),n.autoUnref&&o.on("socket",re=>{re.unref()}),b&&o.write(b),o.end(),e.dispatchEvent("loadstart")}else{var wt=".node-xmlhttprequest-content-"+process.pid,St=".node-xmlhttprequest-sync-"+process.pid;lt.writeFileSync(St,"","utf8");for(var fs="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(E?"s":"")+".request;var options = "+JSON.stringify(Me)+";var responseText = '';var responseData = Buffer.alloc(0);var req = doRequest(options, function(response) {response.on('data', function(chunk) {  var data = Buffer.from(chunk);  responseText += data.toString('utf8');  responseData = Buffer.concat([responseData, data]);});response.on('end', function() {fs.writeFileSync('"+wt+"', JSON.stringify({err: null, data: {statusCode: response.statusCode, headers: response.headers, text: responseText, data: responseData.toString('base64')}}), 'utf8');fs.unlinkSync('"+St+"');});response.on('error', function(error) {fs.writeFileSync('"+wt+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+St+"');});}).on('error', function(error) {fs.writeFileSync('"+wt+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+St+"');});"+(b?"req.write('"+JSON.stringify(b).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",hs=bs(process.argv[0],["-e",fs]),td;lt.existsSync(St););if(e.responseText=lt.readFileSync(wt,"utf8"),hs.stdin.end(),lt.unlinkSync(wt),e.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var ms=JSON.parse(e.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,""));e.handleError(ms,503)}else{e.status=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1");var Xn=JSON.parse(e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"));i={statusCode:e.status,headers:Xn.data.headers},e.responseText=Xn.data.text,e.response=Buffer.from(Xn.data.data,"base64"),I(e.DONE,!0)}}},this.handleError=function(b,E){this.status=E||0,this.statusText=b,this.responseText=b.stack,S=!0,I(this.DONE)},this.abort=function(){o&&(o.abort(),o=null),g=Object.assign({},m),this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),S=P=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||h)&&this.readyState!==this.DONE&&(h=!1,I(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(b,E){b in _||(_[b]=[]),_[b].push(E)},this.removeEventListener=function(b,E){b in _&&(_[b]=_[b].filter(function(H){return H!==E}))},this.dispatchEvent=function(b){if(typeof e["on"+b]=="function"&&(this.readyState===this.DONE&&s.async?setTimeout(function(){e["on"+b]()},0):e["on"+b]()),b in _)for(let E=0,H=_[b].length;E<H;E++)this.readyState===this.DONE?setTimeout(function(){_[b][E].call(e)},0):_[b][E].call(e)};var I=function(b){if(!(e.readyState===b||e.readyState===e.UNSENT&&P)&&(e.readyState=b,(s.async||e.readyState<e.OPENED||e.readyState===e.DONE)&&e.dispatchEvent("readystatechange"),e.readyState===e.DONE)){let E;P?E="abort":S?E="error":E="load",e.dispatchEvent(E),e.dispatchEvent("loadend")}}}});var rn=F((_d,Eo)=>{"use strict";var ct=1e3,dt=ct*60,ut=dt*60,Qe=ut*24,Ss=Qe*7,ks=Qe*365.25;Eo.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return Os(n);if(t==="number"&&isFinite(n))return e.long?Ms(n):Ps(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function Os(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*ks;case"weeks":case"week":case"w":return t*Ss;case"days":case"day":case"d":return t*Qe;case"hours":case"hour":case"hrs":case"hr":case"h":return t*ut;case"minutes":case"minute":case"mins":case"min":case"m":return t*dt;case"seconds":case"second":case"secs":case"sec":case"s":return t*ct;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function Ps(n){var e=Math.abs(n);return e>=Qe?Math.round(n/Qe)+"d":e>=ut?Math.round(n/ut)+"h":e>=dt?Math.round(n/dt)+"m":e>=ct?Math.round(n/ct)+"s":n+"ms"}function Ms(n){var e=Math.abs(n);return e>=Qe?nn(n,e,Qe,"day"):e>=ut?nn(n,e,ut,"hour"):e>=dt?nn(n,e,dt,"minute"):e>=ct?nn(n,e,ct,"second"):n+" ms"}function nn(n,e,t,r){var o=e>=t*1.5;return Math.round(n/t)+" "+r+(o?"s":"")}});var tr=F((bd,wo)=>{"use strict";function Ts(n){t.debug=t,t.default=t,t.coerce=m,t.disable=i,t.enable=o,t.enabled=s,t.humanize=rn(),t.destroy=g,Object.keys(n).forEach(a=>{t[a]=n[a]}),t.names=[],t.skips=[],t.formatters={};function e(a){let l=0;for(let h=0;h<a.length;h++)l=(l<<5)-l+a.charCodeAt(h),l|=0;return t.colors[Math.abs(l)%t.colors.length]}t.selectColor=e;function t(a){let l,h=null,S,P;function _(...v){if(!_.enabled)return;let N=_,I=Number(new Date),b=I-(l||I);N.diff=b,N.prev=l,N.curr=I,l=I,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let E=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(U,Z)=>{if(U==="%%")return"%";E++;let ne=t.formatters[Z];if(typeof ne=="function"){let ye=v[E];U=ne.call(N,ye),v.splice(E,1),E--}return U}),t.formatArgs.call(N,v),(N.log||t.log).apply(N,v)}return _.namespace=a,_.useColors=t.useColors(),_.color=t.selectColor(a),_.extend=r,_.destroy=t.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(S!==t.namespaces&&(S=t.namespaces,P=t.enabled(a)),P),set:v=>{h=v}}),typeof t.init=="function"&&t.init(_),_}function r(a,l){let h=t(this.namespace+(typeof l>"u"?":":l)+a);return h.log=this.log,h}function o(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];let l,h=(typeof a=="string"?a:"").split(/[\s,]+/),S=h.length;for(l=0;l<S;l++)h[l]&&(a=h[l].replace(/\*/g,".*?"),a[0]==="-"?t.skips.push(new RegExp("^"+a.slice(1)+"$")):t.names.push(new RegExp("^"+a+"$")))}function i(){let a=[...t.names.map(u),...t.skips.map(u).map(l=>"-"+l)].join(",");return t.enable(""),a}function s(a){if(a[a.length-1]==="*")return!0;let l,h;for(l=0,h=t.skips.length;l<h;l++)if(t.skips[l].test(a))return!1;for(l=0,h=t.names.length;l<h;l++)if(t.names[l].test(a))return!0;return!1}function u(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function m(a){return a instanceof Error?a.stack||a.message:a}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}wo.exports=Ts});var So=F((de,on)=>{"use strict";de.formatArgs=Ns;de.save=Ds;de.load=Ls;de.useColors=Rs;de.storage=Bs();de.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();de.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Rs(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let n;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(n=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(n[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ns(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+on.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(t++,o==="%c"&&(r=t))}),n.splice(r,0,e)}de.log=console.debug||console.log||(()=>{});function Ds(n){try{n?de.storage.setItem("debug",n):de.storage.removeItem("debug")}catch{}}function Ls(){let n;try{n=de.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function Bs(){try{return localStorage}catch{}}on.exports=tr()(de);var{formatters:Is}=on.exports;Is.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Oo=F((xd,ko)=>{"use strict";ko.exports=(n,e=process.argv)=>{let t=n.startsWith("-")?"":n.length===1?"-":"--",r=e.indexOf(t+n),o=e.indexOf("--");return r!==-1&&(o===-1||r<o)}});var sn=F((yd,Mo)=>{"use strict";var Fs=R("os"),Po=R("tty"),be=Oo(),{env:X}=process,$e;be("no-color")||be("no-colors")||be("color=false")||be("color=never")?$e=0:(be("color")||be("colors")||be("color=true")||be("color=always"))&&($e=1);"FORCE_COLOR"in X&&(X.FORCE_COLOR==="true"?$e=1:X.FORCE_COLOR==="false"?$e=0:$e=X.FORCE_COLOR.length===0?1:Math.min(parseInt(X.FORCE_COLOR,10),3));function nr(n){return n===0?!1:{level:n,hasBasic:!0,has256:n>=2,has16m:n>=3}}function rr(n,e){if($e===0)return 0;if(be("color=16m")||be("color=full")||be("color=truecolor"))return 3;if(be("color=256"))return 2;if(n&&!e&&$e===void 0)return 0;let t=$e||0;if(X.TERM==="dumb")return t;if(process.platform==="win32"){let r=Fs.release().split(".");return Number(r[0])>=10&&Number(r[2])>=10586?Number(r[2])>=14931?3:2:1}if("CI"in X)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(r=>r in X)||X.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in X)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(X.TEAMCITY_VERSION)?1:0;if(X.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in X){let r=parseInt((X.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(X.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(X.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(X.TERM)||"COLORTERM"in X?1:t}function As(n){let e=rr(n,n&&n.isTTY);return nr(e)}Mo.exports={supportsColor:As,stdout:nr(rr(!0,Po.isatty(1))),stderr:nr(rr(!0,Po.isatty(2)))}});var Ro=F((Y,ln)=>{"use strict";var Us=R("tty"),an=R("util");Y.init=Hs;Y.log=zs;Y.formatArgs=qs;Y.save=$s;Y.load=Ws;Y.useColors=Vs;Y.destroy=an.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Y.colors=[6,2,3,4,5,1];try{let n=sn();n&&(n.stderr||n).level>=2&&(Y.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Y.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(o,i)=>i.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function Vs(){return"colors"in Y.inspectOpts?!!Y.inspectOpts.colors:Us.isatty(process.stderr.fd)}function qs(n){let{namespace:e,useColors:t}=this;if(t){let r=this.color,o="\x1B[3"+(r<8?r:"8;5;"+r),i=`  ${o};1m${e} \x1B[0m`;n[0]=i+n[0].split(`
`).join(`
`+i),n.push(o+"m+"+ln.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=js()+e+" "+n[0]}function js(){return Y.inspectOpts.hideDate?"":new Date().toISOString()+" "}function zs(...n){return process.stderr.write(an.formatWithOptions(Y.inspectOpts,...n)+`
`)}function $s(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function Ws(){return process.env.DEBUG}function Hs(n){n.inspectOpts={};let e=Object.keys(Y.inspectOpts);for(let t=0;t<e.length;t++)n.inspectOpts[e[t]]=Y.inspectOpts[e[t]]}ln.exports=tr()(Y);var{formatters:To}=ln.exports;To.o=function(n){return this.inspectOpts.colors=this.useColors,an.inspect(n,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};To.O=function(n){return this.inspectOpts.colors=this.useColors,an.inspect(n,this.inspectOpts)}});var et=F((vd,or)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?or.exports=So():or.exports=Ro()});var qo=F((qd,Vo)=>{"use strict";var{Duplex:Ks}=R("stream");function Ao(n){n.emit("close")}function Zs(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Uo(n){this.removeListener("error",Uo),this.destroy(),this.listenerCount("error")===0&&this.emit("error",n)}function Qs(n,e){let t=!0,r=new Ks(Ne(ce({},e),{autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1}));return n.on("message",function(i,s){let u=!s&&r._readableState.objectMode?i.toString():i;r.push(u)||n.pause()}),n.once("error",function(i){r.destroyed||(t=!1,r.destroy(i))}),n.once("close",function(){r.destroyed||r.push(null)}),r._destroy=function(o,i){if(n.readyState===n.CLOSED){i(o),process.nextTick(Ao,r);return}let s=!1;n.once("error",function(m){s=!0,i(m)}),n.once("close",function(){s||i(o),process.nextTick(Ao,r)}),t&&n.terminate()},r._final=function(o){if(n.readyState===n.CONNECTING){n.once("open",function(){r._final(o)});return}n._socket!==null&&(n._socket._writableState.finished?(o(),r._readableState.endEmitted&&r.destroy()):(n._socket.once("finish",function(){o()}),n.close()))},r._read=function(){n.isPaused&&n.resume()},r._write=function(o,i,s){if(n.readyState===n.CONNECTING){n.once("open",function(){r._write(o,i,s)});return}n.send(o,s)},r.on("end",Zs),r.on("error",Uo),r}Vo.exports=Qs});var We=F((zd,jo)=>{"use strict";jo.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Nt=F(($d,un)=>{"use strict";var{EMPTY_BUFFER:ea}=We(),ar=Buffer[Symbol.species];function ta(n,e){if(n.length===0)return ea;if(n.length===1)return n[0];let t=Buffer.allocUnsafe(e),r=0;for(let o=0;o<n.length;o++){let i=n[o];t.set(i,r),r+=i.length}return r<e?new ar(t.buffer,t.byteOffset,r):t}function zo(n,e,t,r,o){for(let i=0;i<o;i++)t[r+i]=n[i]^e[i&3]}function $o(n,e){for(let t=0;t<n.length;t++)n[t]^=e[t&3]}function na(n){return n.length===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.length)}function lr(n){if(lr.readOnly=!0,Buffer.isBuffer(n))return n;let e;return n instanceof ArrayBuffer?e=new ar(n):ArrayBuffer.isView(n)?e=new ar(n.buffer,n.byteOffset,n.byteLength):(e=Buffer.from(n),lr.readOnly=!1),e}un.exports={concat:ta,mask:zo,toArrayBuffer:na,toBuffer:lr,unmask:$o};if(!process.env.WS_NO_BUFFER_UTIL)try{let n=R("bufferutil");un.exports.mask=function(e,t,r,o,i){i<48?zo(e,t,r,o,i):n.mask(e,t,r,o,i)},un.exports.unmask=function(e,t){e.length<32?$o(e,t):n.unmask(e,t)}}catch{}});var Go=F((Wd,Ho)=>{"use strict";var Wo=Symbol("kDone"),cr=Symbol("kRun"),dr=class{constructor(e){this[Wo]=()=>{this.pending--,this[cr]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[cr]()}[cr](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[Wo])}}};Ho.exports=dr});var Bt=F((Hd,Ko)=>{"use strict";var Dt=R("zlib"),Xo=Nt(),ra=Go(),{kStatusCode:Yo}=We(),oa=Buffer[Symbol.species],ia=Buffer.from([0,0,255,255]),hn=Symbol("permessage-deflate"),Fe=Symbol("total-length"),Lt=Symbol("callback"),He=Symbol("buffers"),fn=Symbol("error"),pn,ur=class{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!pn){let o=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;pn=new ra(o)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Lt];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(o=>!(t.serverNoContextTakeover===!1&&o.server_no_context_takeover||o.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>o.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!o.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{let o=t[r];if(o.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(o=o[0],r==="client_max_window_bits"){if(o!==!0){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${o}`);o=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${o}`)}else if(r==="server_max_window_bits"){let i=+o;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${o}`);o=i}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(o!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${o}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=o})}),e}decompress(e,t,r){pn.add(o=>{this._decompress(e,t,(i,s)=>{o(),r(i,s)})})}compress(e,t,r){pn.add(o=>{this._compress(e,t,(i,s)=>{o(),r(i,s)})})}_decompress(e,t,r){let o=this._isServer?"client":"server";if(!this._inflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?Dt.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=Dt.createInflateRaw(Ne(ce({},this._options.zlibInflateOptions),{windowBits:s})),this._inflate[hn]=this,this._inflate[Fe]=0,this._inflate[He]=[],this._inflate.on("error",aa),this._inflate.on("data",Jo)}this._inflate[Lt]=r,this._inflate.write(e),t&&this._inflate.write(ia),this._inflate.flush(()=>{let i=this._inflate[fn];if(i){this._inflate.close(),this._inflate=null,r(i);return}let s=Xo.concat(this._inflate[He],this._inflate[Fe]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Fe]=0,this._inflate[He]=[],t&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),r(null,s)})}_compress(e,t,r){let o=this._isServer?"server":"client";if(!this._deflate){let i=`${o}_max_window_bits`,s=typeof this.params[i]!="number"?Dt.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=Dt.createDeflateRaw(Ne(ce({},this._options.zlibDeflateOptions),{windowBits:s})),this._deflate[Fe]=0,this._deflate[He]=[],this._deflate.on("data",sa)}this._deflate[Lt]=r,this._deflate.write(e),this._deflate.flush(Dt.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=Xo.concat(this._deflate[He],this._deflate[Fe]);t&&(i=new oa(i.buffer,i.byteOffset,i.length-4)),this._deflate[Lt]=null,this._deflate[Fe]=0,this._deflate[He]=[],t&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),r(null,i)})}};Ko.exports=ur;function sa(n){this[He].push(n),this[Fe]+=n.length}function Jo(n){if(this[Fe]+=n.length,this[hn]._maxPayload<1||this[Fe]<=this[hn]._maxPayload){this[He].push(n);return}this[fn]=new RangeError("Max payload size exceeded"),this[fn].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[fn][Yo]=1009,this.removeListener("data",Jo),this.reset()}function aa(n){this[hn]._inflate=null,n[Yo]=1007,this[Lt](n)}});var It=F((Xd,mn)=>{"use strict";var{isUtf8:Zo}=R("buffer"),la=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function ca(n){return n>=1e3&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999}function pr(n){let e=n.length,t=0;for(;t<e;)if((n[t]&128)===0)t++;else if((n[t]&224)===192){if(t+1===e||(n[t+1]&192)!==128||(n[t]&254)===192)return!1;t+=2}else if((n[t]&240)===224){if(t+2>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||n[t]===224&&(n[t+1]&224)===128||n[t]===237&&(n[t+1]&224)===160)return!1;t+=3}else if((n[t]&248)===240){if(t+3>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||(n[t+3]&192)!==128||n[t]===240&&(n[t+1]&240)===128||n[t]===244&&n[t+1]>143||n[t]>244)return!1;t+=4}else return!1;return!0}mn.exports={isValidStatusCode:ca,isValidUTF8:pr,tokenChars:la};if(Zo)mn.exports.isValidUTF8=function(n){return n.length<24?pr(n):Zo(n)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let n=R("utf-8-validate");mn.exports.isValidUTF8=function(e){return e.length<32?pr(e):n(e)}}catch{}});var _r=F((Yd,ii)=>{"use strict";var{Writable:da}=R("stream"),Qo=Bt(),{BINARY_TYPES:ua,EMPTY_BUFFER:ei,kStatusCode:pa,kWebSocket:fa}=We(),{concat:fr,toArrayBuffer:ha,unmask:ma}=Nt(),{isValidStatusCode:ga,isValidUTF8:ti}=It(),gn=Buffer[Symbol.species],xe=0,ni=1,ri=2,oi=3,hr=4,mr=5,_n=6,gr=class extends da{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||ua[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[fa]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=xe}_write(e,t,r){if(this._opcode===8&&this._state==xe)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let r=this._buffers[0];return this._buffers[0]=new gn(r.buffer,r.byteOffset+e,r.length-e),new gn(r.buffer,r.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],o=t.length-e;e>=r.length?t.set(this._buffers.shift(),o):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),o),this._buffers[0]=new gn(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case xe:this.getInfo(e);break;case ni:this.getPayloadLength16(e);break;case ri:this.getPayloadLength64(e);break;case oi:this.getMask();break;case hr:this.getData(e);break;case mr:case _n:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((t[0]&48)!==0){let o=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(o);return}let r=(t[0]&64)===64;if(r&&!this._extensions[Qo.extensionName]){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(r){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(!this._fragmented){let o=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let o=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(o);return}if(r){let o=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(o);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let o=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(o);return}}else{let o=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(o);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked){let o=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(o);return}}else if(this._masked){let o=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(o);return}this._payloadLength===126?this._state=ni:this._payloadLength===127?this._state=ri:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);if(r>Math.pow(2,21)-1){let o=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(o);return}this._payloadLength=r*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let t=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(t);return}this._masked?this._state=oi:this._state=hr}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=hr}getData(e){let t=ei;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&ma(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=mr,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[Qo.extensionName].decompress(e,this._fin,(o,i)=>{if(o)return t(o);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let s=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(s);return}this._fragments.push(i)}this.dataMessage(t),this._state===xe&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=xe;return}let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=fr(r,t):this._binaryType==="arraybuffer"?o=ha(fr(r,t)):o=r,this._allowSynchronousEvents?(this.emit("message",o,!0),this._state=xe):(this._state=_n,setImmediate(()=>{this.emit("message",o,!0),this._state=xe,this.startLoop(e)}))}else{let o=fr(r,t);if(!this._skipUTF8Validation&&!ti(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===mr||this._allowSynchronousEvents?(this.emit("message",o,!1),this._state=xe):(this._state=_n,setImmediate(()=>{this.emit("message",o,!1),this._state=xe,this.startLoop(e)}))}}controlMessage(e,t){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,ei),this.end();else{let r=e.readUInt16BE(0);if(!ga(r)){let i=this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");t(i);return}let o=new gn(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!ti(o)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(i);return}this._loop=!1,this.emit("conclude",r,o),this.end()}this._state=xe;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=xe):(this._state=_n,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=xe,this.startLoop(t)}))}createError(e,t,r,o,i){this._loop=!1,this._errored=!0;let s=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(s,this.createError),s.code=i,s[pa]=o,s}};ii.exports=gr});var xr=F((Kd,li)=>{"use strict";var{Duplex:Jd}=R("stream"),{randomFillSync:_a}=R("crypto"),si=Bt(),{EMPTY_BUFFER:ba}=We(),{isValidStatusCode:xa}=It(),{mask:ai,toBuffer:ft}=Nt(),Pe=Symbol("kByteLength"),ya=Buffer.alloc(4),bn=8*1024,tt,ht=bn,br=class n{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r,o=!1,i=2,s=!1;t.mask&&(r=t.maskBuffer||ya,t.generateMask?t.generateMask(r):(ht===bn&&(tt===void 0&&(tt=Buffer.alloc(bn)),_a(tt,0,bn),ht=0),r[0]=tt[ht++],r[1]=tt[ht++],r[2]=tt[ht++],r[3]=tt[ht++]),s=(r[0]|r[1]|r[2]|r[3])===0,i=6);let u;typeof e=="string"?(!t.mask||s)&&t[Pe]!==void 0?u=t[Pe]:(e=Buffer.from(e),u=e.length):(u=e.length,o=t.mask&&t.readOnly&&!s);let m=u;u>=65536?(i+=8,m=127):u>125&&(i+=2,m=126);let g=Buffer.allocUnsafe(o?u+i:i);return g[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(g[0]|=64),g[1]=m,m===126?g.writeUInt16BE(u,2):m===127&&(g[2]=g[3]=0,g.writeUIntBE(u,4,6)),t.mask?(g[1]|=128,g[i-4]=r[0],g[i-3]=r[1],g[i-2]=r[2],g[i-1]=r[3],s?[g,e]:o?(ai(e,r,g,i,u),[g]):(ai(e,r,e,0,u),[g,e])):[g,e]}close(e,t,r,o){let i;if(e===void 0)i=ba;else{if(typeof e!="number"||!xa(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let u=Buffer.byteLength(t);if(u>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+u),i.writeUInt16BE(e,0),typeof t=="string"?i.write(t,2):i.set(t,2)}}let s={[Pe]:i.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,i,!1,s,o]):this.sendFrame(n.frame(i,s),o)}ping(e,t,r){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):(e=ft(e),o=e.length,i=ft.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[Pe]:o,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,s,r]):this.sendFrame(n.frame(e,s),r)}pong(e,t,r){let o,i;if(typeof e=="string"?(o=Buffer.byteLength(e),i=!1):(e=ft(e),o=e.length,i=ft.readOnly),o>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[Pe]:o,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,s,r]):this.sendFrame(n.frame(e,s),r)}send(e,t,r){let o=this._extensions[si.extensionName],i=t.binary?2:1,s=t.compress,u,m;if(typeof e=="string"?(u=Buffer.byteLength(e),m=!1):(e=ft(e),u=e.length,m=ft.readOnly),this._firstFragment?(this._firstFragment=!1,s&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(s=u>=o._threshold),this._compress=s):(s=!1,i=0),t.fin&&(this._firstFragment=!0),o){let g={[Pe]:u,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:m,rsv1:s};this._deflating?this.enqueue([this.dispatch,e,this._compress,g,r]):this.dispatch(e,this._compress,g,r)}else this.sendFrame(n.frame(e,{[Pe]:u,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:m,rsv1:!1}),r)}dispatch(e,t,r,o){if(!t){this.sendFrame(n.frame(e,r),o);return}let i=this._extensions[si.extensionName];this._bufferedBytes+=r[Pe],this._deflating=!0,i.compress(e,r.fin,(s,u)=>{if(this._socket.destroyed){let m=new Error("The socket was closed while data was being compressed");typeof o=="function"&&o(m);for(let g=0;g<this._queue.length;g++){let a=this._queue[g],l=a[a.length-1];typeof l=="function"&&l(m)}return}this._bufferedBytes-=r[Pe],this._deflating=!1,r.readOnly=!1,this.sendFrame(n.frame(u,r),o),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][Pe],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][Pe],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};li.exports=br});var _i=F((Zd,gi)=>{"use strict";var{kForOnEventAttribute:Ft,kListener:yr}=We(),ci=Symbol("kCode"),di=Symbol("kData"),ui=Symbol("kError"),pi=Symbol("kMessage"),fi=Symbol("kReason"),mt=Symbol("kTarget"),hi=Symbol("kType"),mi=Symbol("kWasClean"),Ae=class{constructor(e){this[mt]=null,this[hi]=e}get target(){return this[mt]}get type(){return this[hi]}};Object.defineProperty(Ae.prototype,"target",{enumerable:!0});Object.defineProperty(Ae.prototype,"type",{enumerable:!0});var nt=class extends Ae{constructor(e,t={}){super(e),this[ci]=t.code===void 0?0:t.code,this[fi]=t.reason===void 0?"":t.reason,this[mi]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[ci]}get reason(){return this[fi]}get wasClean(){return this[mi]}};Object.defineProperty(nt.prototype,"code",{enumerable:!0});Object.defineProperty(nt.prototype,"reason",{enumerable:!0});Object.defineProperty(nt.prototype,"wasClean",{enumerable:!0});var gt=class extends Ae{constructor(e,t={}){super(e),this[ui]=t.error===void 0?null:t.error,this[pi]=t.message===void 0?"":t.message}get error(){return this[ui]}get message(){return this[pi]}};Object.defineProperty(gt.prototype,"error",{enumerable:!0});Object.defineProperty(gt.prototype,"message",{enumerable:!0});var At=class extends Ae{constructor(e,t={}){super(e),this[di]=t.data===void 0?null:t.data}get data(){return this[di]}};Object.defineProperty(At.prototype,"data",{enumerable:!0});var va={addEventListener(n,e,t={}){for(let o of this.listeners(n))if(!t[Ft]&&o[yr]===e&&!o[Ft])return;let r;if(n==="message")r=function(i,s){let u=new At("message",{data:s?i:i.toString()});u[mt]=this,xn(e,this,u)};else if(n==="close")r=function(i,s){let u=new nt("close",{code:i,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});u[mt]=this,xn(e,this,u)};else if(n==="error")r=function(i){let s=new gt("error",{error:i,message:i.message});s[mt]=this,xn(e,this,s)};else if(n==="open")r=function(){let i=new Ae("open");i[mt]=this,xn(e,this,i)};else return;r[Ft]=!!t[Ft],r[yr]=e,t.once?this.once(n,r):this.on(n,r)},removeEventListener(n,e){for(let t of this.listeners(n))if(t[yr]===e&&!t[Ft]){this.removeListener(n,t);break}}};gi.exports={CloseEvent:nt,ErrorEvent:gt,Event:Ae,EventTarget:va,MessageEvent:At};function xn(n,e,t){typeof n=="object"&&n.handleEvent?n.handleEvent.call(n,t):n.call(e,t)}});var vr=F((Qd,bi)=>{"use strict";var{tokenChars:Ut}=It();function Re(n,e,t){n[e]===void 0?n[e]=[t]:n[e].push(t)}function Ca(n){let e=Object.create(null),t=Object.create(null),r=!1,o=!1,i=!1,s,u,m=-1,g=-1,a=-1,l=0;for(;l<n.length;l++)if(g=n.charCodeAt(l),s===void 0)if(a===-1&&Ut[g]===1)m===-1&&(m=l);else if(l!==0&&(g===32||g===9))a===-1&&m!==-1&&(a=l);else if(g===59||g===44){if(m===-1)throw new SyntaxError(`Unexpected character at index ${l}`);a===-1&&(a=l);let S=n.slice(m,a);g===44?(Re(e,S,t),t=Object.create(null)):s=S,m=a=-1}else throw new SyntaxError(`Unexpected character at index ${l}`);else if(u===void 0)if(a===-1&&Ut[g]===1)m===-1&&(m=l);else if(g===32||g===9)a===-1&&m!==-1&&(a=l);else if(g===59||g===44){if(m===-1)throw new SyntaxError(`Unexpected character at index ${l}`);a===-1&&(a=l),Re(t,n.slice(m,a),!0),g===44&&(Re(e,s,t),t=Object.create(null),s=void 0),m=a=-1}else if(g===61&&m!==-1&&a===-1)u=n.slice(m,l),m=a=-1;else throw new SyntaxError(`Unexpected character at index ${l}`);else if(o){if(Ut[g]!==1)throw new SyntaxError(`Unexpected character at index ${l}`);m===-1?m=l:r||(r=!0),o=!1}else if(i)if(Ut[g]===1)m===-1&&(m=l);else if(g===34&&m!==-1)i=!1,a=l;else if(g===92)o=!0;else throw new SyntaxError(`Unexpected character at index ${l}`);else if(g===34&&n.charCodeAt(l-1)===61)i=!0;else if(a===-1&&Ut[g]===1)m===-1&&(m=l);else if(m!==-1&&(g===32||g===9))a===-1&&(a=l);else if(g===59||g===44){if(m===-1)throw new SyntaxError(`Unexpected character at index ${l}`);a===-1&&(a=l);let S=n.slice(m,a);r&&(S=S.replace(/\\/g,""),r=!1),Re(t,u,S),g===44&&(Re(e,s,t),t=Object.create(null),s=void 0),u=void 0,m=a=-1}else throw new SyntaxError(`Unexpected character at index ${l}`);if(m===-1||i||g===32||g===9)throw new SyntaxError("Unexpected end of input");a===-1&&(a=l);let h=n.slice(m,a);return s===void 0?Re(e,h,t):(u===void 0?Re(t,h,!0):r?Re(t,u,h.replace(/\\/g,"")):Re(t,u,h),Re(e,s,t)),e}function Ea(n){return Object.keys(n).map(e=>{let t=n[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(o=>{let i=r[o];return Array.isArray(i)||(i=[i]),i.map(s=>s===!0?o:`${o}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}bi.exports={format:Ea,parse:Ca}});var kr=F((nu,Mi)=>{"use strict";var wa=R("events"),Sa=R("https"),ka=R("http"),vi=R("net"),Oa=R("tls"),{randomBytes:Pa,createHash:Ma}=R("crypto"),{Duplex:eu,Readable:tu}=R("stream"),{URL:Cr}=R("url"),Ge=Bt(),Ta=_r(),Ra=xr(),{BINARY_TYPES:xi,EMPTY_BUFFER:yn,GUID:Na,kForOnEventAttribute:Er,kListener:Da,kStatusCode:La,kWebSocket:te,NOOP:Ci}=We(),{EventTarget:{addEventListener:Ba,removeEventListener:Ia}}=_i(),{format:Fa,parse:Aa}=vr(),{toBuffer:Ua}=Nt(),Va=30*1e3,Ei=Symbol("kAborted"),wr=[8,13],Ue=["CONNECTING","OPEN","CLOSING","CLOSED"],qa=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,z=class n extends wa{constructor(e,t,r){super(),this._binaryType=xi[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=yn,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=n.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(r=t,t=[]):t=[t]),wi(this,e,t,r)):(this._autoPong=r.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){xi.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let o=new Ta({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation});this._sender=new Ra(e,this._extensions,r.generateMask),this._receiver=o,this._socket=e,o[te]=this,e[te]=this,o.on("conclude",$a),o.on("drain",Wa),o.on("error",Ha),o.on("message",Ga),o.on("ping",Xa),o.on("pong",Ya),e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",ki),e.on("data",Cn),e.on("end",Oi),e.on("error",Pi),this._readyState=n.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=n.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Ge.extensionName]&&this._extensions[Ge.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=n.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING){ue(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===n.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=n.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Va)}}pause(){this.readyState===n.CONNECTING||this.readyState===n.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==n.OPEN){Sr(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||yn,t,r)}pong(e,t,r){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==n.OPEN){Sr(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||yn,t,r)}resume(){this.readyState===n.CONNECTING||this.readyState===n.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(r=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==n.OPEN){Sr(this,e,r);return}let o=ce({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[Ge.extensionName]||(o.compress=!1),this._sender.send(e||yn,o,r)}terminate(){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING){ue(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=n.CLOSING,this._socket.destroy())}}};Object.defineProperty(z,"CONNECTING",{enumerable:!0,value:Ue.indexOf("CONNECTING")});Object.defineProperty(z.prototype,"CONNECTING",{enumerable:!0,value:Ue.indexOf("CONNECTING")});Object.defineProperty(z,"OPEN",{enumerable:!0,value:Ue.indexOf("OPEN")});Object.defineProperty(z.prototype,"OPEN",{enumerable:!0,value:Ue.indexOf("OPEN")});Object.defineProperty(z,"CLOSING",{enumerable:!0,value:Ue.indexOf("CLOSING")});Object.defineProperty(z.prototype,"CLOSING",{enumerable:!0,value:Ue.indexOf("CLOSING")});Object.defineProperty(z,"CLOSED",{enumerable:!0,value:Ue.indexOf("CLOSED")});Object.defineProperty(z.prototype,"CLOSED",{enumerable:!0,value:Ue.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(n=>{Object.defineProperty(z.prototype,n,{enumerable:!0})});["open","error","close","message"].forEach(n=>{Object.defineProperty(z.prototype,`on${n}`,{enumerable:!0,get(){for(let e of this.listeners(n))if(e[Er])return e[Da];return null},set(e){for(let t of this.listeners(n))if(t[Er]){this.removeListener(n,t);break}typeof e=="function"&&this.addEventListener(n,e,{[Er]:!0})}})});z.prototype.addEventListener=Ba;z.prototype.removeEventListener=Ia;Mi.exports=z;function wi(n,e,t,r){let o=Ne(ce({allowSynchronousEvents:!0,autoPong:!0,protocolVersion:wr[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},r),{socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0});if(n._autoPong=o.autoPong,!wr.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${wr.join(", ")})`);let i;if(e instanceof Cr)i=e;else try{i=new Cr(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),n._url=i.href;let s=i.protocol==="wss:",u=i.protocol==="ws+unix:",m;if(i.protocol!=="ws:"&&!s&&!u?m=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:u&&!i.pathname?m="The URL's pathname is empty":i.hash&&(m="The URL contains a fragment identifier"),m){let _=new SyntaxError(m);if(n._redirects===0)throw _;vn(n,_);return}let g=s?443:80,a=Pa(16).toString("base64"),l=s?Sa.request:ka.request,h=new Set,S;if(o.createConnection=o.createConnection||(s?za:ja),o.defaultPort=o.defaultPort||g,o.port=i.port||g,o.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,o.headers=Ne(ce({},o.headers),{"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":a,Connection:"Upgrade",Upgrade:"websocket"}),o.path=i.pathname+i.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(S=new Ge(o.perMessageDeflate!==!0?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=Fa({[Ge.extensionName]:S.offer()})),t.length){for(let _ of t){if(typeof _!="string"||!qa.test(_)||h.has(_))throw new SyntaxError("An invalid or duplicated subprotocol was specified");h.add(_)}o.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(i.username||i.password)&&(o.auth=`${i.username}:${i.password}`),u){let _=o.path.split(":");o.socketPath=_[0],o.path=_[1]}let P;if(o.followRedirects){if(n._redirects===0){n._originalIpc=u,n._originalSecure=s,n._originalHostOrSocketPath=u?o.socketPath:i.host;let _=r&&r.headers;if(r=Ne(ce({},r),{headers:{}}),_)for(let[v,N]of Object.entries(_))r.headers[v.toLowerCase()]=N}else if(n.listenerCount("redirect")===0){let _=u?n._originalIpc?o.socketPath===n._originalHostOrSocketPath:!1:n._originalIpc?!1:i.host===n._originalHostOrSocketPath;(!_||n._originalSecure&&!s)&&(delete o.headers.authorization,delete o.headers.cookie,_||delete o.headers.host,o.auth=void 0)}o.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),P=n._req=l(o),n._redirects&&n.emit("redirect",n.url,P)}else P=n._req=l(o);o.timeout&&P.on("timeout",()=>{ue(n,P,"Opening handshake has timed out")}),P.on("error",_=>{P===null||P[Ei]||(P=n._req=null,vn(n,_))}),P.on("response",_=>{let v=_.headers.location,N=_.statusCode;if(v&&o.followRedirects&&N>=300&&N<400){if(++n._redirects>o.maxRedirects){ue(n,P,"Maximum redirects exceeded");return}P.abort();let I;try{I=new Cr(v,e)}catch{let E=new SyntaxError(`Invalid URL: ${v}`);vn(n,E);return}wi(n,I,t,r)}else n.emit("unexpected-response",P,_)||ue(n,P,`Unexpected server response: ${_.statusCode}`)}),P.on("upgrade",(_,v,N)=>{if(n.emit("upgrade",_),n.readyState!==z.CONNECTING)return;P=n._req=null;let I=_.headers.upgrade;if(I===void 0||I.toLowerCase()!=="websocket"){ue(n,v,"Invalid Upgrade header");return}let b=Ma("sha1").update(a+Na).digest("base64");if(_.headers["sec-websocket-accept"]!==b){ue(n,v,"Invalid Sec-WebSocket-Accept header");return}let E=_.headers["sec-websocket-protocol"],H;if(E!==void 0?h.size?h.has(E)||(H="Server sent an invalid subprotocol"):H="Server sent a subprotocol but none was requested":h.size&&(H="Server sent no subprotocol"),H){ue(n,v,H);return}E&&(n._protocol=E);let U=_.headers["sec-websocket-extensions"];if(U!==void 0){if(!S){ue(n,v,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let Z;try{Z=Aa(U)}catch{ue(n,v,"Invalid Sec-WebSocket-Extensions header");return}let ne=Object.keys(Z);if(ne.length!==1||ne[0]!==Ge.extensionName){ue(n,v,"Server indicated an extension that was not requested");return}try{S.accept(Z[Ge.extensionName])}catch{ue(n,v,"Invalid Sec-WebSocket-Extensions header");return}n._extensions[Ge.extensionName]=S}n.setSocket(v,N,{allowSynchronousEvents:o.allowSynchronousEvents,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})}),o.finishRequest?o.finishRequest(P,n):P.end()}function vn(n,e){n._readyState=z.CLOSING,n.emit("error",e),n.emitClose()}function ja(n){return n.path=n.socketPath,vi.connect(n)}function za(n){return n.path=void 0,!n.servername&&n.servername!==""&&(n.servername=vi.isIP(n.host)?"":n.host),Oa.connect(n)}function ue(n,e,t){n._readyState=z.CLOSING;let r=new Error(t);Error.captureStackTrace(r,ue),e.setHeader?(e[Ei]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(vn,n,r)):(e.destroy(r),e.once("error",n.emit.bind(n,"error")),e.once("close",n.emitClose.bind(n)))}function Sr(n,e,t){if(e){let r=Ua(e).length;n._socket?n._sender._bufferedBytes+=r:n._bufferedAmount+=r}if(t){let r=new Error(`WebSocket is not open: readyState ${n.readyState} (${Ue[n.readyState]})`);process.nextTick(t,r)}}function $a(n,e){let t=this[te];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=n,t._socket[te]!==void 0&&(t._socket.removeListener("data",Cn),process.nextTick(Si,t._socket),n===1005?t.close():t.close(n,e))}function Wa(){let n=this[te];n.isPaused||n._socket.resume()}function Ha(n){let e=this[te];e._socket[te]!==void 0&&(e._socket.removeListener("data",Cn),process.nextTick(Si,e._socket),e.close(n[La])),e.emit("error",n)}function yi(){this[te].emitClose()}function Ga(n,e){this[te].emit("message",n,e)}function Xa(n){let e=this[te];e._autoPong&&e.pong(n,!this._isServer,Ci),e.emit("ping",n)}function Ya(n){this[te].emit("pong",n)}function Si(n){n.resume()}function ki(){let n=this[te];this.removeListener("close",ki),this.removeListener("data",Cn),this.removeListener("end",Oi),n._readyState=z.CLOSING;let e;!this._readableState.endEmitted&&!n._closeFrameReceived&&!n._receiver._writableState.errorEmitted&&(e=n._socket.read())!==null&&n._receiver.write(e),n._receiver.end(),this[te]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted?n.emitClose():(n._receiver.on("error",yi),n._receiver.on("finish",yi))}function Cn(n){this[te]._receiver.write(n)||this.pause()}function Oi(){let n=this[te];n._readyState=z.CLOSING,n._receiver.end(),this.end()}function Pi(){let n=this[te];this.removeListener("error",Pi),this.on("error",Ci),n&&(n._readyState=z.CLOSING,this.destroy())}});var Ri=F((ou,Ti)=>{"use strict";var{tokenChars:Ja}=It();function Ka(n){let e=new Set,t=-1,r=-1,o=0;for(o;o<n.length;o++){let s=n.charCodeAt(o);if(r===-1&&Ja[s]===1)t===-1&&(t=o);else if(o!==0&&(s===32||s===9))r===-1&&t!==-1&&(r=o);else if(s===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${o}`);r===-1&&(r=o);let u=n.slice(t,r);if(e.has(u))throw new SyntaxError(`The "${u}" subprotocol is duplicated`);e.add(u),t=r=-1}else throw new SyntaxError(`Unexpected character at index ${o}`)}if(t===-1||r!==-1)throw new SyntaxError("Unexpected end of input");let i=n.slice(t,o);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}Ti.exports={parse:Ka}});var Ai=F((su,Fi)=>{"use strict";var Za=R("events"),En=R("http"),{Duplex:iu}=R("stream"),{createHash:Qa}=R("crypto"),Ni=vr(),rt=Bt(),el=Ri(),tl=kr(),{GUID:nl,kWebSocket:rl}=We(),ol=/^[+/0-9A-Za-z]{22}==$/,Di=0,Li=1,Ii=2,Or=class extends Za{constructor(e,t){if(super(),e=ce({allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:tl},e),e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=En.createServer((r,o)=>{let i=En.STATUS_CODES[426];o.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),o.end(i)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let r=this.emit.bind(this,"connection");this._removeListeners=il(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(o,i,s)=>{this.handleUpgrade(o,i,s,r)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Di}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===Ii){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Vt,this);return}if(e&&this.once("close",e),this._state!==Li)if(this._state=Li,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Vt,this):process.nextTick(Vt,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{Vt(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,o){t.on("error",Bi);let i=e.headers["sec-websocket-key"],s=e.headers.upgrade,u=+e.headers["sec-websocket-version"];if(e.method!=="GET"){ot(this,e,t,405,"Invalid HTTP method");return}if(s===void 0||s.toLowerCase()!=="websocket"){ot(this,e,t,400,"Invalid Upgrade header");return}if(i===void 0||!ol.test(i)){ot(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(u!==8&&u!==13){ot(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){qt(t,400);return}let m=e.headers["sec-websocket-protocol"],g=new Set;if(m!==void 0)try{g=el.parse(m)}catch{ot(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let a=e.headers["sec-websocket-extensions"],l={};if(this.options.perMessageDeflate&&a!==void 0){let h=new rt(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let S=Ni.parse(a);S[rt.extensionName]&&(h.accept(S[rt.extensionName]),l[rt.extensionName]=h)}catch{ot(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let h={origin:e.headers[`${u===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(h,(S,P,_,v)=>{if(!S)return qt(t,P||401,_,v);this.completeUpgrade(l,i,g,e,t,r,o)});return}if(!this.options.verifyClient(h))return qt(t,401)}this.completeUpgrade(l,i,g,e,t,r,o)}completeUpgrade(e,t,r,o,i,s,u){if(!i.readable||!i.writable)return i.destroy();if(i[rl])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Di)return qt(i,503);let g=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Qa("sha1").update(t+nl).digest("base64")}`],a=new this.options.WebSocket(null,void 0,this.options);if(r.size){let l=this.options.handleProtocols?this.options.handleProtocols(r,o):r.values().next().value;l&&(g.push(`Sec-WebSocket-Protocol: ${l}`),a._protocol=l)}if(e[rt.extensionName]){let l=e[rt.extensionName].params,h=Ni.format({[rt.extensionName]:[l]});g.push(`Sec-WebSocket-Extensions: ${h}`),a._extensions=e}this.emit("headers",g,o),i.write(g.concat(`\r
`).join(`\r
`)),i.removeListener("error",Bi),a.setSocket(i,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(a),a.on("close",()=>{this.clients.delete(a),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Vt,this)})),u(a,o)}};Fi.exports=Or;function il(n,e){for(let t of Object.keys(e))n.on(t,e[t]);return function(){for(let r of Object.keys(e))n.removeListener(r,e[r])}}function Vt(n){n._state=Ii,n.emit("close")}function Bi(){this.destroy()}function qt(n,e,t,r){t=t||En.STATUS_CODES[e],r=ce({Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t)},r),n.once("finish",n.destroy),n.end(`HTTP/1.1 ${e} ${En.STATUS_CODES[e]}\r
`+Object.keys(r).map(o=>`${o}: ${r[o]}`).join(`\r
`)+`\r
\r
`+t)}function ot(n,e,t,r,o){if(n.listenerCount("wsClientError")){let i=new Error(o);Error.captureStackTrace(i,ot),n.emit("wsClientError",i,t,e)}else qt(t,r,o)}});var Rr=F((Ju,ji)=>{"use strict";function yl(n){t.debug=t,t.default=t,t.coerce=m,t.disable=i,t.enable=o,t.enabled=s,t.humanize=rn(),t.destroy=g,Object.keys(n).forEach(a=>{t[a]=n[a]}),t.names=[],t.skips=[],t.formatters={};function e(a){let l=0;for(let h=0;h<a.length;h++)l=(l<<5)-l+a.charCodeAt(h),l|=0;return t.colors[Math.abs(l)%t.colors.length]}t.selectColor=e;function t(a){let l,h=null,S,P;function _(...v){if(!_.enabled)return;let N=_,I=Number(new Date),b=I-(l||I);N.diff=b,N.prev=l,N.curr=I,l=I,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let E=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(U,Z)=>{if(U==="%%")return"%";E++;let ne=t.formatters[Z];if(typeof ne=="function"){let ye=v[E];U=ne.call(N,ye),v.splice(E,1),E--}return U}),t.formatArgs.call(N,v),(N.log||t.log).apply(N,v)}return _.namespace=a,_.useColors=t.useColors(),_.color=t.selectColor(a),_.extend=r,_.destroy=t.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(S!==t.namespaces&&(S=t.namespaces,P=t.enabled(a)),P),set:v=>{h=v}}),typeof t.init=="function"&&t.init(_),_}function r(a,l){let h=t(this.namespace+(typeof l>"u"?":":l)+a);return h.log=this.log,h}function o(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];let l,h=(typeof a=="string"?a:"").split(/[\s,]+/),S=h.length;for(l=0;l<S;l++)h[l]&&(a=h[l].replace(/\*/g,".*?"),a[0]==="-"?t.skips.push(new RegExp("^"+a.slice(1)+"$")):t.names.push(new RegExp("^"+a+"$")))}function i(){let a=[...t.names.map(u),...t.skips.map(u).map(l=>"-"+l)].join(",");return t.enable(""),a}function s(a){if(a[a.length-1]==="*")return!0;let l,h;for(l=0,h=t.skips.length;l<h;l++)if(t.skips[l].test(a))return!1;for(l=0,h=t.names.length;l<h;l++)if(t.names[l].test(a))return!0;return!1}function u(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function m(a){return a instanceof Error?a.stack||a.message:a}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}ji.exports=yl});var zi=F((pe,On)=>{"use strict";pe.formatArgs=Cl;pe.save=El;pe.load=wl;pe.useColors=vl;pe.storage=Sl();pe.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();pe.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function vl(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let n;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(n=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(n[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Cl(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+On.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(t++,o==="%c"&&(r=t))}),n.splice(r,0,e)}pe.log=console.debug||console.log||(()=>{});function El(n){try{n?pe.storage.setItem("debug",n):pe.storage.removeItem("debug")}catch{}}function wl(){let n;try{n=pe.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function Sl(){try{return localStorage}catch{}}On.exports=Rr()(pe);var{formatters:kl}=On.exports;kl.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Wi=F((J,Mn)=>{"use strict";var Ol=R("tty"),Pn=R("util");J.init=Ll;J.log=Rl;J.formatArgs=Ml;J.save=Nl;J.load=Dl;J.useColors=Pl;J.destroy=Pn.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");J.colors=[6,2,3,4,5,1];try{let n=sn();n&&(n.stderr||n).level>=2&&(J.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}J.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(o,i)=>i.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function Pl(){return"colors"in J.inspectOpts?!!J.inspectOpts.colors:Ol.isatty(process.stderr.fd)}function Ml(n){let{namespace:e,useColors:t}=this;if(t){let r=this.color,o="\x1B[3"+(r<8?r:"8;5;"+r),i=`  ${o};1m${e} \x1B[0m`;n[0]=i+n[0].split(`
`).join(`
`+i),n.push(o+"m+"+Mn.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=Tl()+e+" "+n[0]}function Tl(){return J.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Rl(...n){return process.stderr.write(Pn.formatWithOptions(J.inspectOpts,...n)+`
`)}function Nl(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function Dl(){return process.env.DEBUG}function Ll(n){n.inspectOpts={};let e=Object.keys(J.inspectOpts);for(let t=0;t<e.length;t++)n.inspectOpts[e[t]]=J.inspectOpts[e[t]]}Mn.exports=Rr()(J);var{formatters:$i}=Mn.exports;$i.o=function(n){return this.inspectOpts.colors=this.useColors,Pn.inspect(n,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};$i.O=function(n){return this.inspectOpts.colors=this.useColors,Pn.inspect(n,this.inspectOpts)}});var $t=F((Ku,Nr)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Nr.exports=zi():Nr.exports=Wi()});var Br=F((rp,Zi)=>{"use strict";function Ul(n){t.debug=t,t.default=t,t.coerce=m,t.disable=i,t.enable=o,t.enabled=s,t.humanize=rn(),t.destroy=g,Object.keys(n).forEach(a=>{t[a]=n[a]}),t.names=[],t.skips=[],t.formatters={};function e(a){let l=0;for(let h=0;h<a.length;h++)l=(l<<5)-l+a.charCodeAt(h),l|=0;return t.colors[Math.abs(l)%t.colors.length]}t.selectColor=e;function t(a){let l,h=null,S,P;function _(...v){if(!_.enabled)return;let N=_,I=Number(new Date),b=I-(l||I);N.diff=b,N.prev=l,N.curr=I,l=I,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let E=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(U,Z)=>{if(U==="%%")return"%";E++;let ne=t.formatters[Z];if(typeof ne=="function"){let ye=v[E];U=ne.call(N,ye),v.splice(E,1),E--}return U}),t.formatArgs.call(N,v),(N.log||t.log).apply(N,v)}return _.namespace=a,_.useColors=t.useColors(),_.color=t.selectColor(a),_.extend=r,_.destroy=t.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(S!==t.namespaces&&(S=t.namespaces,P=t.enabled(a)),P),set:v=>{h=v}}),typeof t.init=="function"&&t.init(_),_}function r(a,l){let h=t(this.namespace+(typeof l>"u"?":":l)+a);return h.log=this.log,h}function o(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];let l,h=(typeof a=="string"?a:"").split(/[\s,]+/),S=h.length;for(l=0;l<S;l++)h[l]&&(a=h[l].replace(/\*/g,".*?"),a[0]==="-"?t.skips.push(new RegExp("^"+a.slice(1)+"$")):t.names.push(new RegExp("^"+a+"$")))}function i(){let a=[...t.names.map(u),...t.skips.map(u).map(l=>"-"+l)].join(",");return t.enable(""),a}function s(a){if(a[a.length-1]==="*")return!0;let l,h;for(l=0,h=t.skips.length;l<h;l++)if(t.skips[l].test(a))return!1;for(l=0,h=t.names.length;l<h;l++)if(t.names[l].test(a))return!0;return!1}function u(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function m(a){return a instanceof Error?a.stack||a.message:a}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Zi.exports=Ul});var Qi=F((fe,Tn)=>{"use strict";fe.formatArgs=ql;fe.save=jl;fe.load=zl;fe.useColors=Vl;fe.storage=$l();fe.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();fe.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Vl(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let n;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(n=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(n[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function ql(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+Tn.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(t++,o==="%c"&&(r=t))}),n.splice(r,0,e)}fe.log=console.debug||console.log||(()=>{});function jl(n){try{n?fe.storage.setItem("debug",n):fe.storage.removeItem("debug")}catch{}}function zl(){let n;try{n=fe.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function $l(){try{return localStorage}catch{}}Tn.exports=Br()(fe);var{formatters:Wl}=Tn.exports;Wl.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var ts=F((K,Nn)=>{"use strict";var Hl=R("tty"),Rn=R("util");K.init=Ql;K.log=Jl;K.formatArgs=Xl;K.save=Kl;K.load=Zl;K.useColors=Gl;K.destroy=Rn.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");K.colors=[6,2,3,4,5,1];try{let n=sn();n&&(n.stderr||n).level>=2&&(K.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}K.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(o,i)=>i.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function Gl(){return"colors"in K.inspectOpts?!!K.inspectOpts.colors:Hl.isatty(process.stderr.fd)}function Xl(n){let{namespace:e,useColors:t}=this;if(t){let r=this.color,o="\x1B[3"+(r<8?r:"8;5;"+r),i=`  ${o};1m${e} \x1B[0m`;n[0]=i+n[0].split(`
`).join(`
`+i),n.push(o+"m+"+Nn.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=Yl()+e+" "+n[0]}function Yl(){return K.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Jl(...n){return process.stderr.write(Rn.formatWithOptions(K.inspectOpts,...n)+`
`)}function Kl(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function Zl(){return process.env.DEBUG}function Ql(n){n.inspectOpts={};let e=Object.keys(K.inspectOpts);for(let t=0;t<e.length;t++)n.inspectOpts[e[t]]=K.inspectOpts[e[t]]}Nn.exports=Br()(K);var{formatters:es}=Nn.exports;es.o=function(n){return this.inspectOpts.colors=this.useColors,Rn.inspect(n,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};es.O=function(n){return this.inspectOpts.colors=this.useColors,Rn.inspect(n,this.inspectOpts)}});var ns=F((op,Ir)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Ir.exports=Qi():Ir.exports=ts()});var sr=Q(lo(),1);var ke=Object.create(null);ke.open="0";ke.close="1";ke.ping="2";ke.pong="3";ke.message="4";ke.upgrade="5";ke.noop="6";var kt=Object.create(null);Object.keys(ke).forEach(n=>{kt[ke[n]]=n});var Ot={type:"error",data:"parser error"};var Pt=({type:n,data:e},t,r)=>e instanceof ArrayBuffer||ArrayBuffer.isView(e)?r(t?e:"b"+co(e,!0).toString("base64")):r(ke[n]+(e||"")),co=(n,e)=>Buffer.isBuffer(n)||n instanceof Uint8Array&&!e?n:n instanceof ArrayBuffer?Buffer.from(n):Buffer.from(n.buffer,n.byteOffset,n.byteLength),Kn;function uo(n,e){if(n.data instanceof ArrayBuffer||ArrayBuffer.isView(n.data))return e(co(n.data,!1));Pt(n,!0,t=>{Kn||(Kn=new TextEncoder),e(Kn.encode(t))})}var Mt=(n,e)=>{if(typeof n!="string")return{type:"message",data:po(n,e)};let t=n.charAt(0);if(t==="b"){let r=Buffer.from(n.substring(1),"base64");return{type:"message",data:po(r,e)}}return kt[t]?n.length>1?{type:kt[t],data:n.substring(1)}:{type:kt[t]}:Ot},po=(n,e)=>{switch(e){case"arraybuffer":return n instanceof ArrayBuffer?n:Buffer.isBuffer(n)?n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength):n.buffer;case"nodebuffer":default:return Buffer.isBuffer(n)?n:Buffer.from(n)}};var fo="",ho=(n,e)=>{let t=n.length,r=new Array(t),o=0;n.forEach((i,s)=>{Pt(i,!1,u=>{r[s]=u,++o===t&&e(r.join(fo))})})},mo=(n,e)=>{let t=n.split(fo),r=[];for(let o=0;o<t.length;o++){let i=Mt(t[o],e);if(r.push(i),i.type==="error")break}return r};function go(){return new TransformStream({transform(n,e){uo(n,t=>{let r=t.length,o;if(r<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,r);else if(r<65536){o=new Uint8Array(3);let i=new DataView(o.buffer);i.setUint8(0,126),i.setUint16(1,r)}else{o=new Uint8Array(9);let i=new DataView(o.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(r))}n.data&&typeof n.data!="string"&&(o[0]|=128),e.enqueue(o),e.enqueue(t)})}})}var Zn;function Zt(n){return n.reduce((e,t)=>e+t.length,0)}function Qt(n,e){if(n[0].length===e)return n.shift();let t=new Uint8Array(e),r=0;for(let o=0;o<e;o++)t[o]=n[0][r++],r===n[0].length&&(n.shift(),r=0);return n.length&&r<n[0].length&&(n[0]=n[0].slice(r)),t}function _o(n,e){Zn||(Zn=new TextDecoder);let t=[],r=0,o=-1,i=!1;return new TransformStream({transform(s,u){for(t.push(s);;){if(r===0){if(Zt(t)<1)break;let m=Qt(t,1);i=(m[0]&128)===128,o=m[0]&127,o<126?r=3:o===126?r=1:r=2}else if(r===1){if(Zt(t)<2)break;let m=Qt(t,2);o=new DataView(m.buffer,m.byteOffset,m.length).getUint16(0),r=3}else if(r===2){if(Zt(t)<8)break;let m=Qt(t,8),g=new DataView(m.buffer,m.byteOffset,m.length),a=g.getUint32(0);if(a>Math.pow(2,21)-1){u.enqueue(Ot);break}o=a*Math.pow(2,32)+g.getUint32(4),r=3}else{if(Zt(t)<o)break;let m=Qt(t,o);u.enqueue(Mt(i?m:Zn.decode(m),e)),r=0}if(o===0||o>n){u.enqueue(Ot);break}}}})}var Qn=4;function q(n){if(n)return xs(n)}function xs(n){for(var e in q.prototype)n[e]=q.prototype[e];return n}q.prototype.on=q.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};q.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};q.prototype.off=q.prototype.removeListener=q.prototype.removeAllListeners=q.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,o=0;o<t.length;o++)if(r=t[o],r===e||r.fn===e){t.splice(o,1);break}return t.length===0&&delete this._callbacks["$"+n],this};q.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,o=t.length;r<o;++r)t[r].apply(this,e)}return this};q.prototype.emitReserved=q.prototype.emit;q.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};q.prototype.hasListeners=function(n){return!!this.listeners(n).length};var Le=process.nextTick,se=global,bo="nodebuffer";function xo(){return new er}function ys(n){let e=n.split("; "),t=e[0].indexOf("=");if(t===-1)return;let r=e[0].substring(0,t).trim();if(!r.length)return;let o=e[0].substring(t+1).trim();o.charCodeAt(0)===34&&(o=o.slice(1,-1));let i={name:r,value:o};for(let s=1;s<e.length;s++){let u=e[s].split("=");if(u.length!==2)continue;let m=u[0].trim(),g=u[1].trim();switch(m){case"Expires":i.expires=new Date(g);break;case"Max-Age":let a=new Date;a.setUTCSeconds(a.getUTCSeconds()+parseInt(g,10)),i.expires=a;break;default:}}return i}var er=class{constructor(){this._cookies=new Map}parseCookies(e){e&&e.forEach(t=>{let r=ys(t);r&&this._cookies.set(r.name,r)})}get cookies(){let e=Date.now();return this._cookies.forEach((t,r)=>{var o;((o=t.expires)===null||o===void 0?void 0:o.getTime())<e&&this._cookies.delete(r)}),this._cookies.entries()}addCookies(e){let t=[];for(let[r,o]of this.cookies)t.push(`${r}=${o.value}`);t.length&&(e.setDisableHeaderCheck(!0),e.setRequestHeader("cookie",t.join("; ")))}appendCookies(e){for(let[t,r]of this.cookies)e.append("cookie",`${t}=${r.value}`)}};function en(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}var vs=se.setTimeout,Cs=se.clearTimeout;function Be(n,e){e.useNativeTimers?(n.setTimeoutFn=vs.bind(se),n.clearTimeoutFn=Cs.bind(se)):(n.setTimeoutFn=se.setTimeout.bind(se),n.clearTimeoutFn=se.clearTimeout.bind(se))}var Es=1.33;function yo(n){return typeof n=="string"?ws(n):Math.ceil((n.byteLength||n.size)*Es)}function ws(n){let e=0,t=0;for(let r=0,o=n.length;r<o;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function tn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function vo(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function Co(n){let e={},t=n.split("&");for(let r=0,o=t.length;r<o;r++){let i=t[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}var No=Q(et(),1),Gs=(0,No.default)("engine.io-client:transport"),cn=class extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}},Ie=class extends q{constructor(e){super(),this.writable=!1,Be(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new cn(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"?this.write(e):Gs("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=Mt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){let t=vo(e);return t.length?"?"+t:""}};var Do=Q(et(),1),Oe=(0,Do.default)("engine.io-client:polling"),Tt=class extends Ie{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";let t=()=>{Oe("paused"),this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(Oe("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){Oe("pre-pause polling complete"),--r||t()})),this.writable||(Oe("we are currently writing - waiting to pause"),r++,this.once("drain",function(){Oe("pre-pause writing complete"),--r||t()}))}else t()}_poll(){Oe("polling"),this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){Oe("polling got data %s",e);let t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};mo(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"?this._poll():Oe('ignoring poll - transport state "%s"',this.readyState))}doClose(){let e=()=>{Oe("writing close packet"),this.write([{type:"close"}])};this.readyState==="open"?(Oe("transport open - closing"),e()):(Oe("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,ho(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=tn()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}};var Lo=!1;try{Lo=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var Bo=Lo;var Fo=Q(et(),1),ir=(0,Fo.default)("engine.io-client:polling");function Xs(){}var dn=class extends Tt{constructor(e){if(super(e),typeof location<"u"){let t=location.protocol==="https:",r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){let r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(o,i)=>{this.onError("xhr post error",o,i)})}doPoll(){ir("xhr poll");let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}},Rt=(()=>{class n extends q{constructor(t,r,o){super(),this.createRequest=t,Be(this,o),this._opts=o,this._method=o.method||"GET",this._uri=r,this._data=o.data!==void 0?o.data:null,this._create()}_create(){var t;let r=en(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;let o=this._xhr=this.createRequest(r);try{ir("xhr open %s: %s",this._method,this._uri),o.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){o.setDisableHeaderCheck&&o.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&o.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{o.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{o.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(o),"withCredentials"in o&&(o.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(o.timeout=this._opts.requestTimeout),o.onreadystatechange=()=>{var i;o.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(o.getResponseHeader("set-cookie"))),o.readyState===4&&(o.status===200||o.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof o.status=="number"?o.status:0)},0))},ir("xhr data %s",this._data),o.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=n.requestsCount++,n.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Xs,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete n.requests[this._index],this._xhr=null}}_onLoad(){let t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}return n.requestsCount=0,n.requests={},n})();if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Io);else if(typeof addEventListener=="function"){let n="onpagehide"in se?"pagehide":"unload";addEventListener(n,Io,!1)}}function Io(){for(let n in Rt.requests)Rt.requests.hasOwnProperty(n)&&Rt.requests[n].abort()}var Fd=(function(){let n=Ys({xdomain:!1});return n&&n.responseType!==null})();function Ys(n){let e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Bo))return new XMLHttpRequest}catch{}if(!e)try{return new se[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}var Js=sr.default||sr,pt=class extends dn{request(e={}){var t;return Object.assign(e,{xd:this.xd,cookieJar:(t=this.socket)===null||t===void 0?void 0:t._cookieJar},this.opts),new Rt(r=>new Js(r),this.uri(),e)}};var sl=Q(qo(),1),al=Q(_r(),1),ll=Q(xr(),1),Pr=Q(kr(),1),cl=Q(Ai(),1);var Ui=Q(et(),1),ul=(0,Ui.default)("engine.io-client:websocket"),pl=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",wn=class extends Ie{get name(){return"websocket"}doOpen(){let e=this.uri(),t=this.opts.protocols,r=pl?{}:en(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],o=t===e.length-1;Pt(r,this.supportsBinary,i=>{try{this.doWrite(r,i)}catch{ul("websocket closed before onclose event")}o&&Le(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=tn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},pu=se.WebSocket||se.MozWebSocket;var _t=class extends wn{createSocket(e,t,r){var o;if(!((o=this.socket)===null||o===void 0)&&o._cookieJar){r.headers=r.headers||{},r.headers.cookie=typeof r.headers.cookie=="string"?[r.headers.cookie]:r.headers.cookie||[];for(let[i,s]of this.socket._cookieJar.cookies)r.headers.cookie.push(`${i}=${s.value}`)}return new Pr.default(e,t,r)}doWrite(e,t){let r={};e.options&&(r.compress=e.options.compress),this.opts.perMessageDeflate&&(typeof t=="string"?Buffer.byteLength(t):t.length)<this.opts.perMessageDeflate.threshold&&(r.compress=!1),this.ws.send(t,r)}};var Vi=Q(et(),1),jt=(0,Vi.default)("engine.io-client:webtransport"),bt=class extends Ie{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{jt("transport closed gracefully"),this.onClose()}).catch(e=>{jt("transport closed due to %s",e),this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{let t=_o(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),o=go();o.readable.pipeTo(e.writable),this._writer=o.writable.getWriter();let i=()=>{r.read().then(({done:u,value:m})=>{if(u){jt("session is closed");return}jt("received chunk: %o",m),this.onPacket(m),i()}).catch(u=>{jt("an error occurred while reading: %s",u)})};i();let s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this._writer.write(s).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],o=t===e.length-1;this._writer.write(r).then(()=>{o&&Le(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}};var Mr={websocket:_t,webtransport:bt,polling:pt};var fl=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,hl=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function xt(n){if(n.length>8e3)throw"URI too long";let e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let o=fl.exec(n||""),i={},s=14;for(;s--;)i[hl[s]]=o[s]||"";return t!=-1&&r!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=ml(i,i.path),i.queryKey=gl(i,i.query),i}function ml(n,e){let t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function gl(n,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,o,i){o&&(t[o]=i)}),t}var qi=Q(et(),1),A=(0,qi.default)("engine.io-client:socket"),Tr=typeof addEventListener=="function"&&typeof removeEventListener=="function",zt=[];Tr&&addEventListener("offline",()=>{A("closing %d connection(s) because the network was lost",zt.length),zt.forEach(n=>n())},!1);var Sn=(()=>{class n extends q{constructor(t,r){if(super(),this.binaryType=bo,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(r=t,t=null),t){let o=xt(t);r.hostname=o.host,r.secure=o.protocol==="https"||o.protocol==="wss",r.port=o.port,o.query&&(r.query=o.query)}else r.host&&(r.hostname=xt(r.host).host);Be(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},r.transports.forEach(o=>{let i=o.prototype.name;this.transports.push(i),this._transportsByName[i]=o}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Co(this.opts.query)),Tr&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(A("adding listener for the 'offline' event"),this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},zt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=xo()),this._open()}createTransport(t){A('creating transport "%s"',t);let r=Object.assign({},this.opts.query);r.EIO=Qn,r.transport=t,this.id&&(r.sid=this.id);let o=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return A("options: %j",o),new this._transportsByName[t](o)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}let t=this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";let r=this.createTransport(t);r.open(),this.setTransport(r)}setTransport(t){A("setting transport %s",t.name),this.transport&&(A("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",r=>this._onClose("transport close",r))}onOpen(){A("socket open"),this.readyState="open",n.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(A('socket receive: type "%s", data "%s"',t.type,t.data),this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let r=new Error("server error");r.code=t.data,this._onError(r);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}else A('packet received with socket readyState "%s"',this.readyState)}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let t=this._getWritablePackets();A("flushing %d packets in socket",t.length),this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let o=0;o<this.writeBuffer.length;o++){let i=this.writeBuffer[o].data;if(i&&(r+=yo(i)),o>0&&r>this._maxPayload)return A("only send %d out of %d packets",o,this.writeBuffer.length),this.writeBuffer.slice(0,o);r+=2}return A("payload size is %d (max: %d)",r,this._maxPayload),this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let t=Date.now()>this._pingTimeoutTime;return t&&(A("throttled timer detected, scheduling connection close"),this._pingTimeoutTime=0,Le(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,r,o){return this._sendPacket("message",t,r,o),this}send(t,r,o){return this._sendPacket("message",t,r,o),this}_sendPacket(t,r,o,i){if(typeof r=="function"&&(i=r,r=void 0),typeof o=="function"&&(i=o,o=null),this.readyState==="closing"||this.readyState==="closed")return;o=o||{},o.compress=o.compress!==!1;let s={type:t,data:r,options:o};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){let t=()=>{this._onClose("forced close"),A("socket closing - telling transport to close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),t()},o=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?o():t()}):this.upgrading?o():t()),this}_onError(t){if(A("socket error %j",t),n.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return A("trying next transport"),this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(A('socket close with reason: "%s"',t),this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Tr&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){let o=zt.indexOf(this._offlineEventListener);o!==-1&&(A("removing listener for the 'offline' event"),zt.splice(o,1))}this.readyState="closed",this.id=null,this.emitReserved("close",t,r),this.writeBuffer=[],this._prevBufferLen=0}}}return n.protocol=Qn,n})(),kn=class extends Sn{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade){A("starting upgrade probes");for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}}_probe(e){A('probing transport "%s"',e);let t=this.createTransport(e),r=!1;Sn.priorWebsocketSuccess=!1;let o=()=>{r||(A('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",l=>{if(!r)if(l.type==="pong"&&l.data==="probe"){if(A('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Sn.priorWebsocketSuccess=t.name==="websocket",A('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{r||this.readyState!=="closed"&&(A("changing transport and sending upgrade packet"),a(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{A('probe transport "%s" failed',e);let h=new Error("probe error");h.transport=t.name,this.emitReserved("upgradeError",h)}}))};function i(){r||(r=!0,a(),t.close(),t=null)}let s=l=>{let h=new Error("probe error: "+l);h.transport=t.name,i(),A('probe transport "%s" failed because of error: %s',e,l),this.emitReserved("upgradeError",h)};function u(){s("transport closed")}function m(){s("socket closed")}function g(l){t&&l.name!==t.name&&(A('"%s" works - aborting "%s"',l.name,t.name),i())}let a=()=>{t.removeListener("open",o),t.removeListener("error",s),t.removeListener("close",u),this.off("close",m),this.off("upgrading",g)};t.once("open",o),t.once("error",s),t.once("close",u),this.once("close",m),this.once("upgrading",g),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){let t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}},yt=class extends kn{constructor(e,t={}){let r=typeof e=="object"?e:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(o=>Mr[o]).filter(o=>!!o)),super(e,r)}};var Iu=yt.protocol;var Gi=Q($t(),1),Hi=(0,Gi.default)("socket.io-client:url");function Xi(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(Hi("protocol-less url %s",n),typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),Hi("parse %s",n),r=xt(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";let i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}var qr={};_s(qr,{Decoder:()=>Ur,Encoder:()=>Ar,PacketType:()=>T,protocol:()=>is});var Bl=typeof ArrayBuffer=="function",Il=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Yi=Object.prototype.toString,Fl=typeof Blob=="function"||typeof Blob<"u"&&Yi.call(Blob)==="[object BlobConstructor]",Al=typeof File=="function"||typeof File<"u"&&Yi.call(File)==="[object FileConstructor]";function Ht(n){return Bl&&(n instanceof ArrayBuffer||Il(n))||Fl&&n instanceof Blob||Al&&n instanceof File}function Wt(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Wt(n[t]))return!0;return!1}if(Ht(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Wt(n.toJSON(),!0);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&Wt(n[t]))return!0;return!1}function Ji(n){let e=[],t=n.data,r=n;return r.data=Dr(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Dr(n,e){if(!n)return n;if(Ht(n)){let t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){let t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=Dr(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){let t={};for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=Dr(n[r],e));return t}return n}function Ki(n,e){return n.data=Lr(n.data,e),delete n.attachments,n}function Lr(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=Lr(n[t],e);else if(typeof n=="object")for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=Lr(n[t],e));return n}var os=Q(ns(),1),Fr=(0,os.default)("socket.io-parser"),ec=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],is=5,T=(function(n){return n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK",n})(T||{}),Ar=class{constructor(e){this.replacer=e}encode(e){return Fr("encoding packet %j",e),(e.type===T.EVENT||e.type===T.ACK)&&Wt(e)?this.encodeAsBinary({type:e.type===T.EVENT?T.BINARY_EVENT:T.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===T.BINARY_EVENT||e.type===T.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),Fr("encoded %j as %s",e,t),t}encodeAsBinary(e){let t=Ji(e),r=this.encodeAsString(t.packet),o=t.buffers;return o.unshift(r),o}};function rs(n){return Object.prototype.toString.call(n)==="[object Object]"}var Ur=class n extends q{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let r=t.type===T.BINARY_EVENT;r||t.type===T.BINARY_ACK?(t.type=r?T.EVENT:T.ACK,this.reconstructor=new Vr(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Ht(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,r={type:Number(e.charAt(0))};if(T[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===T.BINARY_EVENT||r.type===T.BINARY_ACK){let i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let s=e.substring(i,t);if(s!=Number(s)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(t+1)==="/"){let i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(i,t)}else r.nsp="/";let o=e.charAt(t+1);if(o!==""&&Number(o)==o){let i=t+1;for(;++t;){let s=e.charAt(t);if(s==null||Number(s)!=s){--t;break}if(t===e.length)break}r.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){let i=this.tryParse(e.substr(t));if(n.isPayloadValid(r.type,i))r.data=i;else throw new Error("invalid payload")}return Fr("decoded %s as %j",e,r),r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case T.CONNECT:return rs(t);case T.DISCONNECT:return t===void 0;case T.CONNECT_ERROR:return typeof t=="string"||rs(t);case T.EVENT:case T.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&ec.indexOf(t[0])===-1);case T.ACK:case T.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},Vr=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=Ki(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function he(n,e,t){return n.on(e,t),function(){n.off(e,t)}}var ss=Q($t(),1),W=(0,ss.default)("socket.io-client:socket"),tc=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),vt=class extends q{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[he(e,"open",this.onopen.bind(this)),he(e,"packet",this.onpacket.bind(this)),he(e,"error",this.onerror.bind(this)),he(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,o,i;if(tc.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let s={type:T.EVENT,data:t};if(s.options={},s.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let a=this.ids++;W("emitting packet with ack id %d",a);let l=t.pop();this._registerAckCallback(a,l),s.id=a}let u=(o=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||o===void 0?void 0:o.writable,m=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!u?W("discard packet as the transport is not currently writable"):m?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s),this.flags={},this}_registerAckCallback(e,t){var r;let o=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(o===void 0){this.acks[e]=t;return}let i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let u=0;u<this.sendBuffer.length;u++)this.sendBuffer[u].id===e&&(W("removing packet with ack id %d from the buffer",e),this.sendBuffer.splice(u,1));W("event with ack id %d has timed out after %d ms",e,o),t.call(this,new Error("operation has timed out"))},o),s=(...u)=>{this.io.clearTimeoutFn(i),t.apply(this,u)};s.withError=!0,this.acks[e]=s}emitWithAck(e,...t){return new Promise((r,o)=>{let i=(s,u)=>s?o(s):r(u);i.withError=!0,t.push(i),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((o,...i)=>r!==this._queue[0]?void 0:(o!==null?r.tryCount>this._opts.retries&&(W("packet [%d] is discarded after %d tries",r.id,r.tryCount),this._queue.shift(),t&&t(o)):(W("packet [%d] was successfully sent",r.id),this._queue.shift(),t&&t(null,...i)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(W("draining queue"),!this.connected||this._queue.length===0)return;let t=this._queue[0];if(t.pending&&!e){W("packet [%d] has already been sent and is waiting for an ack",t.id);return}t.pending=!0,t.tryCount++,W("sending packet [%d] (try n\xB0%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){W("transport is open - connecting"),typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:T.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){W("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){let r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case T.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case T.EVENT:case T.BINARY_EVENT:this.onevent(e);break;case T.ACK:case T.BINARY_ACK:this.onack(e);break;case T.DISCONNECT:this.ondisconnect();break;case T.CONNECT_ERROR:this.destroy();let r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){let t=e.data||[];W("emitting event %j",t),e.id!=null&&(W("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,r=!1;return function(...o){r||(r=!0,W("sending ack %j",o),t.packet({type:T.ACK,id:e,data:o}))}}onack(e){let t=this.acks[e.id];if(typeof t!="function"){W("bad ack %s",e.id);return}delete this.acks[e.id],W("calling ack %s with %j",e.id,e.data),t.withError&&e.data.unshift(null),t.apply(this,e.data)}onconnect(e,t){W("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){W("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(W("performing disconnect (%s)",this.nsp),this.packet({type:T.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let r of t)r.apply(this,e.data)}}};function it(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}it.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};it.prototype.reset=function(){this.attempts=0};it.prototype.setMin=function(n){this.ms=n};it.prototype.setMax=function(n){this.max=n};it.prototype.setJitter=function(n){this.jitter=n};var as=Q($t(),1),ee=(0,as.default)("socket.io-client:manager"),Ct=class extends q{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Be(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new it({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let o=t.parser||qr;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(ee("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;ee("opening %s",this.uri),this.engine=new yt(this.uri,this.opts);let t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;let o=he(t,"open",function(){r.onopen(),e&&e()}),i=u=>{ee("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",u),e?e(u):this.maybeReconnectOnOpen()},s=he(t,"error",i);if(this._timeout!==!1){let u=this._timeout;ee("connect attempt will timeout after %d",u);let m=this.setTimeoutFn(()=>{ee("connect attempt timed out after %d",u),o(),i(new Error("timeout")),t.close()},u);this.opts.autoUnref&&m.unref(),this.subs.push(()=>{this.clearTimeoutFn(m)})}return this.subs.push(o),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){ee("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(he(e,"ping",this.onping.bind(this)),he(e,"data",this.ondata.bind(this)),he(e,"error",this.onerror.bind(this)),he(e,"close",this.onclose.bind(this)),he(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Le(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){ee("error",e),this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new vt(this,e,t),this.nsps[e]=r),r}_destroy(e){let t=Object.keys(this.nsps);for(let r of t)if(this.nsps[r].active){ee("socket %s is still active, skipping close",r);return}this._close()}_packet(e){ee("writing packet %j",e);let t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){ee("cleanup"),this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){ee("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;ee("closed due to %s",e),this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)ee("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();ee("will wait %dms before reconnect attempt",t),this._reconnecting=!0;let r=this.setTimeoutFn(()=>{e.skipReconnect||(ee("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(o=>{o?(ee("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",o)):(ee("reconnect success"),e.onreconnect())}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var cs=Q($t(),1),ls=(0,cs.default)("socket.io-client"),Gt={};function Xt(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};let t=Xi(n,e.path||"/socket.io"),r=t.source,o=t.id,i=t.path,s=Gt[o]&&i in Gt[o].nsps,u=e.forceNew||e["force new connection"]||e.multiplex===!1||s,m;return u?(ls("ignoring socket cache for %s",r),m=new Ct(r,e)):(Gt[o]||(ls("new io instance for %s",r),Gt[o]=new Ct(r,e)),m=Gt[o]),t.query&&!e.query&&(e.query=t.queryKey),m.socket(t.path,e)}Object.assign(Xt,{Manager:Ct,Socket:vt,io:Xt,connect:Xt});var Et=class n{socket=null;connected=w(!1);proposalCreated=w(null);proposalAccepted=w(null);proposalRejected=w(null);proposalExpired=w(null);connect(e){if(this.socket?.connected){console.log("\u{1F50C} D\xE9j\xE0 connect\xE9 au WebSocket");return}let t=Se.apiUrl,r=new URL(t),o=r.protocol==="https:"?"wss:":"ws:",i=r.host;t=`${o}//${i}`,console.log("\u{1F50C} [USER] Connexion au WebSocket:",t),console.log("\u{1F50C} [USER] API URL source:",Se.apiUrl),this.socket=Xt(t,{auth:{token:e},transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:5}),this.setupEventListeners()}disconnect(){this.socket&&(console.log("\u{1F50C} [USER] D\xE9connexion du WebSocket"),this.socket.disconnect(),this.socket=null,this.connected.set(!1))}joinProposal(e){this.socket?.connected&&(console.log("\u{1F4E6} [USER] Rejoindre la proposition:",e),this.socket.emit("join:proposal",e))}leaveProposal(e){this.socket?.connected&&(console.log("\u{1F4E4} [USER] Quitter la proposition:",e),this.socket.emit("leave:proposal",e))}setupEventListeners(){this.socket&&(this.socket.on("connect",()=>{console.log("\u2705 [USER] Connect\xE9 au WebSocket"),this.connected.set(!0)}),this.socket.on("disconnect",()=>{console.log("\u274C [USER] D\xE9connect\xE9 du WebSocket"),this.connected.set(!1)}),this.socket.on("connect_error",e=>{console.error("\u274C [USER] Erreur de connexion WebSocket:",e),this.connected.set(!1)}),this.socket.on("proposal:created",e=>{console.log("\u{1F4E6} [USER] Nouvelle proposition re\xE7ue:",e),this.proposalCreated.set(e)}),this.socket.on("proposal:accepted",e=>{console.log("\u2705 [USER] Proposition accept\xE9e:",e),this.proposalAccepted.set(e.proposalId)}),this.socket.on("proposal:rejected",e=>{console.log("\u274C [USER] Proposition refus\xE9e:",e),this.proposalRejected.set(e)}),this.socket.on("proposal:expired",e=>{console.log("\u23F0 [USER] Proposition expir\xE9e:",e),this.proposalExpired.set(e.proposalId)}))}isConnected(){return this.connected()}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Te({token:n,factory:n.\u0275fac,providedIn:"root"})};var Dn=class n{http=M(je);getWebSocketToken(){return this.http.get(`${Se.apiUrl}/auth/ws-token`,{withCredentials:!0})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Te({token:n,factory:n.\u0275fac,providedIn:"root"})};function nc(n,e){n&1&&(y(0,"span",22),c(1,"Dashboard"),x())}function rc(n,e){n&1&&(y(0,"span",22),c(1,"Bo\xEEtes"),x())}function oc(n,e){n&1&&(y(0,"span",22),c(1,"Historique"),x())}var Ln=class n{router=M(ze);wsService=M(Et);authService=M(Dn);constructor(){at(()=>{let e=this.wsService.proposalCreated();e&&(console.log("\u{1F4E6} [USERS-HOME] Nouvelle proposition re\xE7ue:",e),e.isBatch&&e.batchId?(console.log(`\u{1F500} [USERS-HOME] Redirection vers validation batch: ${e.batchId} (${e.proposalIds?.length} propositions)`),this.router.navigate(["/utilisateurs/borrow/validation",e.batchId],{queryParams:{type:"batch"}})):e.proposalId?(console.log("\u{1F500} [USERS-HOME] Redirection vers validation unique:",e.proposalId),this.router.navigate(["/utilisateurs/borrow/validation",e.proposalId])):console.error("\u274C [USERS-HOME] ID de proposition manquant:",e))})}ngOnInit(){console.log("\u{1F680} [USERS-HOME] Initialisation du composant"),this.authService.getWebSocketToken().subscribe({next:e=>{e.success&&e.wsToken?(console.log("\u2705 [USERS-HOME] Token WebSocket obtenu"),this.wsService.connect(e.wsToken)):console.error("\u274C [USERS-HOME] Pas de token WebSocket dans la r\xE9ponse")},error:e=>{console.error("\u274C [USERS-HOME] Erreur r\xE9cup\xE9ration token WebSocket:",e),console.log("\u{1F4A1} [USERS-HOME] L'utilisateur doit \xEAtre connect\xE9 pour recevoir des propositions")}})}ngOnDestroy(){console.log("\u{1F50C} [USERS-HOME] D\xE9connexion du WebSocket"),this.wsService.disconnect()}onSettingsClick(){this.router.url.includes("/utilisateurs/parametres")?this.router.navigate(["/utilisateurs/dashboard"]):this.router.navigate(["/utilisateurs/parametres"])}isOnSettingsPage(){return this.router.url.includes("/utilisateurs/parametres")}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=G({type:n,selectors:[["app-users-home"]],decls:35,vars:5,consts:[["settingsLink","routerLinkActive"],["dashboardLink","routerLinkActive"],["boitesLink","routerLinkActive"],["historiqueLink","routerLinkActive"],[1,"flex","flex-col","h-screen"],[1,"fixed","top-0","left-0","right-0","bg-white","z-[1005]"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","items-center","h-22"],[1,"flex","items-center"],["href","/",1,"flex","items-center"],["src","logo.jpg","alt","logo loop-eat",1,"h-19","w-auto"],["routerLinkActive","active","aria-label","Param\xE8tres",1,"settings","flex","items-center","justify-center","w-11","h-11","rounded-lg","text-gray-600","hover:bg-emerald-100","hover:text-emerald-600","hover:cursor-pointer","transition-all","duration-200",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-9","h-9"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],[1,"flex-1"],[1,"fixed","bottom-0","left-0","right-0","bg-white","border-t","border-gray-200","z-[1005]"],[1,"max-w-3xl","mx-auto","px-4","pb-3"],[1,"flex","justify-around","items-center","h-16"],["routerLink","/utilisateurs/dashboard","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-item","flex","items-center","gap-3","py-2","px-4","rounded-lg","text-gray-600","hover:bg-gray-50","transition-all","duration-200"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-6","h-6","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","d","M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"],[1,"text-sm","font-medium","whitespace-nowrap"],["routerLink","/utilisateurs/boites","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-item","flex","items-center","gap-3","py-2","px-4","rounded-lg","text-gray-600","hover:bg-gray-50","transition-all","duration-200"],["x","4","y","4","width","16","height","3","rx","1","stroke-linecap","round","stroke-linejoin","round"],["stroke-linecap","round","stroke-linejoin","round","d","M5 7v10a2 2 0 002 2h10a2 2 0 002-2V7"],["stroke-linecap","round","stroke-linejoin","round","d","M8 7v3m8-3v3"],["routerLink","/utilisateurs/historique","routerLinkActive","active","ariaCurrentWhenActive","page",1,"nav-item","flex","items-center","gap-3","py-2","px-4","rounded-lg","text-gray-600","hover:bg-gray-50","transition-all","duration-200"],["stroke-linecap","round","stroke-linejoin","round","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"]],template:function(t,r){if(t&1){let o=j();y(0,"div",4)(1,"header",5)(2,"div",6)(3,"div",7)(4,"div",8)(5,"a",9)(6,"div",8),oe(7,"img",10),x()()(),y(8,"button",11,0),we("click",function(){return D(o),L(r.onSettingsClick())}),ae(),y(10,"svg",12),oe(11,"path",13)(12,"path",14),x()()()()(),ge(),y(13,"main",15),oe(14,"router-outlet"),x(),y(15,"footer",16)(16,"nav",17)(17,"div",18)(18,"a",19,1),ae(),y(20,"svg",20),oe(21,"path",21),x(),k(22,nc,2,0,"span",22),x(),ge(),y(23,"a",23,2),ae(),y(25,"svg",20),oe(26,"rect",24)(27,"path",25)(28,"path",26),x(),k(29,rc,2,0,"span",22),x(),ge(),y(30,"a",27,3),ae(),y(32,"svg",20),oe(33,"path",28),x(),k(34,oc,2,0,"span",22),x()()()()()}if(t&2){let o=Jt(19),i=Jt(24),s=Jt(31);f(8),De("active",r.isOnSettingsPage()),f(14),O(o.isActive?22:-1),f(7),O(i.isActive?29:-1),f(5),O(s.isActive?34:-1)}},dependencies:[Zr,Qr,eo],styles:[".nav-item.active[_ngcontent-%COMP%]{background-color:#eefff6;color:#064e3b}.settings.active[_ngcontent-%COMP%]{background-color:#eefff6;color:#059669}.nav-item.active[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke:#064e3b}footer[_ngcontent-%COMP%]{box-shadow:0 -2px 8px #0000001a}main[_ngcontent-%COMP%]{padding-bottom:5rem}"]})};var ic=["mapContainer"],sc=(n,e)=>e.id;function ac(n,e){if(n&1){let t=j();y(0,"button",13),we("click",function(){D(t);let o=C();return L(o.clearSearch())}),c(1," \u2715 "),x()}}function lc(n,e){if(n&1){let t=j();y(0,"div",16),we("click",function(){let o=D(t).$implicit,i=C(2);return L(i.centerOnRestaurant(o))}),y(1,"div",17)(2,"span",18),c(3),x(),y(4,"div",19)(5,"div",20),c(6),x(),y(7,"div",21),c(8),x()()()()}if(n&2){let t=e.$implicit;f(3),$(" ",t.type==="restaurant"?"\u{1F37D}\uFE0F":"\u{1F69A}"," "),f(3),V(t.name),f(2),V(t.address)}}function cc(n,e){if(n&1&&(y(0,"div",10)(1,"div",14),c(2),x(),ve(3,lc,9,3,"div",15,sc),x()),n&2){let t=C();f(2),$(" ",t.filteredRestaurants().length," r\xE9sultat(s) trouv\xE9(s) "),f(),Ce(t.filteredRestaurants())}}function dc(n,e){if(n&1&&(y(0,"div",25),oe(1,"img",35),x()),n&2){let t=C(2);f(),Ee("src",t.selectedRestaurant().image,Ze)("alt",t.selectedRestaurant().name)}}function uc(n,e){if(n&1&&(y(0,"div",17)(1,"span",9),c(2,"captive_portal"),x(),y(3,"a",36),c(4),x()()),n&2){let t=C(2);f(3),Ee("href",t.selectedRestaurant().site,Ze),f(),$(" ",t.selectedRestaurant().site," ")}}function pc(n,e){if(n&1&&(y(0,"div",17)(1,"span",9),c(2,"phone_enabled"),x(),y(3,"a",37),c(4),x()()),n&2){let t=C(2);f(3),Ee("href",t.getPhoneUrl(t.selectedRestaurant().contact),Ze),f(),$(" ",t.selectedRestaurant().contact," ")}}function fc(n,e){if(n&1&&(y(0,"div",22)(1,"div",23)(2,"div",24),k(3,dc,2,2,"div",25),y(4,"div",26)(5,"h3",27),c(6),x()()(),y(7,"div",28)(8,"div",29)(9,"span",30),c(10,"\u{1F4CD}"),x(),y(11,"span",31),c(12),x()(),k(13,uc,5,2,"div",17),k(14,pc,5,2,"div",17),x(),y(15,"div",32)(16,"a",33),c(17," \u{1F4CD} Itin\xE9raire "),x()()(),oe(18,"div",34),x()),n&2){let t=C();Gr("top",t.tooltipPosition().top,"px")("left",t.tooltipPosition().left,"px"),f(3),O(t.selectedRestaurant().image?3:-1),f(3),$(" ",t.selectedRestaurant().name," "),f(6),V(t.selectedRestaurant().address),f(),O(t.selectedRestaurant().site?13:-1),f(),O(t.selectedRestaurant().contact?14:-1),f(2),Ee("href",t.getDirectionsUrl(t.selectedRestaurant()),Ze)}}var Bn=class n{platformId=M(jr);map;markers=[];L;mapContainer;searchTerm=w("");selectedRestaurant=w(null);showDetails=w(!1);tooltipPosition=w({top:0,left:0});restaurants=w([{id:1,name:"La Gazette Caf\xE9",address:"6 rue Levat, 34000 Montpellier",lat:43.6104,lng:3.8795,site:"https://gazettecafe.com",contact:"04 67 59 07 59",image:"gazette.avif",description:"Cuisine maison avec produits locaux et bio",type:"restaurant"},{id:2,name:"Green Lab",address:"14 Rue de l'Universit\xE9, 34000 Montpellier",lat:43.6106,lng:3.8767,site:"https://green-lab-universite.eatbu.com",contact:"04 67 92 00 36",image:"greenlab.jpeg",description:"Restaurant 100% v\xE9g\xE9tal",type:"restaurant"},{id:3,name:"Les Cinq Saveurs d'Ananda",address:"8 Rue du Faubourg de la Saunerie, 34000 Montpellier",lat:43.6099,lng:3.8722,site:"https://instagram.com/saveursdana",contact:"04 67 02 88 18",image:"ananda.jpg",description:"Cuisine v\xE9g\xE9tarienne cr\xE9ative",type:"foodtruck"}]);filteredRestaurants=qe(()=>{let e=this.searchTerm().toLowerCase();return e?this.restaurants().filter(t=>t.name.toLowerCase().includes(e)||t.address.toLowerCase().includes(e)):this.restaurants()});async ngOnInit(){if(Yn(this.platformId)){let e=await import("./chunk-RWFKZEPJ.mjs");this.L=e.default}}ngAfterViewInit(){if(Yn(this.platformId)){let e=()=>{this.L&&this.mapContainer?(this.initMap(),this.addMarkers()):setTimeout(e,50)};setTimeout(e,100),document.addEventListener("click",t=>{let r=t.target;!r.closest(".custom-tooltip")&&!r.closest(".leaflet-marker-icon")&&this.closeDetails()})}}initMap(){if(!this.L||!this.mapContainer)return;let e=this.mapContainer.nativeElement;if(!(!e||e.classList.contains("leaflet-container")))try{this.map=this.L.map(e,{center:[43.6108,3.8767],zoom:11}),this.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors"}).addTo(this.map),setTimeout(()=>{this.map&&this.map.invalidateSize()},200),this.map.on("movestart",()=>{this.closeDetails()})}catch(t){console.error("Erreur lors de l'initialisation de la carte:",t)}}createCustomIcon(e){if(!this.L)return;let t=e==="restaurant"?this.getRestaurantIconSvg():this.getFoodtruckIconSvg();return this.L.divIcon({html:t,className:"custom-marker-icon",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-45]})}getRestaurantIconSvg(){return`
      <div class="marker-pin restaurant w-8 h-8">
        <svg id="Calque_1" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 618.5 828.9">
          <defs>
            <style>
              .st0 {
                fill: #fff;
              }

              .st1 {
                fill: #047857;
              }
            </style>
          </defs>
          <path class="st1" d="M536.8,535.3c-56.7,83.9-227.4,293.6-227.4,293.6,0,0-170.7-209.7-227.4-293.6C-29.8,370.1-14.6,207.3,100.7,92S233.9,5.5,309.4,5.5s151.1,28.8,208.7,86.5c115.3,115.3,130.4,278.1,18.7,443.3h0Z"/>
          <path class="st0" d="M462.7,476c10.2,10.2,10.8,26.1,1.5,35.4s-25.3,8.6-35.4-1.5l-104.6-114.8c-7.2,0-15.2-1.7-24.2-5.4l38.2-38.2,24.9,24.9,99.6,99.6ZM242.6,350l47-47-47.6-47.7-98.2-98.2c-3.2-3.2-7.2-4.7-11.7-4.1-3.2.4-7.8,3.4-8.6,11.2-3.3,31.9,20.1,87.4,103.3,170.6,5.5,5.5,10.7,10.5,15.8,15.1h0ZM330,218.9l6.1-6.1h0c0,0-6.2,6.1-6.2,6.1h.1ZM505.9,208.3c-5.3-5.3-12.6-6.6-16.3-2.9l-74.5,74.5c-3.7,3.7-10.6,2.8-15.4-1.9-4.8-4.8-5.6-11.7-1.9-15.4l74.5-74.5c3.7-3.7,2.4-11.1-2.9-16.3-5.3-5.3-12.6-6.6-16.3-2.9l-74.6,74.5c-3.7,3.7-10.6,2.8-15.4-1.9-4.8-4.8-5.6-11.7-1.9-15.4l74.6-74.5c3.7-3.7,2.4-11.1-2.9-16.3-5.3-5.3-12.6-6.6-16.3-2.9l-80.5,80.5c-26.2,26.3-17.8,44.6-2.9,61.2l-207.1,207.1c-10.2,10.2-10.9,26.1-1.5,35.4,9.3,9.3,25.3,8.6,35.4-1.5l207.1-207.1c16.6,15,34.9,23.4,61.3-3l80.4-80.4c3.7-3.7,2.4-11-2.9-16.3h0Z"/>
        </svg>
      </div>
    `}getFoodtruckIconSvg(){return`
      <div class="marker-pin foodtruck w-8 h-8">
        <svg id="Calque_1" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 607.3 824.4">
          <defs>
            <style>
              .st0 {
                fill: #fff;
              }

              .st1 {
                fill: #047857;
              }
            </style>
          </defs>
          <path class="st1" d="M531.1,529.8c-56.7,83.9-227.4,293.6-227.4,293.6,0,0-170.7-209.7-227.4-293.6C-35.5,364.6-20.3,201.8,95,86.5S228.2,0,303.7,0s151.1,28.8,208.7,86.5c115.3,115.3,130.4,278.1,18.7,443.3h0Z"/>
          <path class="st0" d="M479.9,125.3H212.1c-3.8,0-8.3,2.8-9.9,6.3l-49.1,132.9c-1.6,3.5-5.7,7.8-9.1,9.5l-34.6,18.1c-3.4,1.8-6.2,6.4-6.2,10.2v96.2c0,3.8,3.1,7,6.9,7h369.6c3.8,0,6.9-3.1,6.9-7V132.2c0-3.8-3.1-6.9-6.9-6.9h.2Z"/>
          <path class="st0" d="M257.3,405.4c0,27.7-22.5,50.1-50.2,50.1s-50.1-22.4-50.1-50.1,22.5-50.1,50.1-50.1,50.2,22.4,50.2,50.1Z"/>
          <path class="st1" d="M233.4,405.4c0,14.5-11.7,26.2-26.2,26.2s-26.2-11.7-26.2-26.2,11.7-26.2,26.2-26.2,26.2,11.7,26.2,26.2h0Z"/>
          <circle class="st0" cx="391.4" cy="405.4" r="50.2"/>
          <path class="st1" d="M417.5,405.4c0,14.5-11.7,26.2-26.2,26.2s-26.2-11.7-26.2-26.2,11.7-26.2,26.2-26.2,26.2,11.7,26.2,26.2h0Z"/>
          <polygon class="st1" points="174.4 264.7 215 153.7 233.4 153.7 233.4 264.7 174.4 264.7"/>
          <rect class="st1" x="257.3" y="153.7" width="205.2" height="111.1"/>
          <path class="st0" d="M307.7,166.3h-38.6v29.2h0v.5c0,10.1,8.6,18.2,19.2,18.2s19.2-8.2,19.2-18.2,0-.3,0-.5h.2v-29.2h0Z"/>
          <path class="st0" d="M355.4,166.3h-38.6v29.2h0v.5c0,10.1,8.6,18.2,19.2,18.2s19.2-8.2,19.2-18.2,0-.3,0-.5h.2v-29.2h0Z"/>
          <path class="st0" d="M403,166.3h-38.6v29.2h0v.5c0,10.1,8.6,18.2,19.2,18.2s19.2-8.2,19.2-18.2,0-.3,0-.5h.2v-29.2h0Z"/>
          <path class="st0" d="M450.7,166.3h-38.6v29.2h0v.5c0,10.1,8.6,18.2,19.2,18.2s19.2-8.2,19.2-18.2,0-.3,0-.5h.2v-29.2h0Z"/>
        </svg>
      </div>
    `}addMarkers(){!this.L||!this.map||(this.clearMarkers(),this.filteredRestaurants().forEach(e=>{let t=this.createCustomIcon(e.type),r=this.L.marker([e.lat,e.lng],{icon:t}).addTo(this.map).on("click",o=>{this.showRestaurantDetails(e,o)});this.markers.push(r)}))}clearMarkers(){this.markers.forEach(e=>e.remove()),this.markers=[]}showRestaurantDetails(e,t){if(this.selectedRestaurant.set(e),t&&this.map){let r=this.map.latLngToContainerPoint([e.lat,e.lng]);this.tooltipPosition.set({top:r.y-50,left:r.x})}this.showDetails.set(!0)}closeDetails(){this.showDetails.set(!1),setTimeout(()=>{this.selectedRestaurant.set(null)},200)}getDirectionsUrl(e){return`https://www.google.com/maps/dir/?api=1&destination=${e.lat},${e.lng}`}onSearch(){this.closeDetails(),this.addMarkers()}getPhoneUrl(e){return`tel:${e.replace(/\s/g,"")}`}centerOnRestaurant(e){this.map&&(this.map.setView([e.lat,e.lng],14),setTimeout(()=>{let t=this.map.latLngToContainerPoint([e.lat,e.lng]);this.tooltipPosition.set({top:t.y-50,left:t.x}),this.showRestaurantDetails(e)},300))}clearSearch(){this.searchTerm.set(""),this.closeDetails(),this.addMarkers()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=G({type:n,selectors:[["app-dashboard-map"]],viewQuery:function(t,r){if(t&1&&$r(ic,5),t&2){let o;Wr(o=Hr())&&(r.mapContainer=o.first)}},decls:14,vars:4,consts:[["mapContainer",""],["id","commercants",1,"flex","items-center","justify-center","pb-4"],[1,"w-full","max-w-3xl"],[1,"relative","w-full","h-[400px]","md:h-[500px]","lg:h-[500px]","rounded-lg","overflow-hidden","shadow-md"],[1,"absolute","top-2","left-1/2","transform","-translate-x-1/2","z-[1001]","bg-white","rounded-lg","shadow-lg","p-2","w-96","max-w-[calc(100%-2rem)]"],[1,"flex","gap-2"],["type","text","placeholder","Rechercher un commer\xE7ant...",1,"text-sm","flex-1","px-4","h-8","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-green-500","focus:border-transparent",3,"ngModelChange","ngModel"],["title","Effacer",1,"px-3","py-2","text-gray-500","hover:text-gray-700","transition-colors","hover:cursor-pointer"],[1,"flex","items-center","px-3","bg-green-500","text-white","rounded-lg","hover:bg-green-600","transition-colors","font-medium","hover:cursor-pointer",3,"click"],[1,"material-symbols-outlined"],[1,"mt-3","max-h-60","overflow-y-auto"],[1,"w-full","h-full"],[1,"custom-tooltip",3,"top","left"],["title","Effacer",1,"px-3","py-2","text-gray-500","hover:text-gray-700","transition-colors","hover:cursor-pointer",3,"click"],[1,"text-sm","text-gray-600","mb-2"],[1,"p-3","hover:bg-gray-50","cursor-pointer","border-b","border-gray-100","last:border-0","rounded","transition-colors"],[1,"p-3","hover:bg-gray-50","cursor-pointer","border-b","border-gray-100","last:border-0","rounded","transition-colors",3,"click"],[1,"flex","items-center","gap-2"],[1,"text-lg"],[1,"flex-1"],[1,"font-medium","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"custom-tooltip"],[1,"tooltip-content"],[1,"flex","items-start","gap-3","mb-3"],[1,"w-16","h-16","rounded-lg","overflow-hidden","flex-shrink-0","bg-gray-200"],[1,"flex-1","min-w-0"],[1,"font-bold","text-gray-900","text-sm","truncate"],[1,"space-y-2","text-xs"],[1,"flex","items-start","gap-2"],[1,"text-sm","flex-shrink-0"],[1,"text-gray-700","line-clamp-2"],[1,"flex","gap-2","mt-3","pt-3","border-t","border-gray-100","hover:cursor-pointer"],["target","_blank","rel","noopener noreferrer",1,"flex-1","px-3","py-1.5","bg-green-500","text-white","rounded","text-xs","font-medium","hover:bg-green-600","transition-colors","text-center",3,"href"],[1,"tooltip-arrow"],[1,"w-full","h-full","object-cover",3,"src","alt"],["target","_blank","rel","noopener noreferrer",1,"text-green-600","hover:text-green-700","font-medium",3,"href"],[1,"text-green-600","hover:text-green-700","font-medium","truncate",3,"href"]],template:function(t,r){if(t&1){let o=j();y(0,"section",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"input",6),Jr("ngModelChange",function(s){return D(o),Yr(r.searchTerm,s)||(r.searchTerm=s),L(s)}),we("ngModelChange",function(){return D(o),L(r.onSearch())}),x(),k(6,ac,2,0,"button",7),y(7,"button",8),we("click",function(){return D(o),L(r.onSearch())}),y(8,"span",9),c(9,"search"),x()()(),k(10,cc,5,1,"div",10),x(),oe(11,"div",11,0),k(13,fc,19,10,"div",12),x()()()}t&2&&(f(5),Xr("ngModel",r.searchTerm),f(),O(r.searchTerm()?6:-1),f(4),O(r.searchTerm()&&r.filteredRestaurants().length>0?10:-1),f(3),O(r.showDetails()&&r.selectedRestaurant()?13:-1))},dependencies:[oo,to,no,ro],styles:[`.leaflet-pane[_ngcontent-%COMP%], .leaflet-tile[_ngcontent-%COMP%], .leaflet-marker-icon[_ngcontent-%COMP%], .leaflet-marker-shadow[_ngcontent-%COMP%], .leaflet-tile-container[_ngcontent-%COMP%], .leaflet-pane[_ngcontent-%COMP%] > svg[_ngcontent-%COMP%], .leaflet-pane[_ngcontent-%COMP%] > canvas[_ngcontent-%COMP%], .leaflet-zoom-box[_ngcontent-%COMP%], .leaflet-image-layer[_ngcontent-%COMP%], .leaflet-layer[_ngcontent-%COMP%]{position:absolute;left:0;top:0}.leaflet-container[_ngcontent-%COMP%]{overflow:hidden}.leaflet-tile[_ngcontent-%COMP%], .leaflet-marker-icon[_ngcontent-%COMP%], .leaflet-marker-shadow[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-user-drag:none}.leaflet-tile[_ngcontent-%COMP%]::selection{background:transparent}.leaflet-safari[_ngcontent-%COMP%]   .leaflet-tile[_ngcontent-%COMP%]{image-rendering:-webkit-optimize-contrast}.leaflet-safari[_ngcontent-%COMP%]   .leaflet-tile-container[_ngcontent-%COMP%]{width:1600px;height:1600px;-webkit-transform-origin:0 0}.leaflet-marker-icon[_ngcontent-%COMP%], .leaflet-marker-shadow[_ngcontent-%COMP%]{display:block}.leaflet-container[_ngcontent-%COMP%]   .leaflet-overlay-pane[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{max-width:none!important;max-height:none!important}.leaflet-container[_ngcontent-%COMP%]   .leaflet-marker-pane[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .leaflet-container[_ngcontent-%COMP%]   .leaflet-shadow-pane[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .leaflet-container[_ngcontent-%COMP%]   .leaflet-tile-pane[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .leaflet-container[_ngcontent-%COMP%]   img.leaflet-image-layer[_ngcontent-%COMP%], .leaflet-container[_ngcontent-%COMP%]   .leaflet-tile[_ngcontent-%COMP%]{max-width:none!important;max-height:none!important;width:auto;padding:0}.leaflet-container[_ngcontent-%COMP%]   img.leaflet-tile[_ngcontent-%COMP%]{mix-blend-mode:plus-lighter}.leaflet-container.leaflet-touch-zoom[_ngcontent-%COMP%]{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.leaflet-container.leaflet-touch-drag[_ngcontent-%COMP%]{-ms-touch-action:pinch-zoom;touch-action:none;touch-action:pinch-zoom}.leaflet-container.leaflet-touch-drag.leaflet-touch-zoom[_ngcontent-%COMP%]{-ms-touch-action:none;touch-action:none}.leaflet-container[_ngcontent-%COMP%]{-webkit-tap-highlight-color:transparent}.leaflet-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{-webkit-tap-highlight-color:rgba(51,181,229,.4)}.leaflet-tile[_ngcontent-%COMP%]{filter:inherit;visibility:hidden}.leaflet-tile-loaded[_ngcontent-%COMP%]{visibility:inherit}.leaflet-zoom-box[_ngcontent-%COMP%]{width:0;height:0;-moz-box-sizing:border-box;box-sizing:border-box;z-index:800}.leaflet-overlay-pane[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{-moz-user-select:none}.leaflet-pane[_ngcontent-%COMP%]{z-index:400}.leaflet-tile-pane[_ngcontent-%COMP%]{z-index:200}.leaflet-overlay-pane[_ngcontent-%COMP%]{z-index:400}.leaflet-shadow-pane[_ngcontent-%COMP%]{z-index:500}.leaflet-marker-pane[_ngcontent-%COMP%]{z-index:600}.leaflet-tooltip-pane[_ngcontent-%COMP%]{z-index:650}.leaflet-popup-pane[_ngcontent-%COMP%]{z-index:700}.leaflet-map-pane[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{z-index:100}.leaflet-map-pane[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{z-index:200}.leaflet-vml-shape[_ngcontent-%COMP%]{width:1px;height:1px}.lvml[_ngcontent-%COMP%]{behavior:url(#default#VML);display:inline-block;position:absolute}.leaflet-control[_ngcontent-%COMP%]{position:relative;z-index:800;pointer-events:visiblePainted;pointer-events:auto}.leaflet-top[_ngcontent-%COMP%], .leaflet-bottom[_ngcontent-%COMP%]{position:absolute;z-index:1000;pointer-events:none}.leaflet-top[_ngcontent-%COMP%]{top:0}.leaflet-right[_ngcontent-%COMP%]{right:0}.leaflet-bottom[_ngcontent-%COMP%]{bottom:0}.leaflet-left[_ngcontent-%COMP%]{left:0}.leaflet-control[_ngcontent-%COMP%]{float:left;clear:both}.leaflet-right[_ngcontent-%COMP%]   .leaflet-control[_ngcontent-%COMP%]{float:right}.leaflet-top[_ngcontent-%COMP%]   .leaflet-control[_ngcontent-%COMP%]{margin-top:10px}.leaflet-bottom[_ngcontent-%COMP%]   .leaflet-control[_ngcontent-%COMP%]{margin-bottom:10px}.leaflet-left[_ngcontent-%COMP%]   .leaflet-control[_ngcontent-%COMP%]{margin-left:10px}.leaflet-right[_ngcontent-%COMP%]   .leaflet-control[_ngcontent-%COMP%]{margin-right:10px}.leaflet-fade-anim[_ngcontent-%COMP%]   .leaflet-popup[_ngcontent-%COMP%]{opacity:0;-webkit-transition:opacity .2s linear;-moz-transition:opacity .2s linear;transition:opacity .2s linear}.leaflet-fade-anim[_ngcontent-%COMP%]   .leaflet-map-pane[_ngcontent-%COMP%]   .leaflet-popup[_ngcontent-%COMP%]{opacity:1}.leaflet-zoom-animated[_ngcontent-%COMP%]{-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0}svg.leaflet-zoom-animated[_ngcontent-%COMP%]{will-change:transform}.leaflet-zoom-anim[_ngcontent-%COMP%]   .leaflet-zoom-animated[_ngcontent-%COMP%]{-webkit-transition:-webkit-transform .25s cubic-bezier(0,0,.25,1);-moz-transition:-moz-transform .25s cubic-bezier(0,0,.25,1);transition:transform .25s cubic-bezier(0,0,.25,1)}.leaflet-zoom-anim[_ngcontent-%COMP%]   .leaflet-tile[_ngcontent-%COMP%], .leaflet-pan-anim[_ngcontent-%COMP%]   .leaflet-tile[_ngcontent-%COMP%]{-webkit-transition:none;-moz-transition:none;transition:none}.leaflet-zoom-anim[_ngcontent-%COMP%]   .leaflet-zoom-hide[_ngcontent-%COMP%]{visibility:hidden}.leaflet-interactive[_ngcontent-%COMP%]{cursor:pointer}.leaflet-grab[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.leaflet-crosshair[_ngcontent-%COMP%], .leaflet-crosshair[_ngcontent-%COMP%]   .leaflet-interactive[_ngcontent-%COMP%]{cursor:crosshair}.leaflet-popup-pane[_ngcontent-%COMP%], .leaflet-control[_ngcontent-%COMP%]{cursor:auto}.leaflet-dragging[_ngcontent-%COMP%]   .leaflet-grab[_ngcontent-%COMP%], .leaflet-dragging[_ngcontent-%COMP%]   .leaflet-grab[_ngcontent-%COMP%]   .leaflet-interactive[_ngcontent-%COMP%], .leaflet-dragging[_ngcontent-%COMP%]   .leaflet-marker-draggable[_ngcontent-%COMP%]{cursor:move;cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.leaflet-marker-icon[_ngcontent-%COMP%], .leaflet-marker-shadow[_ngcontent-%COMP%], .leaflet-image-layer[_ngcontent-%COMP%], .leaflet-pane[_ngcontent-%COMP%] > svg[_ngcontent-%COMP%]   path[_ngcontent-%COMP%], .leaflet-tile-container[_ngcontent-%COMP%]{pointer-events:none}.leaflet-marker-icon.leaflet-interactive[_ngcontent-%COMP%], .leaflet-image-layer.leaflet-interactive[_ngcontent-%COMP%], .leaflet-pane[_ngcontent-%COMP%] > svg[_ngcontent-%COMP%]   path.leaflet-interactive[_ngcontent-%COMP%], svg.leaflet-image-layer.leaflet-interactive[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{pointer-events:visiblePainted;pointer-events:auto}.leaflet-container[_ngcontent-%COMP%]{background:#ddd;outline-offset:1px}.leaflet-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#0078a8}.leaflet-zoom-box[_ngcontent-%COMP%]{border:2px dotted #38f;background:#ffffff80}.leaflet-container[_ngcontent-%COMP%]{font-family:Helvetica Neue,Arial,Helvetica,sans-serif;font-size:12px;font-size:.75rem;line-height:1.5}.leaflet-bar[_ngcontent-%COMP%]{box-shadow:0 1px 5px #000000a6;border-radius:4px}.leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background-color:#fff;border-bottom:1px solid #ccc;width:26px;height:26px;line-height:26px;display:block;text-align:center;text-decoration:none;color:#000}.leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .leaflet-control-layers-toggle[_ngcontent-%COMP%]{background-position:50% 50%;background-repeat:no-repeat;display:block}.leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus{background-color:#f4f4f4}.leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:first-child{border-top-left-radius:4px;border-top-right-radius:4px}.leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:last-child{border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-bottom:none}.leaflet-bar[_ngcontent-%COMP%]   a.leaflet-disabled[_ngcontent-%COMP%]{cursor:default;background-color:#f4f4f4;color:#bbb}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:30px;height:30px;line-height:30px}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:first-child{border-top-left-radius:2px;border-top-right-radius:2px}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:last-child{border-bottom-left-radius:2px;border-bottom-right-radius:2px}.leaflet-control-zoom-in[_ngcontent-%COMP%], .leaflet-control-zoom-out[_ngcontent-%COMP%]{font:700 18px Lucida Console,Monaco,monospace;text-indent:1px}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-zoom-in[_ngcontent-%COMP%], .leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-zoom-out[_ngcontent-%COMP%]{font-size:22px}.leaflet-control-layers[_ngcontent-%COMP%]{box-shadow:0 1px 5px #0006;background:#fff;border-radius:5px}.leaflet-control-layers-toggle[_ngcontent-%COMP%]{background-image:url("./media/layers-55W3Q4RM.png");width:36px;height:36px}.leaflet-retina[_ngcontent-%COMP%]   .leaflet-control-layers-toggle[_ngcontent-%COMP%]{background-image:url("./media/layers-2x-TBM42ERR.png");background-size:26px 26px}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-layers-toggle[_ngcontent-%COMP%]{width:44px;height:44px}.leaflet-control-layers[_ngcontent-%COMP%]   .leaflet-control-layers-list[_ngcontent-%COMP%], .leaflet-control-layers-expanded[_ngcontent-%COMP%]   .leaflet-control-layers-toggle[_ngcontent-%COMP%]{display:none}.leaflet-control-layers-expanded[_ngcontent-%COMP%]   .leaflet-control-layers-list[_ngcontent-%COMP%]{display:block;position:relative}.leaflet-control-layers-expanded[_ngcontent-%COMP%]{padding:6px 10px 6px 6px;color:#333;background:#fff}.leaflet-control-layers-scrollbar[_ngcontent-%COMP%]{overflow-y:scroll;overflow-x:hidden;padding-right:5px}.leaflet-control-layers-selector[_ngcontent-%COMP%]{margin-top:2px;position:relative;top:1px}.leaflet-control-layers[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:13px;font-size:1.08333em}.leaflet-control-layers-separator[_ngcontent-%COMP%]{height:0;border-top:1px solid #ddd;margin:5px -10px 5px -6px}.leaflet-default-icon-path[_ngcontent-%COMP%]{background-image:url("./media/marker-icon-2V3QKKVC.png")}.leaflet-container[_ngcontent-%COMP%]   .leaflet-control-attribution[_ngcontent-%COMP%]{background:#fff;background:#fffc;margin:0}.leaflet-control-attribution[_ngcontent-%COMP%], .leaflet-control-scale-line[_ngcontent-%COMP%]{padding:0 5px;color:#333;line-height:1.4}.leaflet-control-attribution[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.leaflet-control-attribution[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .leaflet-control-attribution[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus{text-decoration:underline}.leaflet-attribution-flag[_ngcontent-%COMP%]{display:inline!important;vertical-align:baseline!important;width:1em;height:.6669em}.leaflet-left[_ngcontent-%COMP%]   .leaflet-control-scale[_ngcontent-%COMP%]{margin-left:5px}.leaflet-bottom[_ngcontent-%COMP%]   .leaflet-control-scale[_ngcontent-%COMP%]{margin-bottom:5px}.leaflet-control-scale-line[_ngcontent-%COMP%]{border:2px solid #777;border-top:none;line-height:1.1;padding:2px 5px 1px;white-space:nowrap;-moz-box-sizing:border-box;box-sizing:border-box;background:#fffc;text-shadow:1px 1px #fff}.leaflet-control-scale-line[_ngcontent-%COMP%]:not(:first-child){border-top:2px solid #777;border-bottom:none;margin-top:-2px}.leaflet-control-scale-line[_ngcontent-%COMP%]:not(:first-child):not(:last-child){border-bottom:2px solid #777}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-attribution[_ngcontent-%COMP%], .leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-layers[_ngcontent-%COMP%], .leaflet-touch[_ngcontent-%COMP%]   .leaflet-bar[_ngcontent-%COMP%]{box-shadow:none}.leaflet-touch[_ngcontent-%COMP%]   .leaflet-control-layers[_ngcontent-%COMP%], .leaflet-touch[_ngcontent-%COMP%]   .leaflet-bar[_ngcontent-%COMP%]{border:2px solid rgba(0,0,0,.2);background-clip:padding-box}.leaflet-popup[_ngcontent-%COMP%]{position:absolute;text-align:center;margin-bottom:20px}.leaflet-popup-content-wrapper[_ngcontent-%COMP%]{padding:1px;text-align:left;border-radius:12px}.leaflet-popup-content[_ngcontent-%COMP%]{margin:13px 24px 13px 20px;line-height:1.3;font-size:13px;font-size:1.08333em;min-height:1px}.leaflet-popup-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:1.3em 0}.leaflet-popup-tip-container[_ngcontent-%COMP%]{width:40px;height:20px;position:absolute;left:50%;margin-top:-1px;margin-left:-20px;overflow:hidden;pointer-events:none}.leaflet-popup-tip[_ngcontent-%COMP%]{width:17px;height:17px;padding:1px;margin:-10px auto 0;pointer-events:auto;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}.leaflet-popup-content-wrapper[_ngcontent-%COMP%], .leaflet-popup-tip[_ngcontent-%COMP%]{background:#fff;color:#333;box-shadow:0 3px 14px #0006}.leaflet-container[_ngcontent-%COMP%]   a.leaflet-popup-close-button[_ngcontent-%COMP%]{position:absolute;top:0;right:0;border:none;text-align:center;width:24px;height:24px;font:16px/24px Tahoma,Verdana,sans-serif;color:#757575;text-decoration:none;background:transparent}.leaflet-container[_ngcontent-%COMP%]   a.leaflet-popup-close-button[_ngcontent-%COMP%]:hover, .leaflet-container[_ngcontent-%COMP%]   a.leaflet-popup-close-button[_ngcontent-%COMP%]:focus{color:#585858}.leaflet-popup-scrolled[_ngcontent-%COMP%]{overflow:auto}.leaflet-oldie[_ngcontent-%COMP%]   .leaflet-popup-content-wrapper[_ngcontent-%COMP%]{-ms-zoom:1}.leaflet-oldie[_ngcontent-%COMP%]   .leaflet-popup-tip[_ngcontent-%COMP%]{width:24px;margin:0 auto;-ms-filter:"progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)";filter:progid:DXImageTransform.Microsoft.Matrix(M11=.70710678,M12=.70710678,M21=-.70710678,M22=.70710678)}.leaflet-oldie[_ngcontent-%COMP%]   .leaflet-control-zoom[_ngcontent-%COMP%], .leaflet-oldie[_ngcontent-%COMP%]   .leaflet-control-layers[_ngcontent-%COMP%], .leaflet-oldie[_ngcontent-%COMP%]   .leaflet-popup-content-wrapper[_ngcontent-%COMP%], .leaflet-oldie[_ngcontent-%COMP%]   .leaflet-popup-tip[_ngcontent-%COMP%]{border:1px solid #999}.leaflet-div-icon[_ngcontent-%COMP%]{background:#fff;border:1px solid #666}.leaflet-tooltip[_ngcontent-%COMP%]{position:absolute;padding:6px;background-color:#fff;border:1px solid #fff;border-radius:3px;color:#222;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;pointer-events:none;box-shadow:0 1px 3px #0006}.leaflet-tooltip.leaflet-interactive[_ngcontent-%COMP%]{cursor:pointer;pointer-events:auto}.leaflet-tooltip-top[_ngcontent-%COMP%]:before, .leaflet-tooltip-bottom[_ngcontent-%COMP%]:before, .leaflet-tooltip-left[_ngcontent-%COMP%]:before, .leaflet-tooltip-right[_ngcontent-%COMP%]:before{position:absolute;pointer-events:none;border:6px solid transparent;background:transparent;content:""}.leaflet-tooltip-bottom[_ngcontent-%COMP%]{margin-top:6px}.leaflet-tooltip-top[_ngcontent-%COMP%]{margin-top:-6px}.leaflet-tooltip-bottom[_ngcontent-%COMP%]:before, .leaflet-tooltip-top[_ngcontent-%COMP%]:before{left:50%;margin-left:-6px}.leaflet-tooltip-top[_ngcontent-%COMP%]:before{bottom:0;margin-bottom:-12px;border-top-color:#fff}.leaflet-tooltip-bottom[_ngcontent-%COMP%]:before{top:0;margin-top:-12px;margin-left:-6px;border-bottom-color:#fff}.leaflet-tooltip-left[_ngcontent-%COMP%]{margin-left:-6px}.leaflet-tooltip-right[_ngcontent-%COMP%]{margin-left:6px}.leaflet-tooltip-left[_ngcontent-%COMP%]:before, .leaflet-tooltip-right[_ngcontent-%COMP%]:before{top:50%;margin-top:-6px}.leaflet-tooltip-left[_ngcontent-%COMP%]:before{right:0;margin-right:-12px;border-left-color:#fff}.leaflet-tooltip-right[_ngcontent-%COMP%]:before{left:0;margin-left:-12px;border-right-color:#fff}@media print{.leaflet-control[_ngcontent-%COMP%]{-webkit-print-color-adjust:exact;print-color-adjust:exact}}.custom-marker-icon[_ngcontent-%COMP%]{background:none;border:none}.marker-pin[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50% 50% 50% 0;position:relative;transform:rotate(-45deg);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px #0000004d;transition:transform .3s ease;cursor:pointer}.marker-pin[_ngcontent-%COMP%]:hover{transform:rotate(-45deg) scale(1.1)}.marker-pin[_ngcontent-%COMP%]:after{content:"";width:8px;height:8px;border-radius:50%;position:absolute;background:#fff;bottom:-4px;right:-4px;box-shadow:0 2px 4px #0003}.marker-pin[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:rotate(45deg);filter:drop-shadow(0 1px 2px rgba(0,0,0,.2))}.marker-pin.restaurant[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669)}.marker-pin.foodtruck[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706)}.custom-tooltip[_ngcontent-%COMP%]{position:absolute;z-index:1002;pointer-events:none;transform:translate(-50%,-100%);animation:_ngcontent-%COMP%_tooltipFadeIn .2s ease-out}.tooltip-content[_ngcontent-%COMP%]{position:relative;background:#fff;border-radius:12px;padding:16px;box-shadow:0 8px 24px #00000040;width:320px;max-width:calc(100vw - 32px);pointer-events:auto;margin-bottom:12px}.tooltip-arrow[_ngcontent-%COMP%]{position:absolute;bottom:0;left:50%;transform:translate(-50%);width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-top:12px solid white;filter:drop-shadow(0 4px 6px rgba(0,0,0,.1))}@keyframes _ngcontent-%COMP%_tooltipFadeIn{0%{opacity:0;transform:translate(-50%,-100%) scale(.95)}to{opacity:1;transform:translate(-50%,-100%) scale(1)}}.simple-tooltip[_ngcontent-%COMP%]{background-color:#000000d9!important;border:none!important;color:#fff!important;font-weight:500!important;padding:6px 10px!important;border-radius:6px!important;box-shadow:0 4px 12px #0000004d!important;font-size:13px!important}.simple-tooltip[_ngcontent-%COMP%]:before{border-top-color:#000000d9!important}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#10b981;border-radius:3px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#059669}@media (max-width: 640px){.tooltip-content[_ngcontent-%COMP%]{width:280px;padding:12px}.custom-tooltip[_ngcontent-%COMP%]{max-width:calc(100vw - 16px)}}.leaflet-control-zoom[_ngcontent-%COMP%]{margin-top:30px!important}

`]})};var Ye=class n{http=M(je);apiUrl=`${Se.apiUrl}/payment`;createRechargeSession(e){return this.http.post(`${this.apiUrl}/create-recharge-session`,{amount:e},{withCredentials:!0})}verifySession(e){return this.http.get(`${this.apiUrl}/verify-session/${e}`,{withCredentials:!0})}getUserBalance(){return this.http.get(`${this.apiUrl}/balance`,{withCredentials:!0})}getBalanceHistory(e=50){return this.http.get(`${this.apiUrl}/history?limit=${e}`,{withCredentials:!0})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Te({token:n,factory:n.\u0275fac,providedIn:"root"})};var In=class n{http=M(je);apiUrl=`${Se.apiUrl}/accounts`;getBasicInfo(){return this.http.get(`${this.apiUrl}/info`,{withCredentials:!0})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Te({token:n,factory:n.\u0275fac,providedIn:"root"})};var Je=class n{http=M(je);apiUrl=`${Se.apiUrl}/borrow`;getProposal(e){return this.http.get(`${this.apiUrl}/proposal/${e}`,{withCredentials:!0})}getPendingProposals(){return this.http.get(`${this.apiUrl}/pending`,{withCredentials:!0})}getActiveBorrows(){return this.http.get(`${this.apiUrl}/active`,{withCredentials:!0})}acceptProposal(e){return this.http.post(`${this.apiUrl}/accept/${e}`,{},{withCredentials:!0})}rejectProposal(e){return this.http.post(`${this.apiUrl}/reject/${e}`,{},{withCredentials:!0})}getBorrowHistory(e=50){return this.http.get(`${this.apiUrl}/history?limit=${e}`,{withCredentials:!0})}getBatchProposals(e){return this.http.get(`${this.apiUrl}/batch/${e}`,{withCredentials:!0})}acceptBatch(e){return this.http.post(`${this.apiUrl}/batch/${e}/accept`,{},{withCredentials:!0})}rejectBatch(e){return this.http.post(`${this.apiUrl}/batch/${e}/reject`,{},{withCredentials:!0})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Te({token:n,factory:n.\u0275fac,providedIn:"root"})};function hc(n,e){n&1&&(y(0,"span",8),c(1,"\u27F3"),x())}function mc(n,e){n&1&&(y(0,"span"),c(1,"+"),x())}function gc(n,e){if(n&1){let t=j();y(0,"button",17),we("click",function(){let o=D(t).$implicit,i=C(2);return L(i.recharge(o))}),y(1,"span",18),c(2),x(),y(3,"span",19),c(4," arrow_forward "),x()()}if(n&2){let t=e.$implicit,r=C(2);Ee("disabled",r.isLoading()),f(2),$("",t," \u20AC")}}function _c(n,e){if(n&1&&(y(0,"div",9)(1,"div",14)(2,"p",15),c(3,"Montant \xE0 recharger"),x(),ve(4,gc,5,2,"button",16,zr),x()()),n&2){let t=C();f(4),Ce(t.rechargeAmounts)}}var Fn=class n{paymentService=M(Ye);accountsService=M(In);borrowService=M(Je);showRechargeMenu=w(!1);isLoading=w(!1);balance=w(0);userName=w("");borrowedBoxes=w(0);customerCode=w("");rechargeAmounts=[5,10,20,50];ngOnInit(){this.loadUserBasicInfo(),this.loadUserBalance(),this.loadBorrowedBoxes()}loadUserBasicInfo(){this.accountsService.getBasicInfo().subscribe({next:e=>{if(e.success){let t=e.data;this.customerCode.set(t.code),t.isPro?this.userName.set(t.name||""):this.userName.set(`${t.firstName||""} ${t.lastName||""}`.trim())}},error:e=>{console.error("Erreur lors du chargement des infos utilisateur:",e)}})}loadUserBalance(){this.paymentService.getUserBalance().subscribe({next:e=>{e.success&&this.balance.set(e.balance)},error:e=>{console.error("Erreur lors du chargement du solde:",e)}})}loadBorrowedBoxes(){this.borrowService.getActiveBorrows().subscribe({next:e=>{e.success&&this.borrowedBoxes.set(e.totalBoxes)},error:e=>{console.error("Erreur lors du chargement des bo\xEEtes emprunt\xE9es:",e)}})}toggleRechargeMenu(){this.showRechargeMenu.update(e=>!e)}closeRechargeMenu(){this.showRechargeMenu.set(!1)}async recharge(e){if(!this.isLoading()){this.isLoading.set(!0),this.closeRechargeMenu();try{let t=await this.paymentService.createRechargeSession(e).toPromise();t?.success&&t.url&&(window.location.href=t.url)}catch(t){console.error("Erreur lors de la cr\xE9ation de la session de paiement:",t),alert("Une erreur est survenue. Veuillez r\xE9essayer."),this.isLoading.set(!1)}}}refreshBalance(){this.loadUserBalance()}refreshBorrowedBoxes(){this.loadBorrowedBoxes()}handleClickOutside(e){e.target.closest(".recharge-container")||this.closeRechargeMenu()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=G({type:n,selectors:[["app-dashboard"]],decls:28,vars:7,consts:[[1,"h-full","overflow-y-auto","pt-23",3,"click"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"shadow-md","bg-white","rounded-sm","p-4","lg:p-8","mb-6","text-center","w-fit","mx-auto","border","border-gray-100","hover:shadow-md","hover:scale-105","transition-all"],[1,"material-symbols-outlined","block","mb-1",2,"font-size","30px"],[1,"text-xl","font-bold","text-gray-900"],[1,"grid","grid-cols-2","gap-6","mb-6"],[1,"recharge-container","shadow-md","bg-white","border","border-gray-100","rounded-lg","p-3","text-center","relative","hover:shadow-md","hover:scale-105","transition-all","z-[1003]"],["type","button","aria-label","Recharger le solde",1,"absolute","-top-1","-right-1","w-10","h-10","bg-emerald-50","border-1","border-emerald-900","rounded-full","flex","items-center","justify-center","text-emerald-900","font-bold","text-xl","hover:bg-emerald-100","hover:cursor-pointer","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"animate-spin"],[1,"absolute","top-12","right-0","bg-white","border","border-gray-200","rounded-lg","shadow-xl","z-[1003]","min-w-[150px]","overflow-hidden"],[1,"text-4xl","font-bold","text-gray-900","mb-2"],[1,"text-md","text-gray-600"],[1,"shadow-md","bg-white","border","border-gray-100","rounded-lg","p-3","text-center","hover:shadow-md","hover:scale-105","transition-all"],[1,"shadow-md","bg-white","border","border-gray-100","rounded-lg","p-3","text-center","mb-6","hover:shadow-md","hover:scale-105","transition-all"],[1,"p-2"],[1,"text-sm","text-gray-600","font-semibold","mb-2","px-2"],["type","button",1,"w-full","text-left","px-4","py-3","hover:bg-emerald-50","transition-colors","rounded-md","flex","justify-between","items-center","group","disabled:opacity-50","disabled:cursor-not-allowed","cursor-pointer",3,"disabled"],["type","button",1,"w-full","text-left","px-4","py-3","hover:bg-emerald-50","transition-colors","rounded-md","flex","justify-between","items-center","group","disabled:opacity-50","disabled:cursor-not-allowed","cursor-pointer",3,"click","disabled"],[1,"font-medium","text-gray-900","group-hover:text-emerald-900"],[1,"material-symbols-outlined","text-gray-400","group-hover:text-emerald-900","text-sm"]],template:function(t,r){t&1&&(y(0,"div",0),we("click",function(i){return r.handleClickOutside(i)}),y(1,"div",1)(2,"div",2)(3,"span",3),c(4," account_circle "),x(),y(5,"p",4),c(6),x()(),y(7,"div",5)(8,"div",6)(9,"button",7),we("click",function(){return r.toggleRechargeMenu()}),k(10,hc,2,0,"span",8)(11,mc,2,0,"span"),x(),k(12,_c,6,0,"div",9),y(13,"p",10),c(14),x(),y(15,"p",11),c(16,"Solde"),x()(),y(17,"div",12)(18,"p",10),c(19),x(),y(20,"p",11),c(21,"Bo\xEEtes emprunt\xE9es"),x()()(),y(22,"div",13)(23,"p",10),c(24),x(),y(25,"p",11),c(26,"Code client"),x()(),oe(27,"app-dashboard-map"),x()()),t&2&&(f(6),V(r.userName()),f(3),Ee("disabled",r.isLoading()),f(),O(r.isLoading()?10:11),f(2),O(r.showRechargeMenu()?12:-1),f(2),$("",r.balance()," \u20AC"),f(5),V(r.borrowedBoxes()),f(5),V(r.customerCode()))},dependencies:[Bn,_e],encapsulation:2})};var bc=(n,e)=>e.id;function xc(n,e){n&1&&(y(0,"div",2),oe(1,"div",5),x())}function yc(n,e){if(n&1&&(y(0,"div",6)(1,"div",7)(2,"div",8)(3,"span",9),c(4),x()(),y(5,"div",10)(6,"p",11),c(7),x(),y(8,"p",12),c(9),x()(),y(10,"p",13),c(11),x()()()),n&2){let t=e.$implicit,r=C(2);f(2),Ee("ngClass",r.isAddition(t)?"bg-green-100":"bg-red-100"),f(2),$(" ",r.getIcon(t)," "),f(3),V(t.title),f(2),V(r.formatDate(t.date)),f(),Ee("ngClass",r.isAddition(t)?"text-green-600":"text-red-600"),f(),st(" ",r.isAddition(t)?"+":"-"," ",r.getAbsoluteAmount(t)," \u20AC ")}}function vc(n,e){if(n&1&&(y(0,"div",3),ve(1,yc,12,7,"div",6,bc),x()),n&2){let t=C();f(),Ce(t.transactions())}}function Cc(n,e){n&1&&(y(0,"div",4)(1,"span",14),c(2," receipt_long "),x(),y(3,"p",15),c(4,"Aucune transaction pour le moment"),x()())}var An=class n{paymentService=M(Ye);transactions=w([]);isLoading=w(!0);ngOnInit(){this.loadHistory()}loadHistory(){this.isLoading.set(!0),this.paymentService.getBalanceHistory().subscribe({next:e=>{if(e.success&&e.history){let t=e.history.map(r=>{let o=r.add!==null&&r.add>0,i=o?r.add||0:r.subtract||0;return{id:`transaction-${r.id}`,title:r.title,date:r.created,amount:i,isAddition:o}});this.transactions.set(t)}this.isLoading.set(!1)},error:e=>{console.error("Erreur lors du chargement de l'historique:",e),this.isLoading.set(!1)}})}isAddition(e){return e.isAddition}formatDate(e){return new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})}getAbsoluteAmount(e){return Math.abs(e.amount)}getIcon(e){let t=e.title.toLowerCase();return t.includes("rendue")||t.includes("retour")?"stockpot":t.includes("emprunt")?"lunch_dining":"add_card"}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=G({type:n,selectors:[["app-historical"]],decls:5,vars:1,consts:[[1,"h-full","overflow-y-auto","pt-16"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"flex","justify-center","items-center","py-12"],[1,"space-y-3"],[1,"text-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-emerald-600"],[1,"bg-white","rounded-lg","p-4","shadow-sm","hover:shadow-md","hover:translate-x-1","transition-all","duration-200","border","border-gray-100"],[1,"flex","items-center","gap-4"],[1,"w-12","h-12","rounded-lg","flex","items-center","justify-center","text-2xl","flex-shrink-0",3,"ngClass"],[1,"material-symbols-outlined"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"text-lg","font-bold","flex-shrink-0",3,"ngClass"],[1,"material-symbols-outlined","text-gray-400","text-6xl","mb-4"],[1,"text-gray-600","text-lg"]],template:function(t,r){t&1&&(y(0,"div",0)(1,"div",1),k(2,xc,2,0,"div",2)(3,vc,3,0,"div",3)(4,Cc,5,0,"div",4),x()()),t&2&&(f(2),O(r.isLoading()?2:r.transactions().length>0?3:4))},dependencies:[_e,Kr],encapsulation:2})};var Ec=(n,e)=>e.type;function wc(n,e){n&1&&(d(0,"div",2),ie(1,"div",5),p())}function Sc(n,e){if(n&1&&(d(0,"div",3)(1,"p",6),c(2),p()()),n&2){let t=C();f(2),V(t.errorMessage())}}function kc(n,e){if(n&1&&(d(0,"div",7)(1,"div",8)(2,"div",9),ie(3,"img",10),p(),d(4,"p",11),c(5),p()()()),n&2){let t=e.$implicit,r=C(2);f(3),le("src",t.image,Ze)("alt",t.label),f(2),$(" ",r.getBoxText(t)," ")}}function Oc(n,e){if(n&1&&(d(0,"div",4),ve(1,kc,6,3,"div",7,Ec),p()),n&2){let t=C();f(),Ce(t.boxes())}}var Un=class n{borrowService=M(Je);boxes=w([]);isLoading=w(!0);errorMessage=w(null);boxTypeConfig={1:{image:"verre-salade.webp",label:"Bo\xEEte Verre Salade"},2:{image:"plastique-salade.webp",label:"Bo\xEEte Plastique Salade"},3:{image:"frites.jpg",label:"Bo\xEEte Frite"},4:{image:"pizza.png",label:"Bo\xEEte Pizza"},5:{image:"gobelet.jpg",label:"Gobelet"},6:{image:"burger.jpg",label:"Bo\xEEte Burger"}};ngOnInit(){this.loadBorrowedBoxes()}loadBorrowedBoxes(){this.isLoading.set(!0),this.errorMessage.set(null),this.borrowService.getActiveBorrows().subscribe({next:e=>{if(e.success&&e.borrows){let t=new Map;e.borrows.forEach(o=>{o.items.forEach(i=>{let s=typeof i.type=="string"?parseInt(i.type):i.type,u=t.get(s)||0;t.set(s,u+i.number)})});let r=Array.from(t.entries()).map(([o,i])=>{let s=this.boxTypeConfig[o]||{image:"default-box.png",label:`Bo\xEEte Type ${o}`};return{type:o,totalNumber:i,image:s.image,label:s.label}});r.sort((o,i)=>o.type-i.type),this.boxes.set(r)}else this.boxes.set([]);this.isLoading.set(!1)},error:e=>{console.error("Erreur lors du chargement des bo\xEEtes:",e),this.errorMessage.set("Impossible de charger vos bo\xEEtes emprunt\xE9es"),this.isLoading.set(!1)}})}getBoxText(e){return e.totalNumber===1?`1 ${e.label} emprunt\xE9e`:`${e.totalNumber} ${e.label}s emprunt\xE9es`}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=G({type:n,selectors:[["app-boxes"]],decls:5,vars:1,consts:[[1,"h-full","overflow-y-auto","pt-16"],[1,"max-w-3xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"flex","justify-center","items-center","py-12"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","text-center"],[1,"grid","grid-cols-2","sm:grid-cols-3","lg:grid-cols-4","gap-4"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-emerald-900"],[1,"text-red-800"],[1,"bg-white","rounded-lg","p-4","shadow-sm","hover:shadow-md","hover:scale-105","transition-all","duration-200","border","border-gray-100"],[1,"flex","flex-col","items-center","gap-3"],[1,"w-30","h-30","rounded-lg","flex","items-center","justify-center"],[1,"max-w-full","max-h-full","object-contain",3,"src","alt"],[1,"font-semibold","text-gray-900","text-center"]],template:function(t,r){t&1&&(d(0,"div",0)(1,"div",1),k(2,wc,2,0,"div",2)(3,Sc,3,1,"div",3)(4,Oc,3,0,"div",4),p()()),t&2&&(f(2),O(r.isLoading()?2:r.errorMessage()?3:4))},dependencies:[_e],encapsulation:2})};function Pc(n,e){if(n&1){let t=j();d(0,"div",8)(1,"form",13),B("ngSubmit",function(){D(t);let o=C();return L(o.updateNom())}),d(2,"div")(3,"label",14),c(4,"Nouveau nom"),p(),d(5,"input",15),B("input",function(o){D(t);let i=C();return L(i.nom.set(o.target.value))}),p()(),d(6,"button",16),c(7," Enregistrer "),p()()()}if(n&2){let t=C();f(5),le("value",t.nom())}}function Mc(n,e){if(n&1){let t=j();d(0,"div",8)(1,"form",13),B("ngSubmit",function(){D(t);let o=C();return L(o.updatePrenom())}),d(2,"div")(3,"label",17),c(4,"Nouveau pr\xE9nom"),p(),d(5,"input",18),B("input",function(o){D(t);let i=C();return L(i.prenom.set(o.target.value))}),p()(),d(6,"button",16),c(7," Enregistrer "),p()()()}if(n&2){let t=C();f(5),le("value",t.prenom())}}function Tc(n,e){if(n&1){let t=j();d(0,"div",8)(1,"form",13),B("ngSubmit",function(){D(t);let o=C();return L(o.updateEmail())}),d(2,"div")(3,"label",19),c(4,"Nouvel email"),p(),d(5,"input",20),B("input",function(o){D(t);let i=C();return L(i.email.set(o.target.value))}),p()(),d(6,"button",16),c(7," Enregistrer "),p()()()}if(n&2){let t=C();f(5),le("value",t.email())}}function Rc(n,e){if(n&1){let t=j();d(0,"div",8)(1,"form",13),B("ngSubmit",function(){D(t);let o=C();return L(o.updatePassword())}),d(2,"div")(3,"label",21),c(4,"Mot de passe actuel"),p(),d(5,"input",22),B("input",function(o){D(t);let i=C();return L(i.currentPassword.set(o.target.value))}),p()(),d(6,"div")(7,"label",23),c(8,"Nouveau mot de passe"),p(),d(9,"input",24),B("input",function(o){D(t);let i=C();return L(i.newPassword.set(o.target.value))}),p()(),d(10,"div")(11,"label",25),c(12,"Confirmer le mot de passe"),p(),d(13,"input",26),B("input",function(o){D(t);let i=C();return L(i.confirmPassword.set(o.target.value))}),p()(),d(14,"button",16),c(15," Changer le mot de passe "),p()()()}if(n&2){let t=C();f(5),le("value",t.currentPassword()),f(4),le("value",t.newPassword()),f(4),le("value",t.confirmPassword())}}function Nc(n,e){if(n&1){let t=j();d(0,"div",8)(1,"p",27),c(2," Votre solde actuel est de "),d(3,"strong",28),c(4),p()(),d(5,"button",29),B("click",function(){D(t);let o=C();return L(o.recupererSolde())}),c(6," R\xE9cup\xE9rer la solde "),p()()}if(n&2){let t=C();f(4),$("",t.solde()," \u20AC")}}function Dc(n,e){if(n&1){let t=j();d(0,"div",8)(1,"p",30)(2,"strong",31),c(3,"Attention !"),p(),c(4," Cette action est irr\xE9versible. Vous devez d'abord r\xE9cup\xE9rer votre solde et toutes vos donn\xE9es seront d\xE9finitivement supprim\xE9es. "),p(),d(5,"form",13),B("ngSubmit",function(){D(t);let o=C();return L(o.deleteAccount())}),d(6,"div")(7,"label",32),c(8,'Tapez "SUPPRIMER" pour confirmer'),p(),d(9,"input",33),B("input",function(o){D(t);let i=C();return L(i.deleteConfirmation.set(o.target.value))}),p()(),d(10,"button",34),c(11," Supprimer d\xE9finitivement mon compte "),p()()()}if(n&2){let t=C();f(9),le("value",t.deleteConfirmation()),f(),le("disabled",t.deleteConfirmation()!=="SUPPRIMER")}}var Vn=class n{authInitService=M(io);nom=w("Nom");prenom=w("Pr\xE9nom");email=w("email@example.com");solde=w(0);currentPassword=w("");newPassword=w("");confirmPassword=w("");deleteConfirmation=w("");expandedSection=w(null);toggleSection(e){this.expandedSection()===e?this.expandedSection.set(null):this.expandedSection.set(e)}updateNom(){console.log("Mise \xE0 jour du nom:",this.nom()),alert(`Nom mis \xE0 jour: ${this.nom()}`),this.expandedSection.set(null)}updatePrenom(){console.log("Mise \xE0 jour du pr\xE9nom:",this.prenom()),alert(`Pr\xE9nom mis \xE0 jour: ${this.prenom()}`),this.expandedSection.set(null)}updateEmail(){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email())){alert("Veuillez entrer un email valide");return}console.log("Mise \xE0 jour de l'email:",this.email()),alert(`Email mis \xE0 jour: ${this.email()}`),this.expandedSection.set(null)}updatePassword(){if(!this.currentPassword()){alert("Veuillez entrer votre mot de passe actuel");return}if(this.newPassword().length<8){alert("Le nouveau mot de passe doit contenir au moins 8 caract\xE8res");return}if(this.newPassword()!==this.confirmPassword()){alert("Les mots de passe ne correspondent pas");return}console.log("Changement de mot de passe"),alert("Mot de passe chang\xE9 avec succ\xE8s"),this.currentPassword.set(""),this.newPassword.set(""),this.confirmPassword.set(""),this.expandedSection.set(null)}recupererSolde(){console.log("R\xE9cup\xE9ration de la solde:",this.solde()),alert(`Demande de r\xE9cup\xE9ration de ${this.solde()} \u20AC envoy\xE9e`),this.expandedSection.set(null)}async logout(){console.log("D\xE9connexion de l'utilisateur"),await this.authInitService.logout(),this.expandedSection.set(null)}deleteAccount(){if(this.deleteConfirmation()!=="SUPPRIMER"){alert('Veuillez taper "SUPPRIMER" pour confirmer');return}console.log("Suppression du compte"),confirm("\xCAtes-vous absolument certain de vouloir supprimer votre compte ?")&&(alert("Compte supprim\xE9. Vous allez \xEAtre redirig\xE9..."),this.expandedSection.set(null))}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=G({type:n,selectors:[["app-settings"]],decls:62,vars:22,consts:[[1,"max-w-3xl","mx-auto","px-4","md:px-8","pt-22"],[1,"bg-white","border","border-gray-200","rounded-xl","mb-4","overflow-hidden","hover:shadow-md","transition-shadow"],["type","button",1,"w-full","flex","items-center","justify-between","p-5","text-left","hover:bg-gray-50","transition-colors","hover:cursor-pointer",3,"click"],[1,"text-base","font-semibold","text-gray-700"],[1,"flex","items-center","gap-3"],[1,"text-sm","text-gray-500","max-w-[200px]","truncate"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"w-5","h-5","text-gray-400","transition-transform","duration-300"],["points","6 9 12 15 18 9"],[1,"p-6","bg-gray-50","border-t","border-gray-200","animate-fadeIn"],[1,"text-sm","text-gray-500"],[1,"bg-white","border","border-red-200","rounded-xl","mb-4","overflow-hidden","hover:shadow-md","transition-shadow","hover:cursor-pointer"],["type","button",1,"w-full","flex","items-center","justify-between","p-5","text-left","hover:bg-red-50","transition-colors","hover:cursor-pointer",3,"click"],[1,"text-base","font-semibold","text-red-600"],[1,"space-y-4",3,"ngSubmit"],["for","nom",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","nom","type","text","placeholder","Entrez votre nom",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["type","submit",1,"w-full","px-6","py-3","bg-emerald-500","text-white","font-semibold","rounded-lg","hover:bg-emerald-600","hover:-translate-y-0.5","hover:shadow-lg","transition-all","hover:cursor-pointer"],["for","prenom",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","prenom","type","text","placeholder","Entrez votre pr\xE9nom",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","email",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","email","type","email","placeholder","Entrez votre email",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","current-password",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","current-password","type","password","placeholder","Entrez votre mot de passe actuel",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","new-password",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","new-password","type","password","placeholder","Entrez votre nouveau mot de passe",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],["for","confirm-password",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","confirm-password","type","password","placeholder","Confirmez votre nouveau mot de passe",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-emerald-500","focus:border-emerald-500","transition-all",3,"input","value"],[1,"text-base","text-gray-700","mb-4","p-4","bg-white","rounded-lg","border","border-gray-200"],[1,"text-emerald-600","text-lg"],["type","button",1,"w-full","px-6","py-3","bg-emerald-500","text-white","font-semibold","rounded-lg","hover:bg-emerald-600","hover:-translate-y-0.5","hover:shadow-lg","transition-all","hover:cursor-pointer",3,"click"],[1,"text-sm","text-red-900","mb-4","p-4","bg-red-50","rounded-lg","border","border-red-200"],[1,"font-bold"],["for","confirm-delete",1,"block","text-sm","font-semibold","text-gray-700","mb-2"],["id","confirm-delete","type","text","placeholder","SUPPRIMER",1,"w-full","px-4","py-3","text-base","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-red-500","focus:border-red-500","transition-all",3,"input","value"],["type","submit",1,"w-full","px-6","py-3","bg-red-600","text-white","font-semibold","rounded-lg","hover:bg-red-700","hover:-translate-y-0.5","hover:shadow-lg","transition-all","hover:cursor-pointer","disabled:bg-gray-300","disabled:cursor-not-allowed","disabled:hover:translate-y-0","disabled:hover:shadow-none","disabled:opacity-60","cursor-pointer",3,"disabled"]],template:function(t,r){t&1&&(d(0,"section",0)(1,"div",1)(2,"button",2),B("click",function(){return r.toggleSection("nom")}),d(3,"span",3),c(4,"Nom"),p(),d(5,"div",4)(6,"span",5),c(7),p(),ae(),d(8,"svg",6),ie(9,"polyline",7),p()()(),k(10,Pc,8,1,"div",8),p(),ge(),d(11,"div",1)(12,"button",2),B("click",function(){return r.toggleSection("prenom")}),d(13,"span",3),c(14,"Pr\xE9nom"),p(),d(15,"div",4)(16,"span",5),c(17),p(),ae(),d(18,"svg",6),ie(19,"polyline",7),p()()(),k(20,Mc,8,1,"div",8),p(),ge(),d(21,"div",1)(22,"button",2),B("click",function(){return r.toggleSection("email")}),d(23,"span",3),c(24,"Email"),p(),d(25,"div",4)(26,"span",5),c(27),p(),ae(),d(28,"svg",6),ie(29,"polyline",7),p()()(),k(30,Tc,8,1,"div",8),p(),ge(),d(31,"div",1)(32,"button",2),B("click",function(){return r.toggleSection("password")}),d(33,"span",3),c(34,"Mot de passe"),p(),d(35,"div",4)(36,"span",9),c(37,"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"),p(),ae(),d(38,"svg",6),ie(39,"polyline",7),p()()(),k(40,Rc,16,3,"div",8),p(),ge(),d(41,"div",1)(42,"button",2),B("click",function(){return r.toggleSection("solde")}),d(43,"span",3),c(44,"R\xE9cup\xE9rer la solde"),p(),d(45,"div",4)(46,"span",9),c(47),p(),ae(),d(48,"svg",6),ie(49,"polyline",7),p()()(),k(50,Nc,7,1,"div",8),p(),ge(),d(51,"div",10)(52,"button",11),B("click",function(){return r.logout()}),d(53,"span",12),c(54,"Se d\xE9connecter"),p()()(),d(55,"div",1)(56,"button",2),B("click",function(){return r.toggleSection("delete")}),d(57,"span",3),c(58,"Supprimer le compte"),p(),ae(),d(59,"svg",6),ie(60,"polyline",7),p()(),k(61,Dc,12,2,"div",8),p()()),t&2&&(f(7),V(r.nom()),f(),De("rotate-180",r.expandedSection()==="nom"),f(2),O(r.expandedSection()==="nom"?10:-1),f(7),V(r.prenom()),f(),De("rotate-180",r.expandedSection()==="prenom"),f(2),O(r.expandedSection()==="prenom"?20:-1),f(7),V(r.email()),f(),De("rotate-180",r.expandedSection()==="email"),f(2),O(r.expandedSection()==="email"?30:-1),f(8),De("rotate-180",r.expandedSection()==="password"),f(2),O(r.expandedSection()==="password"?40:-1),f(7),$("",r.solde()," \u20AC"),f(),De("rotate-180",r.expandedSection()==="solde"),f(2),O(r.expandedSection()==="solde"?50:-1),f(9),De("rotate-180",r.expandedSection()==="delete"),f(2),O(r.expandedSection()==="delete"?61:-1))},encapsulation:2,changeDetection:0})};var qn=class n{router=M(ze);goToDashboard(){this.router.navigate(["/utilisateurs"])}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=G({type:n,selectors:[["app-recharge-cancel"]],decls:12,vars:0,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-gray-50","px-4"],[1,"max-w-md","w-full","bg-white","rounded-lg","shadow-lg","p-8","text-center"],[1,"mb-6"],[1,"material-symbols-outlined","text-orange-500","text-6xl"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600","mb-6"],[1,"space-y-3"],["type","button",1,"w-full","bg-gray-200","text-gray-700","py-3","px-4","rounded-lg","font-medium","hover:bg-gray-300","transition-colors","cursor-pointer",3,"click"]],template:function(t,r){t&1&&(d(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),c(4," cancel "),p()(),d(5,"h1",4),c(6," Paiement annul\xE9 "),p(),d(7,"p",5),c(8," Votre rechargement a \xE9t\xE9 annul\xE9. Aucun montant n'a \xE9t\xE9 d\xE9bit\xE9. "),p(),d(9,"div",6)(10,"button",7),B("click",function(){return r.goToDashboard()}),c(11," Retour \xE0 l'application "),p()()()())},dependencies:[_e],encapsulation:2})};function Lc(n,e){n&1&&(ie(0,"div",2),d(1,"p",3),c(2,"V\xE9rification du paiement..."),p())}function Bc(n,e){if(n&1){let t=j();d(0,"div",4)(1,"span",5),c(2," check_circle "),p()(),d(3,"h1",6),c(4," Rechargement r\xE9ussi ! "),p(),d(5,"p",7),c(6," Votre compte a \xE9t\xE9 cr\xE9dit\xE9 de "),d(7,"span",8),c(8),p()(),d(9,"button",9),B("click",function(){D(t);let o=C();return L(o.goToDashboard())}),c(10," Retour sur l'application "),p()}if(n&2){let t,r=C();f(8),st(" ",(t=r.sessionDetails())==null?null:t.session.amount," ",(t=r.sessionDetails())==null?null:t.session.currency.toUpperCase()," ")}}function Ic(n,e){if(n&1){let t=j();d(0,"div",4)(1,"span",10),c(2," error "),p()(),d(3,"h1",6),c(4," Erreur "),p(),d(5,"p",7),c(6," Impossible de v\xE9rifier le paiement. "),p(),d(7,"button",11),B("click",function(){D(t);let o=C();return L(o.goToDashboard())}),c(8," Retour sur l'application "),p()}}var jn=class n{route=M(Kt);router=M(ze);paymentService=M(Ye);isLoading=w(!0);sessionDetails=w(null);ngOnInit(){let e=this.route.snapshot.queryParamMap.get("session_id");e?this.verifyPayment(e):this.isLoading.set(!1)}async verifyPayment(e){try{let t=await this.paymentService.verifySession(e).toPromise();this.sessionDetails.set(t)}catch(t){console.error("Erreur lors de la v\xE9rification:",t)}finally{this.isLoading.set(!1)}}goToDashboard(){this.router.navigate(["/utilisateurs"])}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=G({type:n,selectors:[["app-recharge-success"]],decls:5,vars:1,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-gray-50","px-4"],[1,"max-w-md","w-full","bg-white","rounded-lg","shadow-lg","p-8","text-center"],[1,"animate-spin","rounded-full","h-16","w-16","border-b-2","border-emerald-600","mx-auto","mb-4"],[1,"text-gray-600"],[1,"mb-6"],[1,"material-symbols-outlined","text-emerald-600","text-6xl"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600","mb-6"],[1,"font-bold","text-emerald-600"],["type","button",1,"w-full","bg-emerald-600","text-white","py-3","px-4","rounded-lg","font-medium","hover:bg-emerald-700","transition-colors","cursor-pointer",3,"click"],[1,"material-symbols-outlined","text-red-600","text-6xl"],["type","button",1,"w-full","bg-gray-600","text-white","py-3","px-4","rounded-lg","font-medium","hover:bg-gray-700","transition-colors","cursor-pointer",3,"click"]],template:function(t,r){t&1&&(d(0,"div",0)(1,"div",1),k(2,Lc,3,0)(3,Bc,11,2)(4,Ic,9,0),p()()),t&2&&(f(2),O(r.isLoading()?2:r.sessionDetails()?3:4))},dependencies:[_e],encapsulation:2})};var ds=(n,e)=>e.id;function Fc(n,e){n&1&&(d(0,"div",2),ie(1,"div",5),d(2,"p",6),c(3,"Chargement de la proposition..."),p()())}function Ac(n,e){if(n&1){let t=j();d(0,"div",3)(1,"div",7),ae(),d(2,"svg",8),ie(3,"path",9),p(),ge(),d(4,"p",10),c(5),p()(),d(6,"button",11),B("click",function(){D(t);let o=C();return L(o.goBack())}),c(7," Retour "),p()()}if(n&2){let t=C();f(5),V(t.error())}}function Uc(n,e){n&1&&c(0," Propositions d'emprunt ")}function Vc(n,e){n&1&&c(0," Proposition d'emprunt ")}function qc(n,e){if(n&1&&c(0),n&2){let t=C(2);$(" De ",t.batchProposals().pro.name," ")}}function jc(n,e){if(n&1&&c(0),n&2){let t=C(2);$(" De ",t.proposal().pro.name," ")}}function zc(n,e){n&1&&(d(0,"span",16),c(1," En attente "),p())}function $c(n,e){n&1&&(d(0,"span",17),c(1," Valid\xE9 "),p())}function Wc(n,e){n&1&&(d(0,"span",18),c(1," Refus\xE9 "),p())}function Hc(n,e){n&1&&(d(0,"span",19),c(1," Expir\xE9 "),p())}function Gc(n,e){if(n&1&&(d(0,"div",26)(1,"div",28)(2,"div")(3,"p",36),c(4,"Type de bo\xEEte"),p(),d(5,"p",37),c(6),p()(),d(7,"div",38)(8,"p",36),c(9,"Quantit\xE9"),p(),d(10,"p",39),c(11),p()()()()),n&2){let t=e.$implicit,r=C(3);f(6),V(r.getBoxTypeName(t.type)),f(5),V(t.number)}}function Xc(n,e){n&1&&(d(0,"span",40),c(1," + "),p())}function Yc(n,e){if(n&1&&(d(0,"span"),c(1),p(),k(2,Xc,2,0,"span",40)),n&2){let t=e.$implicit,r=e.$index,o=e.$count,i=C(3);f(),st("",t.number," ",i.getBoxTypeName(t.type)),f(),O(r!==o-1?2:-1)}}function Jc(n,e){if(n&1&&(d(0,"div",25),ve(1,Gc,12,2,"div",26,ds),p(),d(3,"div",27)(4,"div",28)(5,"span",29),c(6,"Total de bo\xEEtes"),p(),d(7,"span",30),c(8),p()()(),d(9,"div",31)(10,"div",32)(11,"span",33),c(12,"Restaurant"),p(),d(13,"span",34),c(14),p()(),d(15,"div",35)(16,"span",33),c(17,"Types de bo\xEEtes"),p(),d(18,"div",34),ve(19,Yc,3,3,null,null,ds),p()()()),n&2){let t=C(2);f(),Ce(t.batchProposals().proposals),f(7),V(t.totalBoxes()),f(6),V(t.batchProposals().pro.name),f(5),Ce(t.batchProposals().proposals)}}function Kc(n,e){if(n&1&&(d(0,"div",41)(1,"div",28)(2,"div")(3,"p",36),c(4,"Type de bo\xEEte"),p(),d(5,"p",37),c(6),p()(),d(7,"div",38)(8,"p",36),c(9,"Quantit\xE9"),p(),d(10,"p",39),c(11),p()()()(),d(12,"div",31)(13,"div",32)(14,"span",33),c(15,"Restaurant"),p(),d(16,"span",34),c(17),p()()()),n&2){let t=C(2);f(6),V(t.getBoxTypeName(t.proposal().type)),f(5),V(t.proposal().number),f(6),V(t.proposal().pro.name)}}function Zc(n,e){if(n&1){let t=j();d(0,"div",23)(1,"button",42),B("click",function(){D(t);let o=C(2);return L(o.rejectProposal())}),c(2," Refuser "),p(),d(3,"button",43),B("click",function(){D(t);let o=C(2);return L(o.acceptProposal())}),c(4," Accepter "),p()()}if(n&2){let t=C(2);f(),le("disabled",t.loading()),f(2),le("disabled",t.loading())}}function Qc(n,e){if(n&1){let t=j();d(0,"button",44),B("click",function(){D(t);let o=C(2);return L(o.goBack())}),c(1," Retour au tableau de bord "),p()}}function ed(n,e){if(n&1&&(d(0,"div",4)(1,"div",12)(2,"div",13)(3,"div")(4,"h1",14),k(5,Uc,1,0)(6,Vc,1,0),p(),d(7,"p",15),k(8,qc,1,1)(9,jc,1,1),p()(),k(10,zc,2,0,"span",16),k(11,$c,2,0,"span",17),k(12,Wc,2,0,"span",18),k(13,Hc,2,0,"span",19),p()(),d(14,"div",20)(15,"h2",21),c(16,"D\xE9tails de l'emprunt"),p(),k(17,Jc,21,2)(18,Kc,18,3),p(),d(19,"div",22),k(20,Zc,5,2,"div",23)(21,Qc,2,0,"button",24),p()()),n&2){let t=C();f(5),O(t.isBatch()?5:6),f(3),O(t.isBatch()?8:9),f(2),O(t.status()==="pending"?10:-1),f(),O(t.status()==="accepted"?11:-1),f(),O(t.status()==="rejected"?12:-1),f(),O(t.status()==="expired"?13:-1),f(4),O(t.isBatch()?17:18),f(3),O(t.canInteract()?20:21)}}var zn=class n{route=M(Kt);router=M(ze);borrowService=M(Je);wsService=M(Et);proposal=w(null);batchProposals=w(null);isBatch=w(!1);status=w("pending");loading=w(!0);error=w(null);timeRemaining=w(3e5);timerInterval=null;minutes=qe(()=>Math.floor(this.timeRemaining()/6e4));seconds=qe(()=>Math.floor(this.timeRemaining()%6e4/1e3));isExpired=qe(()=>this.timeRemaining()<=0);canInteract=qe(()=>this.status()==="pending"&&!this.isExpired());totalBoxes=qe(()=>this.isBatch()&&this.batchProposals()?this.batchProposals().proposals.reduce((e,t)=>e+t.number,0):this.proposal()?.number||0);constructor(){at(()=>{let e=this.wsService.proposalAccepted(),t=this.isBatch()?this.batchProposals()?.batchId:this.proposal()?.id;e===t&&(this.status.set("accepted"),this.stopTimer())}),at(()=>{let e=this.wsService.proposalRejected(),t=this.isBatch()?this.batchProposals()?.batchId:this.proposal()?.id;e?.proposalId===t&&(this.status.set("rejected"),this.stopTimer())}),at(()=>{let e=this.wsService.proposalExpired(),t=this.isBatch()?this.batchProposals()?.batchId:this.proposal()?.id;e===t&&(this.status.set("expired"),this.stopTimer())})}ngOnInit(){let e=this.route.snapshot.paramMap.get("id"),t=this.route.snapshot.queryParamMap.get("type");if(!e){this.error.set("ID de proposition manquant"),this.loading.set(!1);return}let r=this.getAuthToken();r&&(this.wsService.connect(r),this.wsService.joinProposal(e)),t==="batch"?(this.isBatch.set(!0),this.loadBatch(e)):this.loadProposal(e)}ngOnDestroy(){let e=this.isBatch()?this.batchProposals()?.batchId:this.proposal()?.id;e&&this.wsService.leaveProposal(e),this.stopTimer()}loadProposal(e){this.borrowService.getProposal(e).subscribe({next:t=>{t.success&&t.proposal&&(this.proposal.set(t.proposal),this.timeRemaining.set(t.proposal.timeRemaining),t.proposal.accepted===!0?this.status.set("accepted"):t.proposal.accepted===!1?this.status.set("rejected"):t.proposal.timeRemaining<=0?this.status.set("expired"):(this.status.set("pending"),this.startTimer())),this.loading.set(!1)},error:t=>{console.error("Erreur lors du chargement de la proposition:",t),this.error.set("Impossible de charger la proposition"),this.loading.set(!1)}})}loadBatch(e){this.borrowService.getBatchProposals(e).subscribe({next:t=>{if(t.success&&t.proposals){this.batchProposals.set({success:t.success,batchId:t.batchId,proposals:t.proposals,user:t.user,pro:t.pro});let r=t.proposals[0];this.timeRemaining.set(r.timeRemaining);let o=t.proposals.every(s=>s.accepted===!0),i=t.proposals.some(s=>s.accepted===!1);o?this.status.set("accepted"):i?this.status.set("rejected"):r.timeRemaining<=0?this.status.set("expired"):(this.status.set("pending"),this.startTimer())}this.loading.set(!1)},error:t=>{console.error("Erreur lors du chargement du batch:",t),this.error.set("Impossible de charger les propositions"),this.loading.set(!1)}})}startTimer(){this.timerInterval=setInterval(()=>{let e=this.timeRemaining()-1e3;this.timeRemaining.set(Math.max(0,e)),e<=0&&(this.status.set("expired"),this.stopTimer())},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}acceptProposal(){if(this.canInteract())if(this.loading.set(!0),this.isBatch()){let e=this.batchProposals()?.batchId;if(!e)return;this.borrowService.acceptBatch(e).subscribe({next:t=>{t.success&&(this.status.set("accepted"),this.stopTimer()),this.loading.set(!1)},error:t=>{console.error("Erreur lors de l'acceptation du batch:",t),this.error.set("Erreur lors de l'acceptation des propositions"),this.loading.set(!1)}})}else{let e=this.proposal()?.id;if(!e)return;this.borrowService.acceptProposal(e).subscribe({next:t=>{t.success&&(this.status.set("accepted"),this.stopTimer()),this.loading.set(!1)},error:t=>{console.error("Erreur lors de l'acceptation:",t),this.error.set("Erreur lors de l'acceptation de la proposition"),this.loading.set(!1)}})}}rejectProposal(){if(this.canInteract())if(this.loading.set(!0),this.isBatch()){let e=this.batchProposals()?.batchId;if(!e)return;this.borrowService.rejectBatch(e).subscribe({next:t=>{t.success&&(this.status.set("rejected"),this.stopTimer()),this.loading.set(!1)},error:t=>{console.error("Erreur lors du refus du batch:",t),this.error.set("Erreur lors du refus des propositions"),this.loading.set(!1)}})}else{let e=this.proposal()?.id;if(!e)return;this.borrowService.rejectProposal(e).subscribe({next:t=>{t.success&&(this.status.set("rejected"),this.stopTimer()),this.loading.set(!1)},error:t=>{console.error("Erreur lors du refus:",t),this.error.set("Erreur lors du refus de la proposition"),this.loading.set(!1)}})}}goBack(){this.router.navigate(["/utilisateurs/dashboard"])}getAuthToken(){let t=document.cookie.split(";").find(r=>r.trim().startsWith("auth_token="));return t?t.split("=")[1]:null}getBoxTypeName(e){return{1:"Boite Salade Verre",2:"Boite Salade Plastique",3:"Boite Frites",4:"Boite Pizza",5:"Gobelet",6:"Boite Burger"}[e]||`Type ${e}`}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=G({type:n,selectors:[["app-validation"]],decls:5,vars:3,consts:[[1,"pt-20","bg-gradient-to-br","from-green-50","to-blue-50","p-4"],[1,"max-w-3xl","mx-auto","pt-8"],[1,"bg-white","rounded-lg","shadow-lg","p-8","text-center"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-6"],[1,"bg-white","rounded-lg","shadow-lg","overflow-hidden"],[1,"inline-block","animate-spin","rounded-full","h-12","w-12","border-b-2","border-green-600"],[1,"mt-4","text-gray-600"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-red-600","mr-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-red-800","font-medium"],[1,"mt-4","px-4","py-2","bg-red-600","text-white","rounded-lg","hover:bg-red-700","transition-colors",3,"click"],[1,"p-6","border-b","border-gray-200"],[1,"flex","justify-between","items-start"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-gray-600","mt-1"],[1,"px-4","py-2","bg-yellow-100","text-yellow-800","rounded-full","font-medium"],[1,"px-4","py-2","bg-green-100","text-green-800","rounded-full","font-medium"],[1,"px-4","py-2","bg-red-100","text-red-800","rounded-full","font-medium"],[1,"px-4","py-2","bg-gray-100","text-gray-800","rounded-full","font-medium"],[1,"p-6"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"p-6","bg-gray-50","border-t","border-gray-200"],[1,"flex","gap-4"],[1,"w-full","px-6","py-3","bg-gray-600","text-white","rounded-lg","font-semibold","hover:bg-gray-700","transition-colors"],[1,"space-y-3","mb-6"],[1,"bg-gray-50","rounded-lg","p-4"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","mb-6"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-blue-800"],[1,"text-2xl","font-bold","text-blue-600"],[1,"space-y-3","text-sm"],[1,"flex","justify-between"],[1,"text-gray-600"],[1,"font-medium","text-gray-900"],[1,"flex","flex-col","gap-1"],[1,"text-sm","text-gray-600"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-right"],[1,"text-3xl","font-bold","text-green-600"],[1,"text-gray-500"],[1,"bg-gray-50","rounded-lg","p-4","mb-6"],[1,"flex-1","px-6","py-3","bg-white","border-2","border-red-600","text-red-600","rounded-lg","font-semibold","hover:bg-red-50","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"flex-1","px-6","py-3","bg-green-600","text-white","rounded-lg","font-semibold","hover:bg-green-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","shadow-lg",3,"click","disabled"],[1,"w-full","px-6","py-3","bg-gray-600","text-white","rounded-lg","font-semibold","hover:bg-gray-700","transition-colors",3,"click"]],template:function(t,r){t&1&&(d(0,"div",0)(1,"div",1),k(2,Fc,4,0,"div",2),k(3,Ac,8,1,"div",3),k(4,ed,22,8,"div",4),p()()),t&2&&(f(2),O(r.loading()?2:-1),f(),O(r.error()&&!r.loading()?3:-1),f(),O((r.proposal()||r.batchProposals())&&!r.loading()&&!r.error()?4:-1))},dependencies:[_e],encapsulation:2})};var wh=[{path:"",component:Ln,children:[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",component:Fn},{path:"historique",component:An},{path:"boites",component:Un},{path:"parametres",component:Vn},{path:"recharge",component:jn},{path:"annule",component:qn},{path:"borrow/validation/:id",component:zn}]}];export{wh as USERS_ROUTES};
