<!-- verification-step.html -->
<app-header [isPro]="isPro()"></app-header>

<div class="flex flex-col items-center justify-center text-center space-y-6 p-4">
  <!-- Titre -->
  <div>
    <h2 class="text-2xl font-semibold text-gray-900">
      Saisissez le code à 4 chiffres envoyé à :
    </h2>
    <p class="text-lg font-bold text-gray-900 mt-1">
      {{ currentEmail() }}
    </p>
  </div>

  <!-- Champs de code -->
  <div class="flex justify-center space-x-4 mt-4">
    @for (digit of [0,1,2,3]; track digit) {
      <input
        type="text"
        inputmode="numeric"
        maxlength="1"
        class="w-14 h-14 text-center text-2xl font-medium border rounded-lg focus:outline-none focus:ring-2 transition-all"
        [class.border-gray-300]="!errorMessage()"
        [class.focus:ring-gray-900]="!errorMessage()"
        [class.border-red-500]="errorMessage()"
        [class.ring-2]="errorMessage()"
        [class.ring-red-500]="errorMessage()"
        [value]="code[digit]"
        [disabled]="isVerifying()"
        (input)="onInput($event, digit)"
        (keydown)="onKeyDown($event, digit)"
      />
    }
  </div>

  <!-- Message d'erreur -->
  @if (errorMessage()) {
    <p class="text-red-500 text-sm mt-2">
      {{ errorMessage() }}
    </p>
  }

  <!-- Loader pendant la vérification -->
  @if (isVerifying()) {
    <p class="text-gray-600 text-sm mt-2">
      Vérification en cours...
    </p>
  }

  <!-- Conseil -->
  <p class="text-sm text-gray-500 max-w-sm mt-2">
    Conseil : vérifiez votre boîte de réception et le dossier des courriers indésirables
  </p>

  <!-- Bouton renvoyer -->
  <button
    type="button"
    class="mt-4 px-6 py-2 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition disabled:opacity-50 disabled:cursor-not-allowed"
    [disabled]="isVerifying()"
    (click)="resendCode()"
  >
    Renvoyer le code
  </button>

  <!-- Navigation -->
  <div class="flex justify-between items-center w-full max-w-xs mt-8">
    <button
      type="button"
      class="flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition disabled:opacity-50"
      [disabled]="isVerifying()"
      (click)="goBack()"
    >
      <span class="text-2xl mr-1">←</span> Retour
    </button>

    <button
      type="button"
      class="flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition disabled:opacity-50 disabled:cursor-not-allowed"
      [disabled]="!isCodeComplete() || isVerifying()"
      (click)="goNext()"
    >
      {{ isVerifying() ? 'Vérification...' : 'Suivant' }} <span class="text-2xl ml-1">→</span>
    </button>
  </div>
</div>